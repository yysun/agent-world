var Ke=Object.defineProperty;var Xe=(e,n,t)=>n in e?Ke(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var S=(e,n,t)=>Xe(e,typeof n!="symbol"?n+"":n,t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Me="3.37.2",Ye=`AppRun-${Me}`;class xe{constructor(){this._events={}}on(n,t,r={}){this._events[n]=this._events[n]||[],this._events[n].push({fn:t,options:r})}off(n,t){const r=this._events[n]||[];this._events[n]=r.filter(o=>o.fn!==t)}find(n){return this._events[n]}run(n,...t){const r=this.getSubscribers(n,this._events);return console.assert(r&&r.length>0,"No subscriber for event: "+n),r.forEach(o=>{const{fn:a,options:s}=o;if(!a||typeof a!="function")return console.error(`AppRun event handler for '${n}' is not a function:`,a),!1;if(s.delay)this.delay(n,a,t,s);else try{Object.keys(s).length>0?a.apply(this,[...t,s]):a.apply(this,t)}catch(i){console.error(`Error in event handler for '${n}':`,i)}return!o.options.once}),r.length}once(n,t,r={}){this.on(n,t,{...r,once:!0})}delay(n,t,r,o){o._t&&clearTimeout(o._t),o._t=setTimeout(()=>{clearTimeout(o._t);try{Object.keys(o).length>0?t.apply(this,[...r,o]):t.apply(this,r)}catch(a){console.error(`Error in delayed event handler for '${n}':`,a)}},o.delay)}runAsync(n,...t){const r=this.getSubscribers(n,this._events);console.assert(r&&r.length>0,"No subscriber for event: "+n);const o=r.map(a=>{const{fn:s,options:i}=a;if(!s||typeof s!="function")return console.error(`AppRun async event handler for '${n}' is not a function:`,s),Promise.resolve(null);try{return Object.keys(i).length>0?s.apply(this,[...t,i]):s.apply(this,t)}catch(h){return console.error(`Error in async event handler for '${n}':`,h),Promise.reject(h)}});return Promise.all(o)}query(n,...t){return console.warn("app.query() is deprecated. Use app.runAsync() instead."),this.runAsync(n,...t)}getSubscribers(n,t){const r=t[n]||[];return t[n]=r.filter(o=>!o.options.once),Object.keys(t).filter(o=>o.endsWith("*")&&n.startsWith(o.replace("*",""))).sort((o,a)=>a.length-o.length).forEach(o=>r.push(...t[o].map(a=>({...a,options:{...a.options,event:n}})))),r}}const Je=Ye;let K;const U=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};U.app&&U._AppRunVersions?K=U.app:(K=new xe,U.app=K,U._AppRunVersions=Je);const m=K;function x(e){return(e==null?void 0:e.target)instanceof HTMLElement?e.target:null}function Ge(e,n=document){try{return n.querySelector(e)}catch(t){return console.warn(`Invalid selector: ${e}`,t),null}}function Ze(e){try{return document.getElementById(e)}catch(n){return console.warn(`Error getting element by id: ${e}`,n),null}}const D=(e,n)=>(n?e.state[n]:e.state)||"",W=(e,n,t)=>{if(n){const r=e.state||{};r[n]=t,e.setState(r)}else e.setState(t)},Qe=(e,n,t,r)=>{if(e.startsWith("$on")){const o=n[e];if(e=e.substring(1),typeof o=="boolean")n[e]=a=>r.run?r.run(e,a):m.run(e,a);else if(typeof o=="string")n[e]=a=>r.run?r.run(o,a):m.run(o,a);else if(typeof o=="function")n[e]=a=>r.setState(o(r.state,a));else if(Array.isArray(o)){const[a,...s]=o;typeof a=="string"?n[e]=i=>r.run?r.run(a,...s,i):m.run(a,...s,i):typeof a=="function"&&(n[e]=i=>r.setState(a(r.state,...s,i)))}}else if(e==="$bind"){const o=n.type||"text",a=typeof n[e]=="string"?n[e]:n.name;if(t==="input")switch(o){case"checkbox":n.checked=D(r,a),n.onclick=s=>{const i=x(s);i&&W(r,a||i.name,i.checked)};break;case"radio":n.checked=D(r,a)===n.value,n.onclick=s=>{const i=x(s);i&&W(r,a||i.name,i.value)};break;case"number":case"range":n.value=D(r,a),n.oninput=s=>{const i=x(s);i&&W(r,a||i.name,Number(i.value))};break;default:n.value=D(r,a),n.oninput=s=>{const i=x(s);i&&W(r,a||i.name,i.value)}}else t==="select"?(n.value=D(r,a),n.onchange=s=>{const i=x(s);i&&!i.multiple&&W(r,a||i.name,i.value)}):t==="option"?(n.selected=D(r,a),n.onclick=s=>{const i=x(s);i&&W(r,a||i.name,i.selected)}):t==="textarea"&&(n.innerHTML=D(r,a),n.oninput=s=>{const i=x(s);i&&W(r,a||i.name,i.value)})}else m.run("$",{key:e,tag:t,props:n,component:r})},J=(e,n)=>{if(Array.isArray(e))return e.map(t=>J(t,n));{let{type:t,tag:r,props:o,children:a}=e;return r=r||t,a=a||(o==null?void 0:o.children),o&&Object.keys(o).forEach(s=>{s.startsWith("$")&&(Qe(s,o,r,n),delete o[s])}),a&&J(a,n),e}};class q{constructor(n,t,r){this.normal=t,this.property=n,r&&(this.space=r)}}q.prototype.normal={};q.prototype.property={};q.prototype.space=void 0;function De(e,n){const t={},r={};for(const o of e)Object.assign(t,o.property),Object.assign(r,o.normal);return new q(t,r,n)}function le(e){return e.toLowerCase()}class v{constructor(n,t){this.attribute=t,this.property=n}}v.prototype.attribute="";v.prototype.booleanish=!1;v.prototype.boolean=!1;v.prototype.commaOrSpaceSeparated=!1;v.prototype.commaSeparated=!1;v.prototype.defined=!1;v.prototype.mustUseProperty=!1;v.prototype.number=!1;v.prototype.overloadedBoolean=!1;v.prototype.property="";v.prototype.spaceSeparated=!1;v.prototype.space=void 0;let en=0;const p=T(),y=T(),ae=T(),c=T(),f=T(),$=T(),E=T();function T(){return 2**++en}const se=Object.freeze(Object.defineProperty({__proto__:null,boolean:p,booleanish:y,commaOrSpaceSeparated:E,commaSeparated:$,number:c,overloadedBoolean:ae,spaceSeparated:f},Symbol.toStringTag,{value:"Module"})),ne=Object.keys(se);class pe extends v{constructor(n,t,r,o){let a=-1;if(super(n,t),ge(this,"space",o),typeof r=="number")for(;++a<ne.length;){const s=ne[a];ge(this,ne[a],(r&se[s])===se[s])}}}pe.prototype.defined=!0;function ge(e,n,t){t&&(e[n]=t)}function I(e){const n={},t={};for(const[r,o]of Object.entries(e.properties)){const a=new pe(r,e.transform(e.attributes||{},r),o,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),n[r]=a,t[le(r)]=r,t[le(a.attribute)]=r}return new q(n,t,e.space)}const We=I({properties:{ariaActiveDescendant:null,ariaAtomic:y,ariaAutoComplete:null,ariaBusy:y,ariaChecked:y,ariaColCount:c,ariaColIndex:c,ariaColSpan:c,ariaControls:f,ariaCurrent:null,ariaDescribedBy:f,ariaDetails:null,ariaDisabled:y,ariaDropEffect:f,ariaErrorMessage:null,ariaExpanded:y,ariaFlowTo:f,ariaGrabbed:y,ariaHasPopup:null,ariaHidden:y,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:f,ariaLevel:c,ariaLive:null,ariaModal:y,ariaMultiLine:y,ariaMultiSelectable:y,ariaOrientation:null,ariaOwns:f,ariaPlaceholder:null,ariaPosInSet:c,ariaPressed:y,ariaReadOnly:y,ariaRelevant:null,ariaRequired:y,ariaRoleDescription:f,ariaRowCount:c,ariaRowIndex:c,ariaRowSpan:c,ariaSelected:y,ariaSetSize:c,ariaSort:null,ariaValueMax:c,ariaValueMin:c,ariaValueNow:c,ariaValueText:null,role:null},transform(e,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function Le(e,n){return n in e?e[n]:n}function Te(e,n){return Le(e,n.toLowerCase())}const nn=I({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:$,acceptCharset:f,accessKey:f,action:null,allow:null,allowFullScreen:p,allowPaymentRequest:p,allowUserMedia:p,alt:null,as:null,async:p,autoCapitalize:null,autoComplete:f,autoFocus:p,autoPlay:p,blocking:f,capture:null,charSet:null,checked:p,cite:null,className:f,cols:c,colSpan:null,content:null,contentEditable:y,controls:p,controlsList:f,coords:c|$,crossOrigin:null,data:null,dateTime:null,decoding:null,default:p,defer:p,dir:null,dirName:null,disabled:p,download:ae,draggable:y,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:p,formTarget:null,headers:f,height:c,hidden:ae,high:c,href:null,hrefLang:null,htmlFor:f,httpEquiv:f,id:null,imageSizes:null,imageSrcSet:null,inert:p,inputMode:null,integrity:null,is:null,isMap:p,itemId:null,itemProp:f,itemRef:f,itemScope:p,itemType:f,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:p,low:c,manifest:null,max:null,maxLength:c,media:null,method:null,min:null,minLength:c,multiple:p,muted:p,name:null,nonce:null,noModule:p,noValidate:p,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:p,optimum:c,pattern:null,ping:f,placeholder:null,playsInline:p,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:p,referrerPolicy:null,rel:f,required:p,reversed:p,rows:c,rowSpan:c,sandbox:f,scope:null,scoped:p,seamless:p,selected:p,shadowRootClonable:p,shadowRootDelegatesFocus:p,shadowRootMode:null,shape:null,size:c,sizes:null,slot:null,span:c,spellCheck:y,src:null,srcDoc:null,srcLang:null,srcSet:null,start:c,step:null,style:null,tabIndex:c,target:null,title:null,translate:null,type:null,typeMustMatch:p,useMap:null,value:y,width:c,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:f,axis:null,background:null,bgColor:null,border:c,borderColor:null,bottomMargin:c,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:p,declare:p,event:null,face:null,frame:null,frameBorder:null,hSpace:c,leftMargin:c,link:null,longDesc:null,lowSrc:null,marginHeight:c,marginWidth:c,noResize:p,noHref:p,noShade:p,noWrap:p,object:null,profile:null,prompt:null,rev:null,rightMargin:c,rules:null,scheme:null,scrolling:y,standby:null,summary:null,text:null,topMargin:c,valueType:null,version:null,vAlign:null,vLink:null,vSpace:c,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:p,disableRemotePlayback:p,prefix:null,property:null,results:c,security:null,unselectable:null},space:"html",transform:Te}),tn=I({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:E,accentHeight:c,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:c,amplitude:c,arabicForm:null,ascent:c,attributeName:null,attributeType:null,azimuth:c,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:c,by:null,calcMode:null,capHeight:c,className:f,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:c,diffuseConstant:c,direction:null,display:null,dur:null,divisor:c,dominantBaseline:null,download:p,dx:null,dy:null,edgeMode:null,editable:null,elevation:c,enableBackground:null,end:null,event:null,exponent:c,externalResourcesRequired:null,fill:null,fillOpacity:c,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:$,g2:$,glyphName:$,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:c,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:c,horizOriginX:c,horizOriginY:c,id:null,ideographic:c,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:c,k:c,k1:c,k2:c,k3:c,k4:c,kernelMatrix:E,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:c,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:c,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:c,overlineThickness:c,paintOrder:null,panose1:null,path:null,pathLength:c,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:f,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:c,pointsAtY:c,pointsAtZ:c,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:E,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:E,rev:E,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:E,requiredFeatures:E,requiredFonts:E,requiredFormats:E,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:c,specularExponent:c,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:c,strikethroughThickness:c,string:null,stroke:null,strokeDashArray:E,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:c,strokeOpacity:c,strokeWidth:null,style:null,surfaceScale:c,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:E,tabIndex:c,tableValues:null,target:null,targetX:c,targetY:c,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:E,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:c,underlineThickness:c,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:c,values:null,vAlphabetic:c,vMathematical:c,vectorEffect:null,vHanging:c,vIdeographic:c,version:null,vertAdvY:c,vertOriginX:c,vertOriginY:c,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:c,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Le}),Oe=I({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,n){return"xlink:"+n.slice(5).toLowerCase()}}),Pe=I({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Te}),$e=I({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,n){return"xml:"+n.slice(3).toLowerCase()}}),rn=/[A-Z]/g,fe=/-[a-z]/g,on=/^data[-\w.:]+$/i;function ln(e,n){const t=le(n);let r=n,o=v;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&on.test(n)){if(n.charAt(4)==="-"){const a=n.slice(5).replace(fe,sn);r="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=n.slice(4);if(!fe.test(a)){let s=a.replace(rn,an);s.charAt(0)!=="-"&&(s="-"+s),n="data"+s}}o=pe}return new o(r,n)}function an(e){return"-"+e.toLowerCase()}function sn(e){return e.charAt(1).toUpperCase()}const cn=De([We,nn,Oe,Pe,$e],"html"),dn=De([We,tn,Oe,Pe,$e],"svg"),ye="_props",we=new Map;function un(e,n){if(n&&(n.class=n.class||n.className,delete n.className),!e||Object.keys(e).length===0)return n||{};if(!n||Object.keys(n).length===0){const r={};return Object.keys(e).forEach(o=>r[o]=null),r}const t={};return Object.keys(e).forEach(r=>{r in n||(t[r]=null)}),Object.keys(n).forEach(r=>t[r]=n[r]),t}function pn(e){return e.length<=1?e.toLowerCase():e.split("-").map((n,t)=>t===0?n.toLowerCase():n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join("")}function hn(e,n){const t=`${e}:${n}`;let r=we.get(t);return r===void 0&&(r=ln(n?dn:cn,e)||null,we.set(t,r)),r}function mn(e,n,t){const r=pn(n.slice(5));t==null?delete e.dataset[r]:e.dataset[r]=String(t)}function gn(e,n,t){n.startsWith("on")&&(!t||typeof t=="function"?e[n]=t:typeof t=="string"&&(t?e.setAttribute(n,t):e.removeAttribute(n)))}function be(e,n,t){fn(t)?e.setAttribute(n,n):e.removeAttribute(n)}function V(e,n,t){try{e[n]=t}catch{X(e,n,t,!1)}}function X(e,n,t,r){if(t==null){e.removeAttribute(n);return}const o=String(t);if(r&&n.includes(":")){const[a]=n.split(":");a==="xlink"?e.setAttributeNS("http://www.w3.org/1999/xlink",n,o):e.setAttribute(n,o)}else e.setAttribute(n,o)}function fn(e){return e==null||e===!1||e===""?!1:e===!0?!0:typeof e=="string"?e.toLowerCase()!=="false"&&e!=="0":!!e}function yn(e,n,t,r){if(wn(e,n))return;if(n==="style"){if(e.style.cssText&&(e.style.cssText=""),typeof t=="string")e.style.cssText=t;else if(t&&typeof t=="object")for(const a in t)e.style[a]!==t[a]&&(e.style[a]=t[a]);return}if(n==="key"){t!=null&&(e.key=t);return}if(n.startsWith("data-")){mn(e,n,t);return}if(n.startsWith("on")){gn(e,n,t);return}if((e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT")&&(n==="value"||n==="selected"||n==="selectedIndex")){V(e,n,t);return}if(e.tagName==="INPUT"&&n==="checked"){V(e,n,t),be(e,n,t);return}const o=hn(n,r);o?o.boolean||o.overloadedBoolean?be(e,o.attribute,t):o.mustUseProperty&&!r?V(e,o.property,t):X(e,o.attribute,t,r):n.startsWith("aria-")||n==="role"?X(e,n,t,r):n in e||e[n]!==void 0?V(e,n,t):X(e,n,t,r)}function wn(e,n){return document.activeElement===e?["selectionStart","selectionEnd","selectionDirection"].includes(n):!!(n==="scrollTop"||n==="scrollLeft"||e instanceof HTMLMediaElement&&["currentTime","paused","playbackRate","volume"].includes(n))}function bn(e){return/^[a-zA-Z_:][\w\-:.]*$/.test(e)&&!e.includes("<")&&!e.includes(">")&&!e.includes('"')&&!e.includes("'")}function he(e,n,t){const r=e[ye]||{},o=un(r,n);e[ye]=n||{},vn(e,o,n,t)}function vn(e,n,t,r){for(const o in n)bn(o)&&yn(e,o,n[o],r);n&&typeof n.ref=="function"&&window.requestAnimationFrame(()=>n.ref(e))}function En(e,...n){return Ie(n)}function Ie(e){const n=[],t=r=>{r!=null&&r!==""&&r!==!1&&n.push(typeof r=="function"||typeof r=="object"?r:`${r}`)};return e&&e.forEach(r=>{Array.isArray(r)?r.forEach(o=>t(o)):t(r)}),n}const H={};let ve=0;const Sn=500,An=1e3;function Nn(){if(!(Object.keys(H).length<=An))for(const[e,n]of Object.entries(H))n.isConnected||delete H[e]}function Cn(e,n,...t){const r=Ie(t);if(typeof e=="string")return{tag:e,props:n,children:r};if(Array.isArray(e))return e;if(e===void 0&&t)return r;if(Object.getPrototypeOf(e).__isAppRunComponent)return{tag:e,props:n,children:r};if(typeof e=="function")return e(n,r);throw new Error(`Unknown tag in vdom ${e}`)}const kn=(e,n,t={})=>{if(n==null||n===!1)return;const r=typeof e=="string"&&e?document.getElementById(e)||document.querySelector(e):e;n=J(n,t),_n(r,n,t)};function _n(e,n,t={}){if(n==null||n===!1||(n=Y(n,t),!e))return;const r=e.nodeName==="SVG";Array.isArray(n)?ie(e,n,r):ie(e,[n],r)}function Mn(e,n){const t=e.nodeName,r=`${n.tag||""}`;return t.toUpperCase()===r.toUpperCase()}function te(e,n,t){if(t=t||n.tag==="svg",!Mn(e,n)){e.parentNode.replaceChild(G(n,t),e);return}ie(e,n.children,t),he(e,n.props,t)}function ie(e,n,t){var i,h;const r=((i=e.childNodes)==null?void 0:i.length)||0,o=(n==null?void 0:n.length)||0,a=Math.min(r,o);for(let u=0;u<a;u++){const d=n[u],g=e.childNodes[u];if(typeof d=="string")g.textContent!==d&&(g.nodeType===3?g.nodeValue=d:e.replaceChild(ce(d),g));else if(d instanceof HTMLElement||d instanceof SVGElement)e.insertBefore(d,g);else{const b=d.props&&d.props.key;if(b)if(g.key===b)te(e.childNodes[u],d,t);else{const _=H[b];_?(e.insertBefore(_,g),te(e.childNodes[u],d,t)):e.replaceChild(G(d,t),g)}else te(e.childNodes[u],d,t)}}let s=((h=e.childNodes)==null?void 0:h.length)||0;for(;s>a;)e.removeChild(e.lastChild),s--;if(o>a){const u=document.createDocumentFragment();for(let d=a;d<n.length;d++)u.appendChild(G(n[d],t));e.appendChild(u)}}const Ee=e=>{const n=document.createElement("section");return n.insertAdjacentHTML("afterbegin",e),Array.from(n.children)};function ce(e){if((e==null?void 0:e.indexOf("_html:"))===0){const n=document.createElement("div");return n.insertAdjacentHTML("afterbegin",e.substring(6)),n}else return document.createTextNode(e??"")}function G(e,n){if(e instanceof HTMLElement||e instanceof SVGElement)return e;if(typeof e=="string")return ce(e);if(!e.tag||typeof e.tag=="function")return ce(JSON.stringify(e));n=n||e.tag==="svg";const t=n?document.createElementNS("http://www.w3.org/2000/svg",e.tag):document.createElement(e.tag);return he(t,e.props,n),e.children&&e.children.forEach(r=>t.appendChild(G(r,n))),e.props&&e.props.key!==void 0&&(t.key=e.props.key,H[e.props.key]=t,++ve>=Sn&&(Nn(),ve=0)),t}function xn(e,n,t){const{tag:r,props:o,children:a}=e;let s=`_${t}`,i=o&&o.id;i?s=i:i=`_${t}${Date.now()}`;let h="section";o&&o.as&&(h=o.as,delete o.as),n.__componentCache||(n.__componentCache={});let u=n.__componentCache[s];if(!u||!(u instanceof r)||!u.element){const d=document.createElement(h);u=n.__componentCache[s]=new r({...o,children:a}).mount(d,{render:!0})}else u.renderState(u.state);if(u.mounted){const d=u.mounted(o,a,u.state);typeof d<"u"&&u.setState(d)}return he(u.element,o,!1),u.element}function Y(e,n,t=0){var o;if(typeof e=="string")return e;if(Array.isArray(e))return e.map(a=>Y(a,n,t++));let r=e;if(e&&typeof e.tag=="function"&&Object.getPrototypeOf(e.tag).__isAppRunComponent&&(r=xn(e,n,t)),r&&Array.isArray(r.children)){const a=(o=r.props)==null?void 0:o._component;if(a){let s=0;r.children=r.children.map(i=>Y(i,a,s++))}else r.children=r.children.map(s=>Y(s,n,t++))}return r}const Dn=(e,n={})=>class extends HTMLElement{constructor(){super()}get component(){return this._component}get state(){return this._component.state}static get observedAttributes(){return(n.observedAttributes||[]).map(r=>r.toLowerCase())}connectedCallback(){if(this.isConnected&&!this._component){const r=n||{};this._shadowRoot=r.shadow?this.attachShadow({mode:"open"}):this;const o=r.observedAttributes||[],a=o.reduce((i,h)=>{const u=h.toLowerCase();return u!==h&&(i[u]=h),i},{});this._attrMap=i=>a[i]||i;const s={};Array.from(this.attributes).forEach(i=>s[this._attrMap(i.name)]=i.value),o.forEach(i=>{this[i]!==void 0&&(s[i]=this[i]),Object.defineProperty(this,i,{get(){return s[i]},set(h){this.attributeChangedCallback(i,s[i],h)},configurable:!0,enumerable:!0})}),requestAnimationFrame(()=>{const i=this.children?Array.from(this.children):[];if(this._component=new e({...s,children:i}).mount(this._shadowRoot,r),this._component._props=s,this._component.dispatchEvent=this.dispatchEvent.bind(this),this._component.mounted){const h=this._component.mounted(s,i,this._component.state);typeof h<"u"&&(this._component.state=h)}this.on=this._component.on.bind(this._component),this.run=this._component.run.bind(this._component),r.render!==!1&&this._component.run(".")})}}disconnectedCallback(){var r,o,a,s;(o=(r=this._component)==null?void 0:r.unload)==null||o.call(r),(s=(a=this._component)==null?void 0:a.unmount)==null||s.call(a),this._component=null}attributeChangedCallback(r,o,a){if(this._component){const s=this._attrMap(r);this._component._props[s]=a,this._component.run("attributeChanged",s,o,a),a!==o&&n.render!==!1&&window.requestAnimationFrame(()=>{this._component.run(".")})}}},Re=(e,n,t)=>{typeof customElements<"u"&&customElements.define(e,Dn(n,t))},de={meta:new WeakMap,defineMetadata(e,n,t){this.meta.has(t)||this.meta.set(t,{}),this.meta.get(t)[e]=n},getMetadataKeys(e){return e=Object.getPrototypeOf(e),this.meta.get(e)?Object.keys(this.meta.get(e)):[]},getMetadata(e,n){return n=Object.getPrototypeOf(n),this.meta.get(n)?this.meta.get(n)[e]:null}};function Wn(e,n={}){return function(t,r){const o=e?e.toString():r;de.defineMetadata(`apprun-update:${o}`,{name:o,key:r,options:n},t)}}function Ln(e,n){return function(r){return Re(e,r,n),r}}const Se=e=>e,w=m;class L{renderState(n,t=null){if(!this.view)return;let r=t||this.view(n);if(w.debug&&w.run("debug",{component:this,_:r?".":"-",state:n,vdom:r,el:this.element}),typeof document!="object")return;const o=typeof this.element=="string"&&this.element?Ze(this.element)||Ge(this.element):this.element;if(!o){console.warn(`Component element not found: ${this.element}`);return}const a="_c";this.unload?(o._component!==this||o.getAttribute(a)!==this.tracking_id)&&(this.tracking_id=new Date().valueOf().toString(),o.setAttribute(a,this.tracking_id),typeof MutationObserver<"u"&&(this.observer||(this.observer=new MutationObserver(s=>{(s[0].oldValue===this.tracking_id||!document.body.contains(o))&&(this.unload(this.state),this.observer.disconnect(),this.observer=null)})),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[a]}))):o.removeAttribute&&o.removeAttribute(a),o._component=this,!t&&r&&(r=J(r,this),this.options.transition&&document&&document.startViewTransition?document.startViewTransition(()=>w.render(o,r,this)):w.render(o,r,this)),this.rendered&&this.rendered(this.state)}setState(n,t={render:!0,history:!1}){const r=async a=>{try{for(;;){const{value:s,done:i}=await a.next();if(i)break;this.setState(s,t)}}catch(s){console.error("Error in async iterator:",s)}},o=n;if(o!=null&&o[Symbol.asyncIterator]){this.setState(r(o[Symbol.asyncIterator]()),t);return}else if(o!=null&&o[Symbol.iterator]&&typeof o.next=="function"){for(const a of o)this.setState(a,t);return}else if(n&&n instanceof Promise)Promise.resolve(n).then(a=>{this.setState(a,t),this._state=n});else{if(this._state=n,n==null)return;this.state=n,t.render!==!1&&(t.transition&&document&&document.startViewTransition?document.startViewTransition(()=>this.renderState(n)):this.renderState(n)),t.history!==!1&&this.enable_history&&(this._history=[...this._history,n],this._history_idx=this._history.length-1),typeof t.callback=="function"&&t.callback(this.state)}}constructor(n,t,r,o){this.state=n,this.view=t,this.update=r,this.options=o,this._app=new xe,this._actions=[],this._global_events=[],this._history=[],this._history_idx=-1,this._history_prev=()=>{this._history_idx--,this._history_idx>=0?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=0},this._history_next=()=>{this._history_idx++,this._history_idx<this._history.length?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=this._history.length-1},this.start=(a=null,s)=>{if(this.mount(a,{render:!0,...s}),this.mounted&&typeof this.mounted=="function"){const i=this.mounted({},[],this.state);typeof i<"u"&&this.setState(i)}return this}}mount(n=null,t){var r;return console.assert(!this.element,"Component already mounted."),this.options=t={...this.options,...t},this.element=n,this.global_event=t.global_event,this.enable_history=!!t.history,this.enable_history&&(this.on(t.history.prev||"history-prev",this._history_prev),this.on(t.history.next||"history-next",this._history_next)),t.route&&(this.update=this.update||{},this.update[t.route]||(this.update[t.route]=Se)),this.add_actions(),this.state=this.state??this.model??{},typeof this.state=="function"&&(this.state=this.state()),this.setState(this.state,{render:!!t.render,history:!0}),w.debug&&((r=w.find("debug-create-component"))!=null&&r.length)&&w.run("debug-create-component",this),this}is_global_event(n){return n&&(this.global_event||this._global_events.indexOf(n)>=0||n.startsWith("#")||n.startsWith("/")||n.startsWith("@"))}add_action(n,t,r={}){if(!t||typeof t!="function"){console.warn(`Component action for '${n}' is not a valid function:`,t);return}r.global&&this._global_events.push(n),this.on(n,(...o)=>{w.debug&&w.run("debug",{component:this,_:">",event:n,p:o,current_state:this.state,options:r});try{const a=t(this.state,...o);w.debug&&w.run("debug",{component:this,_:"<",event:n,p:o,newState:a,state:this.state,options:r}),this.setState(a,r)}catch(a){console.error(`Error in component action '${n}':`,a),w.debug&&w.run("debug",{component:this,_:"!",event:n,p:o,error:a,state:this.state,options:r})}},r)}add_actions(){const n=this.update||{};de.getMetadataKeys(this).forEach(r=>{if(r.startsWith("apprun-update:")){const o=de.getMetadata(r,this);n[o.name]=[this[o.key].bind(this),o.options]}});const t={};Array.isArray(n)?n.forEach(r=>{const[o,a,s]=r;o.toString().split(",").forEach(h=>t[h.trim()]=[a,s])}):Object.keys(n).forEach(r=>{const o=n[r];(typeof o=="function"||Array.isArray(o))&&r.split(",").forEach(a=>t[a.trim()]=o)}),t["."]||(t["."]=Se),Object.keys(t).forEach(r=>{const o=t[r];typeof o=="function"?this.add_action(r,o):Array.isArray(o)&&this.add_action(r,o[0],o[1])})}run(n,...t){if(this.state instanceof Promise)return Promise.resolve(this.state).then(r=>{this.state=r,this.run(n,...t)});{const r=n.toString();return this.is_global_event(r)?w.run(r,...t):this._app.run(r,...t)}}on(n,t,r){const o=n.toString();return this._actions.push({name:o,fn:t}),this.is_global_event(o)?w.on(o,t,r):this._app.on(o,t,r)}runAsync(n,...t){const r=n.toString();return this.is_global_event(r)?w.runAsync(r,...t):this._app.runAsync(r,...t)}query(n,...t){return console.warn("component.query() is deprecated. Use component.runAsync() instead."),this.runAsync(n,...t)}unmount(){var n;(n=this.observer)==null||n.disconnect(),this._actions.forEach(t=>{const{name:r,fn:o}=t;this.is_global_event(r)?w.off(r,o):this._app.off(r,o)})}}L.__isAppRunComponent=!0;function Tn(e){return e?e.startsWith("#/")?e.substring(2).split("/"):e.startsWith("#")||e.startsWith("/")?e.substring(1).split("/"):e.split("/"):[]}function On(e){return!e||e==="/"||e==="#"||e==="#/"?e:e.endsWith("/")?e.slice(0,-1):e}function Pn(e){const n=e.filter(Boolean);n.length>11&&console.warn(`Deep route hierarchy detected: ${n.join("/")} (${n.length} levels)`)}function $n(e,n){if(!n||n==="/"||n==="")return e;const t=n.startsWith("/")?n:"/"+n;if(e.startsWith(t)){const r=e.substring(t.length);return r.startsWith("/")?r:"/"+r}return e}function In(e,n){const t=[];for(let r=e.length;r>0;r--){const o=e.slice(0,r);let a="";switch(n){case"path":a="/"+o.join("/");break;case"hash":a="#"+o.join("/");break;case"hash-slash":a="#/"+o.join("/");break;case"non-prefixed":a=o.join("/");break}t.push(a)}return t}function Rn(e,n){for(let t=0;t<e.length;t++){const r=e[t],o=m.find(r);if(o&&o.length>0){const a=e.length-t,s=n.slice(a);return{eventName:r,parameters:s}}}return null}function Ae(){const e=m.find("#");if(e&&e.length>0){m.run("#"),m.run(M,"#");return}const n=m.find("/");if(n&&n.length>0){m.run("/"),m.run(M,"/");return}const t=m.find("#/");if(t&&t.length>0){m.run("#/"),m.run(M,"#/");return}console.warn("No subscribers for event: "),m.run(B,""),m.run(M,"")}function Un(e){if(!e){Ae();return}e=On(e);const n=m.basePath;n&&(e=$n(e,n));const t=Tn(e);Pn(t);let r;e.startsWith("#/")?r="hash-slash":e.startsWith("#")?r="hash":e.startsWith("/")?r="path":r="non-prefixed";const o=In(t,r),a=Rn(o,t);if(a)Fn(a.eventName,...a.parameters);else if(o.length>0){const s=o[o.length-1];console.warn(`No subscribers for event: ${s}`),m.run(B,e),m.run(M,e)}else Ae()}const Fn=(e,...n)=>{if(!e||e===M||e===B)return;const t=m.find(e);!t||t.length===0?(console.warn(`No subscribers for event: ${e}`),m.run(B,e,...n)):m.run(e,...n),m.run(M,e,...n)},M="//",B="///",O=e=>{m.lastUrl!==e&&(m.lastUrl=e,Un(e))};function Ne(e){return e&&typeof e=="object"&&typeof e.mount=="function"}function ue(e){return typeof e=="function"&&e.prototype&&e.prototype.constructor===e&&(e.prototype.mount!==void 0||e.prototype.state!==void 0||e.prototype.view!==void 0)}function Ue(e){return typeof e=="function"&&!ue(e)}async function jn(e,n=3){let t=e,r=0;for(;Ue(t)&&r<n;)try{const o=await t();if(o===t)break;t=o,r++}catch(o){console.error(`Error executing component function: ${o}`);break}return t}const Hn=async(e,n)=>{for(const[t,r]of Object.entries(n)){if(!r||!t){console.error(`Invalid component configuration: component=${r}, route=${t}`);continue}if(Ne(r)){const o={route:t};r.mount(e,o);continue}if(ue(r)){const o=new r,a={route:t};o.mount(e,a);continue}if(Ue(r)){let o=await jn(r);if(Ne(o)){const a={route:t};o.mount(e,a);continue}if(ue(o)){const a=new o,s={route:t};a.mount(e,s);continue}m.on(t,(...a)=>{const s=r(...a);if(typeof e=="string"&&(e=document.querySelector(e),!e)){console.error(`Element not found: ${e}`);return}return m.render(e,s)});continue}console.error("Invalid component: component must be a class, instance, or function that returns a class/instance")}},l=m;if(!l.start){l.version=Me,l.h=l.createElement=Cn,l.render=kn,l.Fragment=En,l.webComponent=Re,l.safeHTML=Ee,l.start=(n,t,r,o,a)=>{const s={render:!0,global_event:!0,...a},i=new L(t,r,o);return a&&a.rendered&&(i.rendered=a.rendered),a&&a.mounted&&(i.mounted=a.mounted),i.start(n,s),i},l.query=l.query||l.runAsync;const e=n=>{};if(l.on("/",e),l.on("debug",n=>e),l.on(M,e),l.on(B,e),l.route=O,l.on("route",n=>l.route&&l.route(n)),typeof document=="object"&&document.addEventListener("DOMContentLoaded",()=>{const n=document.body.hasAttribute("apprun-no-init")||l["no-init-route"]||!1,t=l.find("#")||l.find("#/")||!1;window.addEventListener("hashchange",()=>O(location.hash)),window.addEventListener("popstate",()=>O(location.pathname)),t?!n&&O(location.hash):(!n&&(()=>{const r=l.basePath||"";let o=location.pathname;r&&o.startsWith(r)&&(o=o.substring(r.length),o.startsWith("/")||(o="/"+o)),O(o)})(),document.body.addEventListener("click",r=>{const o=r.target;if(!o)return;const a=o.tagName==="A"?o:o.closest("a");if(a&&a.origin===location.origin&&a.pathname){r.preventDefault();const i=(l.basePath||"")+a.pathname;history.pushState(null,"",i),O(a.pathname)}}))}),typeof window=="object"){const n=window;n.Component=L,n._React=n.React,n.React=l,n.on=Wn,n.customElement=Ln,n.safeHTML=Ee}l.use_render=(n,t=0)=>{t===0?l.render=(r,o)=>n(o,r):l.render=(r,o)=>n(r,o)},l.use_react=(n,t)=>{if(!n||!t){console.error("AppRun use_react: React and ReactDOM parameters are required");return}if(typeof n.createElement!="function"){console.error("AppRun use_react: Invalid React object - createElement method not found");return}if(!n.Fragment){console.error("AppRun use_react: Invalid React object - Fragment not found");return}if(l.h=l.createElement=n.createElement,l.Fragment=n.Fragment,n.version&&n.version.startsWith("18")){if(!t.createRoot||typeof t.createRoot!="function"){console.error("AppRun use_react: ReactDOM.createRoot not found in React 18+");return}l.render=(r,o)=>{!r||o===void 0||(r._root||(r._root=t.createRoot(r)),r._root.render(o))}}else{if(!t.render||typeof t.render!="function"){console.error("AppRun use_react: ReactDOM.render not found in legacy React");return}l.render=(r,o)=>t.render(o,r)}},l.addComponents=Hn}const Bn=()=>l.h("div",{id:"main"},l.h("div",{id:"pages"})),qn="/api";async function N(e,n={}){const t=`${qn}${e}`;try{const r=await fetch(t,{headers:{"Content-Type":"application/json",...n.headers},...n});if(!r.ok){let o=`HTTP ${r.status}: ${r.statusText}`;try{const a=await r.json();a.error&&(o=a.error,a.code&&(o+=` (${a.code})`))}catch{}throw new Error(o)}return r}catch(r){throw console.error(`API request failed for ${e}:`,r),r}}async function re(){return(await N("/worlds")).json()}async function zn(e){if(!e)throw new Error("World name is required");return(await N(`/worlds/${encodeURIComponent(e)}`)).json()}async function Vn(e){if(!e||!e.name)throw new Error("World data with name is required");return(await N("/worlds",{method:"POST",body:JSON.stringify(e)})).json()}async function Fe(e,n){if(!e||!n)throw new Error("World name and update data are required");return(await N(`/worlds/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(n)})).json()}async function je(e){if(!e)throw new Error("World name is required");await N(`/worlds/${encodeURIComponent(e)}`,{method:"DELETE"})}async function Z(e){if(!e)throw new Error("World name is required");return(await N(`/worlds/${encodeURIComponent(e)}/agents`)).json()}async function He(e,n){if(!e||!n)throw new Error("World name and agent data are required");return(await N(`/worlds/${encodeURIComponent(e)}/agents`,{method:"POST",body:JSON.stringify(n)})).json()}async function Be(e,n,t){if(!e||!n||!t)throw new Error("World name, agent name, and update data are required");return(await N(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(n)}`,{method:"PATCH",body:JSON.stringify(t)})).json()}async function Kn(e,n){if(!e||!n)throw new Error("World name and agent name are required");await N(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(n)}`,{method:"DELETE"})}async function qe(e,n){if(!e||!n)throw new Error("World name and agent name are required");await N(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(n)}/memory`,{method:"DELETE"})}const Xn=e=>({name:e.name,description:e.description||"",turnLimit:e.turnLimit||5}),Yn=()=>({name:"",description:"",turnLimit:5}),oe=(e,n,t)=>{const r=t.target,o=n==="turnLimit"?parseInt(r.value)||5:r.value;return{...e,formData:{...e.formData,[n]:o},error:null}},Jn=async function*(e){if(!e.formData.name.trim()){yield{...e,error:"World name is required"};return}yield{...e,loading:!0,error:null};try{e.mode==="create"?await Vn(e.formData):await Fe(e.formData.name,e.formData);const n=e.mode==="create"?"World created successfully!":"World updated successfully!";yield{...e,loading:!1,successMessage:n},setTimeout(()=>{e.mode==="create"?window.location.href="/World/"+encodeURIComponent(e.formData.name):l.run("world-saved")},2e3)}catch(n){yield{...e,loading:!1,error:n.message||"Failed to save world"}}},Ce=async function*(e){yield{...e,loading:!0,error:null};try{await je(e.formData.name),yield{...e,loading:!1,successMessage:"World deleted successfully!"},setTimeout(()=>{window.location.href="/"},2e3)}catch(n){yield{...e,loading:!1,error:n.message||"Failed to delete world"}}},F=()=>{l.run("close-world-edit")},Gn=e=>({mode:e.mode||"create",formData:e.world?Xn(e.world):Yn(),loading:!1,error:null,successMessage:null});class ze extends L{constructor(){super(...arguments);S(this,"mounted",t=>Gn(t));S(this,"view",t=>{if(t.successMessage)return app.h("div",{className:"modal-backdrop",$onclick:[F]},app.h("div",{className:"modal-content",onclick:s=>s.stopPropagation()},app.h("div",{className:"modal-body"},app.h("div",{className:"success-message"},app.h("h3",null,"Success!"),app.h("p",null,t.successMessage),app.h("div",{className:"loading-spinner"},t.mode==="create"?"Redirecting to new world...":t.mode==="delete"?"Redirecting to home...":"Closing...")))));const r=t.mode==="edit",o=t.mode==="delete";let a;return o?a=`Delete ${t.formData.name||"World"}`:r?a=`Edit ${t.formData.name||"World"}`:a="Create New World",app.h("div",{className:"modal-backdrop",$onclick:[F]},app.h("div",{className:"modal-content",onclick:s=>s.stopPropagation()},app.h("div",{className:"modal-header"},app.h("h2",{className:"modal-title"},a),app.h("button",{className:"modal-close-btn",$onclick:[F],title:"Close"},"×")),app.h("div",{className:"modal-body"},t.error&&app.h("div",{className:"error-message"},t.error),o?app.h("div",{className:"delete-confirmation"},app.h("h3",null,"Delete World"),app.h("p",null,'Are you sure you want to delete "',t.formData.name,'"?'),app.h("p",null,"This action cannot be undone and will delete all agents and messages in this world.")):app.h("form",{className:"world-form"},app.h("div",{className:"form-section"},app.h("h3",{className:"section-title"},"World Configuration"),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"world-name"},"World Name *"),app.h("input",{id:"world-name",type:"text",className:"form-input",placeholder:"Enter world name",value:t.formData.name,$oninput:[oe,"name"],disabled:t.loading})),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"world-description"},"Description"),app.h("input",{id:"world-description",type:"text",className:"form-input",placeholder:"Brief description of the world",value:t.formData.description,$oninput:[oe,"description"],disabled:t.loading})),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"world-turn-limit"},"Turn Limit"),app.h("input",{id:"world-turn-limit",type:"number",className:"form-input",placeholder:"5",min:"1",max:"50",value:t.formData.turnLimit,$oninput:[oe,"turnLimit"],disabled:t.loading}))))),app.h("div",{className:"modal-footer"},app.h("div",{className:"modal-actions"},o?app.h("div",{className:"modal-primary-actions"},app.h("button",{className:"btn btn-secondary",$onclick:[F],disabled:t.loading},"Cancel"),app.h("button",{className:"btn btn-danger",$onclick:[Ce],disabled:t.loading},t.loading?"Deleting...":"Delete")):app.h(app.Fragment,null,r&&app.h("button",{className:"btn btn-danger",$onclick:[Ce],disabled:t.loading,title:"Delete world"},t.loading?"Deleting...":"Delete"),app.h("div",{className:"modal-primary-actions"},app.h("button",{className:"btn btn-secondary",$onclick:[F],disabled:t.loading},"Cancel"),app.h("button",{className:"btn btn-primary",$onclick:[Jn],disabled:t.loading||!t.formData.name.trim()},t.loading?"Saving...":r?"Update":"Create")))))))})}}class Zn extends L{constructor(){super(...arguments);S(this,"state",async()=>({worlds:await re(),currentIndex:0,loading:!1,error:null,showWorldEdit:!1,worldEditMode:"create",selectedWorldForEdit:null}));S(this,"view",t=>{var r,o,a,s;return t.loading?l.h("div",{class:"container"},l.h("div",{class:"row"},l.h("div",{class:"col"},l.h("div",{class:"loading-message"},"Loading worlds...")))):t.error?l.h("div",{class:"container"},l.h("div",{class:"row"},l.h("div",{class:"col"},l.h("div",{class:"error-message"},l.h("h3",null,"Error loading worlds"),l.h("p",null,t.error),l.h("button",{class:"btn btn-primary",$onclick:"/"},"Retry"))))):t.worlds.length===0?l.h("div",{class:"container"},l.h("div",{class:"row"},l.h("div",{class:"col"},l.h("div",{class:"no-worlds-message"},l.h("h3",null,"No worlds found"),l.h("p",null,"Create your first world to get started!"),l.h("button",{class:"btn btn-primary",$onclick:"open-world-create"},"Create World"))))):l.h("div",{class:"container"},l.h("div",{class:"row"},l.h("div",{class:"col banner-col"},l.h("h1",{class:"banner-title"},"PICK YOUR WORLD"))),l.h("div",{class:"row carousel-row"},l.h("div",{class:"col"},l.h("div",{class:"world-carousel"},l.h("button",{class:"btn carousel-arrow",$onclick:"prev-world"},"‹"),l.h("div",{class:"world-cards"},t.worlds.map((i,h)=>{const u=h===t.currentIndex;let d=!1;return t.worlds.length<=3?d=!0:d=Math.abs(h-t.currentIndex)<=1,d?l.h("button",{class:`btn world-card-btn ${u?"btn-primary center":"btn-secondary side"}`,$onclick:u?["enter-world",i]:["select-world",i]},l.h("span",{class:"world-name"},i.name)):null})),l.h("button",{class:"btn carousel-arrow",$onclick:"next-world"},"›")),l.h("div",{class:"world-indicators"},t.worlds.map((i,h)=>l.h("button",{class:`world-dot ${h===t.currentIndex?"active":""}`,$onclick:["select-world",i],title:i.name}))))),l.h("div",{class:"row"},l.h("div",{class:"col"},l.h("div",{class:"description-card"},l.h("h4",{class:"description-title"},((r=t.worlds[t.currentIndex])==null?void 0:r.name)||"Unknown World"),l.h("p",{class:"description-text"},((o=t.worlds[t.currentIndex])==null?void 0:o.description)||"No description available"),l.h("div",{class:"action-buttons"},l.h("button",{class:"btn add-world-btn",title:"Add New World",$onclick:"open-world-create"},l.h("span",{class:"plus-icon"},"+")),l.h("a",{href:"/World/"+(((a=t.worlds[t.currentIndex])==null?void 0:a.name)||"")},l.h("button",{class:"btn btn-primary enter-btn"},"Enter ",((s=t.worlds[t.currentIndex])==null?void 0:s.name)||"World")),l.h("button",{class:"btn add-world-btn delete-world-btn",title:"Delete World",$onclick:["open-world-delete",t.worlds[t.currentIndex]]},l.h("span",{class:"plus-icon"},"×")))))),t.showWorldEdit&&l.h(ze,{world:t.selectedWorldForEdit,mode:t.worldEditMode}))});S(this,"update",{"prev-world":t=>({...t,currentIndex:t.currentIndex>0?t.currentIndex-1:t.worlds.length-1}),"next-world":t=>({...t,currentIndex:t.currentIndex<t.worlds.length-1?t.currentIndex+1:0}),"select-world":(t,r)=>{const o=t.worlds.findIndex(a=>a.name===r.name);return{...t,currentIndex:o>=0?o:t.currentIndex}},"enter-world":(t,r)=>{window.location.href="/World/"+r.name},"open-world-create":t=>({...t,showWorldEdit:!0,worldEditMode:"create",selectedWorldForEdit:null}),"open-world-edit":(t,r)=>({...t,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:r}),"open-world-delete":(t,r)=>({...t,showWorldEdit:!0,worldEditMode:"delete",selectedWorldForEdit:r}),"close-world-edit":t=>({...t,showWorldEdit:!1}),"world-saved":async t=>{const r=await re();return{...t,worlds:r,showWorldEdit:!1}},"world-deleted":async t=>{const r=await re(),o=Math.min(t.currentIndex,r.length-1);return{...t,worlds:r,currentIndex:Math.max(0,o),showWorldEdit:!1}}})}}function Qn(e){const{worldName:n,messages:t=[],userInput:r="",messagesLoading:o,isSending:a,isWaiting:s,activeAgent:i,selectedAgent:h}=e,u=d=>{if(!d.fromAgentId||d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"||d.sender==="system"||d.sender==="SYSTEM")return!1;const g=d.sender.toLowerCase(),b=d.fromAgentId.toLowerCase();return!(g.includes(b)||b.includes(g))};return l.h("fieldset",{className:"chat-fieldset"},l.h("legend",null,n),l.h("div",{className:"chat-container"},l.h("div",{className:"conversation-area",ref:d=>d.scrollTop=d.scrollHeight},o?l.h("div",{className:"loading-messages"},"Loading messages..."):t.length===0?l.h("div",{className:"no-messages"},"No messages yet. Start a conversation!"):t.filter(d=>d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"||d.sender==="system"||d.sender==="SYSTEM"?!0:h!=null&&h.id&&d.fromAgentId!==h.id?!1:d.isStreaming===!0&&d.streamComplete!==!0||d.streamComplete===!0||d.streamComplete===void 0&&d.isStreaming===void 0).map((d,g)=>{const b=u(d),R=`message ${d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"?"user-message":"agent-message"} ${b?"cross-agent-message":""}`.trim();return l.h("div",{key:d.id||g,className:R},l.h("div",{className:"message-sender"},d.sender||(d.type==="user"?"User":"Agent"),b&&d.fromAgentId&&l.h("span",{className:"source-agent-indicator",title:`From agent: ${d.fromAgentId}`},"→ ",d.fromAgentId)),l.h("div",{className:"message-content"},d.text),l.h("div",{className:"message-timestamp"},d.createdAt?new Date(d.createdAt).toLocaleTimeString():"Now"),d.isStreaming&&l.h("div",{className:"streaming-indicator"},l.h("div",{className:"streaming-content"},l.h("div",{className:`agent-sprite sprite-${(i==null?void 0:i.spriteIndex)??0}`}),l.h("span",null,"responding ..."))),d.hasError&&l.h("div",{className:"error-indicator"},"Error: ",d.errorMessage))}),s&&l.h("div",{className:"message user-message waiting-message"},l.h("div",{className:"message-content"},l.h("div",{className:"waiting-dots"},l.h("span",null,"."),l.h("span",null,"."),l.h("span",null,"."))))),l.h("div",{className:"input-area"},l.h("div",{className:"input-container"},l.h("input",{type:"text",className:"message-input",placeholder:"Type your message...",value:r||"",$oninput:"update-input",$onkeypress:"key-press"}),l.h("button",{className:"send-button",$onclick:"send-message",disabled:!r.trim()||a},a?"Sending...":"Send")))))}function et(e){const{world:n,selectedSettingsTarget:t,selectedAgent:r,totalMessages:o}=e,a=()=>{t==="agent"&&r?confirm(`Clear all messages for agent ${r.name}?`)&&l.run("clear-agent-messages",r):t==="world"&&n&&confirm(`Clear all messages for world ${n.name}?`)&&l.run("clear-world-messages")};return l.h("fieldset",{className:"settings-fieldset"},l.h("legend",null,t==="agent"&&r?`${r.name} Settings`:t==="world"&&n?`${n.name} Settings`:"Settings"),l.h("div",{className:"chat-settings"},t==="agent"&&r?l.h("div",{className:"agent-settings"},l.h("div",{className:"setting-item"},l.h("label",null,"Agent Name:"),l.h("span",null,l.h("span",{className:"setting-value"},r.name),l.h("button",{className:"action-btn",$onclick:["open-agent-edit",r],title:"Edit agent"},l.h("span",{className:"btn-icon"},"⚙")))),l.h("div",{className:"setting-item"},l.h("label",null,"Message Count:"),l.h("span",null,l.h("span",{className:"setting-value"},r.messageCount),l.h("button",{className:"action-btn",onclick:a,title:"Clear agent messages"},l.h("span",{className:"btn-icon"},"×")))),l.h("div",{className:"setting-item"},l.h("label",null,"LLM Provider:"),l.h("span",{className:"setting-value"},r.provider||"N/A")),l.h("div",{className:"setting-item"},l.h("label",null,"Model:"),l.h("span",{className:"setting-value"},r.model||"N/A")),l.h("div",{className:"setting-item"},l.h("label",null,"Temperature:"),l.h("span",{className:"setting-value"},r.temperature!==void 0?r.temperature:"N/A")),l.h("div",{className:"setting-item"},l.h("label",null,"System Prompt:"),l.h("span",{className:"system-prompt-preview"},r.systemPrompt?r.systemPrompt.length>100?r.systemPrompt.substring(0,100)+"...":r.systemPrompt:"N/A"))):t==="world"&&n?l.h("div",{className:"world-settings"},l.h("div",{className:"setting-item"},l.h("label",null,"World Name:"),l.h("span",null,l.h("span",{className:"setting-value"},n.name),l.h("button",{className:"action-btn",$onclick:"open-world-edit",title:"Edit world"},l.h("span",{className:"btn-icon"},"⚙")))),l.h("div",{className:"setting-item"},l.h("label",null,"Agents Count:"),l.h("span",null,l.h("span",{className:"setting-value"},n.agents.length),l.h("button",{className:"action-btn",$onclick:"open-agent-create",title:"Add new agent"},l.h("span",{className:"btn-icon"},"+")))),l.h("div",{className:"setting-item"},l.h("label",null,"Total Messages:"),l.h("span",null,l.h("span",{className:"setting-value"},o),l.h("button",{className:"action-btn",$onclick:a,title:"Clear all messages"},l.h("span",{className:"btn-icon"},"×")))),l.h("div",{className:"setting-item"},l.h("label",null,"LLM Call Limit:"),l.h("span",{className:"setting-value"},n.llmCallLimit||"Unlimited"))):l.h("div",{className:"default-settings"},l.h("p",null,"Click on an agent or the gear icon to view settings"))))}const nt=e=>({name:e.name,description:e.description||"",provider:e.provider||"ollama",model:e.model||"llama3.2:3b",temperature:e.temperature||.7,systemPrompt:e.systemPrompt||""}),tt=()=>({name:"",description:"",provider:"ollama",model:"llama3.2:3b",temperature:.7,systemPrompt:""}),P=(e,n,t)=>{const r=t.target,o=n==="temperature"?parseFloat(r.value)||.7:r.value;return{...e,formData:{...e.formData,[n]:o},error:null}},rt=async function*(e){if(!e.formData.name.trim()){yield{...e,error:"Agent name is required"};return}yield{...e,loading:!0,error:null};try{e.mode==="create"?await He(e.worldName,e.formData):await Be(e.worldName,e.formData.name,e.formData);const n=e.mode==="create"?"Agent created successfully!":"Agent updated successfully!";yield{...e,loading:!1,successMessage:n},setTimeout(()=>{l.run("agent-saved")},2e3)}catch(n){yield{...e,loading:!1,error:n.message||"Failed to save agent"}}},ke=async function*(e){yield{...e,loading:!0,error:null};try{await Kn(e.worldName,e.formData.name),yield{...e,loading:!1,successMessage:"Agent deleted successfully!"},setTimeout(()=>{l.run("agent-deleted")},2e3)}catch(n){yield{...e,loading:!1,error:n.message||"Failed to delete agent"}}},j=()=>{l.run("close-agent-edit")},ot=e=>({mode:e.mode||"create",worldName:e.worldName,formData:e.agent?nt(e.agent):tt(),loading:!1,error:null,successMessage:null});class lt extends L{constructor(){super(...arguments);S(this,"mounted",t=>ot(t));S(this,"view",t=>{if(t.successMessage)return app.h("div",{className:"modal-backdrop",$onclick:[j]},app.h("div",{className:"modal-content",onclick:s=>s.stopPropagation()},app.h("div",{className:"modal-body"},app.h("div",{className:"success-message"},app.h("h3",null,"Success!"),app.h("p",null,t.successMessage),app.h("div",{className:"loading-spinner"},"Closing...")))));const r=t.mode==="edit",o=t.mode==="delete";let a;return o?a=`Delete ${t.formData.name||"Agent"}`:r?a=`Edit ${t.formData.name||"Agent"}`:a="Create New Agent",app.h("div",{className:"modal-backdrop",$onclick:[j]},app.h("div",{className:"modal-content",onclick:s=>s.stopPropagation()},app.h("div",{className:"modal-header"},app.h("h2",{className:"modal-title"},a),app.h("button",{className:"modal-close-btn",$onclick:[j],title:"Close"},"×")),app.h("div",{className:"modal-body"},t.error&&app.h("div",{className:"error-message"},t.error),o?app.h("div",{className:"delete-confirmation"},app.h("h3",null,"Delete Agent"),app.h("p",null,'Are you sure you want to delete "',t.formData.name,'"?'),app.h("p",null,"This action cannot be undone.")):app.h("form",{className:"agent-form"},app.h("div",{className:"form-section"},app.h("h3",{className:"section-title"},"Basic Information"),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"agent-name"},"Agent Name *"),app.h("input",{id:"agent-name",type:"text",className:"form-input",placeholder:"Enter agent name",value:t.formData.name,$oninput:[P,"name"],disabled:t.loading})),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"agent-description"},"Description"),app.h("input",{id:"agent-description",type:"text",className:"form-input",placeholder:"Brief description of the agent",value:t.formData.description,$oninput:[P,"description"],disabled:t.loading}))),app.h("div",{className:"form-section"},app.h("h3",{className:"section-title"},"LLM Configuration"),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"agent-provider"},"Provider"),app.h("select",{id:"agent-provider",className:"form-select",value:t.formData.provider,$onchange:[P,"provider"],disabled:t.loading},app.h("option",{value:""},"Select provider"),app.h("option",{value:"openai"},"OpenAI"),app.h("option",{value:"anthropic"},"Anthropic"),app.h("option",{value:"google"},"Google"),app.h("option",{value:"microsoft"},"Microsoft"),app.h("option",{value:"ollama"},"Ollama (Local)"))),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"agent-model"},"Model"),app.h("input",{id:"agent-model",type:"text",className:"form-input",placeholder:"e.g. gpt-4, claude-3-sonnet, llama3.2:3b",value:t.formData.model,$oninput:[P,"model"],disabled:t.loading})),app.h("div",{className:"form-group"},app.h("label",{htmlFor:"agent-temperature"},"Temperature"),app.h("input",{id:"agent-temperature",type:"number",className:"form-input",placeholder:"0.0 - 2.0",min:"0",max:"2",step:"0.1",value:t.formData.temperature,$oninput:[P,"temperature"],disabled:t.loading}))),app.h("div",{className:"form-section"},app.h("h3",{className:"section-title"},"System Prompt"),app.h("div",{className:"form-group"},app.h("textarea",{id:"agent-prompt",className:"form-textarea",placeholder:"Enter the system prompt for this agent...",rows:8,value:t.formData.systemPrompt,$oninput:[P,"systemPrompt"],disabled:t.loading}))))),app.h("div",{className:"modal-footer"},app.h("div",{className:"modal-actions"},o?app.h("div",{className:"modal-primary-actions"},app.h("button",{className:"btn btn-secondary",$onclick:[j],disabled:t.loading},"Cancel"),app.h("button",{className:"btn btn-danger",$onclick:[ke],disabled:t.loading},t.loading?"Deleting...":"Delete")):app.h(app.Fragment,null,r&&app.h("button",{className:"btn btn-danger",$onclick:[ke],disabled:t.loading,title:"Delete agent"},t.loading?"Deleting...":"Delete"),app.h("div",{className:"modal-primary-actions"},app.h("button",{className:"btn btn-secondary",$onclick:[j],disabled:t.loading},"Cancel"),app.h("button",{className:"btn btn-primary",$onclick:[rt],disabled:t.loading||!t.formData.name.trim()},t.loading?"Saving...":r?"Update":"Create")))))))})}}const at=e=>({...e,selectedSettingsTarget:"world",selectedAgent:null,messages:(e.messages||[]).filter(n=>!n.userEntered)}),st=(e,n)=>{var t;return e.selectedSettingsTarget==="agent"&&((t=e.selectedAgent)==null?void 0:t.id)===n.id?{...e,selectedSettingsTarget:"world",selectedAgent:null,messages:(e.messages||[]).filter(r=>!r.userEntered)}:{...e,selectedSettingsTarget:"agent",selectedAgent:n,messages:(e.messages||[]).filter(r=>!r.userEntered)}},it=async(e,n)=>{var t;try{await qe(e.worldName,n.name);const r=e.agents.map(i=>i.id===n.id?{...i,messageCount:0}:i),o=(e.messages||[]).filter(i=>i.sender!==n.name),a=((t=e.selectedAgent)==null?void 0:t.id)===n.id?{...e.selectedAgent,messageCount:0}:e.selectedAgent,s=e.world?{...e.world,agents:r}:null;return{...e,world:s,agents:r,messages:o,selectedAgent:a}}catch(r){return{...e,error:r.message||"Failed to clear agent messages"}}},ct=async e=>{try{await Promise.all(e.agents.map(o=>qe(e.worldName,o.name)));const n=e.agents.map(o=>({...o,messageCount:0})),t=e.selectedAgent?{...e.selectedAgent,messageCount:0}:null,r=e.world?{...e.world,agents:n}:null;return{...e,world:r,agents:n,messages:[],selectedAgent:t}}catch(n){return{...e,error:n.message||"Failed to clear world messages"}}},dt=(e,n,t)=>{const r=n==="edit"&&t?{name:t.name,description:t.description||"",provider:t.provider||"",model:t.model||"",temperature:t.temperature||.7,systemPrompt:t.systemPrompt||""}:{name:"",description:"",provider:"",model:"",temperature:.7,systemPrompt:""};return{...e,agentEdit:{isOpen:!0,mode:n,selectedAgent:t||null,formData:r,loading:!1,error:null}}},ut=e=>({...e,agentEdit:{...e.agentEdit,isOpen:!1,error:null}}),pt=(e,n,t)=>{const r=t.target;let o;return r.type==="number"?o=parseFloat(r.value)||0:o=r.value,{...e,agentEdit:{...e.agentEdit,formData:{...e.agentEdit.formData,[n]:o},error:null}}},ht=async function*(e){if(!e.agentEdit.formData.name.trim()){yield{...e,agentEdit:{...e.agentEdit,error:"Agent name is required"}};return}try{yield{...e,agentEdit:{...e.agentEdit,loading:!0,error:null}};const n={name:e.agentEdit.formData.name,description:e.agentEdit.formData.description,provider:e.agentEdit.formData.provider,model:e.agentEdit.formData.model,temperature:e.agentEdit.formData.temperature,systemPrompt:e.agentEdit.formData.systemPrompt,type:"default"};e.agentEdit.mode==="create"?await He(e.worldName,n):e.agentEdit.selectedAgent&&await Be(e.worldName,e.agentEdit.selectedAgent.name,n);const t=await Z(e.worldName),r=e.world?{...e.world,agents:t}:null;yield{...e,agents:t,world:r,agentEdit:{...e.agentEdit,isOpen:!1,loading:!1}}}catch(n){yield{...e,agentEdit:{...e.agentEdit,loading:!1,error:n.message||"Failed to save agent"}}}},Ve=async function*(e,n){var t,r;if(!(!n||!e.agentEdit.selectedAgent)&&confirm(`Are you sure you want to delete agent "${e.agentEdit.selectedAgent.name}"?`))try{yield{...e,agentEdit:{...e.agentEdit,loading:!0,error:null}},await Ve(e.worldName,e.agentEdit.selectedAgent.name);const o=await Z(e.worldName),a=e.world?{...e.world,agents:o}:null;yield{...e,agents:o,world:a,agentEdit:{...e.agentEdit,isOpen:!1,loading:!1},selectedAgent:((t=e.selectedAgent)==null?void 0:t.id)===n?null:e.selectedAgent,selectedSettingsTarget:((r=e.selectedAgent)==null?void 0:r.id)===n?"world":e.selectedSettingsTarget}}catch(o){yield{...e,agentEdit:{...e.agentEdit,loading:!1,error:o.message||"Failed to delete agent"}}}},_e={"select-world-settings":at,"select-agent-settings":st,"clear-agent-messages":it,"clear-world-messages":ct,"open-agent-edit":dt,"close-agent-edit":ut,"update-agent-form":pt,"save-agent":ht,"delete-agent":Ve},mt=e=>{var n,t,r;return{...e,worldEdit:{...e.worldEdit,isOpen:!0,mode:"edit",selectedWorld:e.world,formData:{name:((n=e.world)==null?void 0:n.name)||"",description:((t=e.world)==null?void 0:t.description)||"",turnLimit:((r=e.world)==null?void 0:r.turnLimit)||5},error:null}}},gt=e=>({...e,worldEdit:{...e.worldEdit,isOpen:!1,error:null}}),ft=(e,n,t)=>{const r=t.target,o=n==="turnLimit"?parseInt(r.value)||5:r.value;return{...e,worldEdit:{...e.worldEdit,formData:{...e.worldEdit.formData,[n]:o},error:null}}},yt=async e=>{const{formData:n,selectedWorld:t}=e.worldEdit;if(!n.name.trim())return{...e,worldEdit:{...e.worldEdit,error:"World name is required"}};if(!t)return{...e,worldEdit:{...e.worldEdit,error:"No world selected for editing"}};try{const r={...e,worldEdit:{...e.worldEdit,loading:!0,error:null}},o=await Fe(t.name,{name:n.name,description:n.description,turnLimit:n.turnLimit});return n.name!==t.name?(window.location.href="/World/"+encodeURIComponent(n.name),e):{...e,world:{...e.world,...o},worldEdit:{...e.worldEdit,isOpen:!1,loading:!1,error:null}}}catch(r){return{...e,worldEdit:{...e.worldEdit,loading:!1,error:r instanceof Error?r.message:"Failed to save world"}}}},wt=async(e,n)=>{if(!n||!confirm(`Are you sure you want to delete "${n}"? This action cannot be undone.`))return e;try{return await je(n),window.location.href="/",e}catch(t){return{...e,worldEdit:{...e.worldEdit,error:t instanceof Error?t.message:"Failed to delete world"}}}},bt={"open-world-edit":mt,"close-world-edit":gt,"update-world-form":ft,"save-world":yt,"delete-world":wt},vt={"/World":async function*(e,n){const t=n?decodeURIComponent(n):"New World";try{yield{...e,worldName:t,loading:!0,error:null,isWaiting:!1,activeAgent:null};const r=await zn(t),o=new Map,a=await Promise.all(r.agents.map(async(i,h)=>{var d;i.memory&&Array.isArray(i.memory)&&i.memory.forEach(g=>{const b=`${g.createdAt||Date.now()}-${g.text||g.content||""}`;if(!o.has(b)){const _=g.sender||i.name;let C="agent";(_==="HUMAN"||_==="USER")&&(C="user"),o.set(b,{id:g.id||b,sender:_,text:g.text||g.content||"",createdAt:g.createdAt||new Date().toISOString(),type:C,streamComplete:!0,fromAgentId:i.id})}});const u=i.systemPrompt||"";return{...i,spriteIndex:h%9,messageCount:((d=i.memory)==null?void 0:d.length)||0,provider:i.provider||"openai",model:i.model||"gpt-4",temperature:i.temperature??.7,systemPrompt:u,description:i.description||"",type:i.type||"default",status:i.status||"active",llmCallCount:i.llmCallCount||0,memory:i.memory||[],createdAt:i.createdAt||new Date,lastActive:i.lastActive||new Date}})),s=Array.from(o.values()).sort((i,h)=>{const u=new Date(i.createdAt).getTime(),d=new Date(h.createdAt).getTime();return u-d});yield{...e,worldName:t,world:{name:t,agents:a,llmCallLimit:r.llmCallLimit||r.turnLimit},agents:a,messages:s,loading:!1,error:null,isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null}}catch(r){yield{...e,worldName:t,world:{name:t,agents:[],llmCallLimit:void 0},loading:!1,error:r.message||"Failed to load world data",isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null}}}},k=(e,n)=>{l!=null&&l.run?l.run(e,n):console.warn("AppRun app not available for event:",e)};let A={activeMessages:new Map,currentWorldName:null};const Et=e=>{var n;!e||typeof e!="object"||(e.type==="sse"?St(e):e.type==="message"?k("handleMessage",e):e.type==="response"||(e.type==="error"?k("handleError",{message:e.message||"SSE error"}):e.type==="connected"?(k("handleConnectionStatus","connected"),A.currentWorldName=((n=e.payload)==null?void 0:n.worldName)||null):e.type==="complete"&&k("handleComplete",e.payload)))},St=e=>{const n=e.data;if(!n)return;const t=n.messageId||"default",r=n.sender||"Agent";switch(n.type){case"start":A.activeMessages.set(t,{content:"",sender:r,messageId:t,isStreaming:!0}),k("handleStreamStart",{messageId:t,sender:r,worldName:n.worldName||A.currentWorldName});break;case"chunk":const o=A.activeMessages.get(t);if(o){const s=n.accumulatedContent!==void 0?n.accumulatedContent:o.content+(n.content||"");o.content=s,k("handleStreamChunk",{messageId:t,sender:r,content:s,isAccumulated:n.accumulatedContent!==void 0,worldName:n.worldName||A.currentWorldName})}break;case"end":const a=A.activeMessages.get(t);if(a){const s=n.finalContent!==void 0?n.finalContent:a.content;k("handleStreamEnd",{messageId:t,sender:r,content:s,worldName:n.worldName||A.currentWorldName}),A.activeMessages.delete(t),A.activeMessages.size}break;case"error":k("handleStreamError",{messageId:t,sender:r,error:n.error||"Streaming error",worldName:n.worldName||A.currentWorldName}),A.activeMessages.delete(t);break}};async function At(e,n,t="HUMAN",r,o,a){if(!e||!n)throw new Error("World name and message are required");if(!n.trim())throw new Error("Message cannot be empty");A.currentWorldName=e;const s={message:n,sender:t},h=(await N(`/worlds/${encodeURIComponent(e)}/chat`,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"}})).body.getReader(),u=new TextDecoder;let d="",g=!0;const b=()=>{if(g){g=!1;try{h.cancel()}catch(C){console.warn("Error canceling SSE reader:",C)}}};return(async()=>{try{for(;g;){const{done:C,value:R}=await h.read();if(C)break;d+=u.decode(R,{stream:!0});const me=d.split(`
`);d=me.pop()||"";for(const Q of me)if(Q.trim()!==""&&Q.startsWith("data: "))try{const z=Q.slice(6).trim();if(z==="")continue;const ee=JSON.parse(z);Et(ee),ee.type}catch(z){console.error("Error parsing SSE data:",z),k("handleError",{message:"Failed to parse SSE data"})}}}catch(C){console.error("SSE stream error:",C);const R={message:C.message||"SSE stream error"};k("handleError",R)}finally{b()}})(),b}const Nt=(e,n)=>{const{messageId:t,sender:r,worldName:o}=n,a=r||"Agent";let s;if("agents"in e&&Array.isArray(e.agents)){const i=e.agents.find(h=>h.name===a);s=i==null?void 0:i.id}return{...e,messages:[...e.messages||[],{id:Date.now()+Math.random(),type:"agent-stream",sender:a,text:"",createdAt:new Date().toISOString(),worldName:o||e.worldName,isStreaming:!0,messageId:t,fromAgentId:s}],needScroll:!0}},Ct=(e,n)=>{const{messageId:t,sender:r,content:o,isAccumulated:a}=n,s=[...e.messages||[]];for(let i=s.length-1;i>=0;i--)if(s[i].isStreaming&&(s[i].messageId===t||!t&&s[i].sender===r&&s[i].type==="agent-stream"))return s[i]={...s[i],text:o||"",createdAt:new Date().toISOString()},{...e,messages:s,needScroll:!0};return{...e,messages:[...s,{id:Date.now()+Math.random(),type:"agent-stream",sender:r||"Agent",text:o||"",createdAt:new Date().toISOString(),worldName:n.worldName||e.worldName,isStreaming:!0,messageId:t}],needScroll:!0}},kt=(e,n)=>{const{messageId:t,sender:r,content:o}=n,a=(e.messages||[]).filter(s=>!(s.isStreaming&&(s.messageId===t||!t&&s.sender===r&&s.type==="agent-stream")));return{...e,messages:a}},_t=(e,n)=>{const{messageId:t,sender:r,error:o}=n,a=(e.messages||[]).map(s=>s.isStreaming&&(s.messageId===t||!t&&s.sender===r&&s.type==="agent-stream")?{...s,isStreaming:!1,hasError:!0,errorMessage:o}:s);return{...e,messages:a}},Mt=(e,n)=>{const t=n.data||{},r=t.sender||t.agentName||"Agent";let o;if("agents"in e&&Array.isArray(e.agents)){const s=e.agents.find(i=>i.name===r);o=s==null?void 0:s.id}const a={id:Date.now()+Math.random(),type:t.type||"message",sender:r,text:t.content||t.message||"",createdAt:t.createdAt||new Date().toISOString(),worldName:t.worldName||e.worldName,fromAgentId:o};return{...e,messages:[...e.messages||[],a],needScroll:!0,isWaiting:!1}},xt=(e,n)=>({...e,connectionStatus:n,wsError:n==="error"?e.wsError:null}),Dt=(e,n)=>{const t=n.message||"SSE error",r={id:Date.now()+Math.random(),type:"error",sender:"System",text:t,createdAt:new Date().toISOString(),worldName:e.worldName,hasError:!0};return{...e,wsError:t,messages:[...e.messages||[],r],needScroll:!0}},Wt=(e,n)=>({...e,connectionStatus:"completed"}),Lt={"update-input":(e,n)=>({...e,userInput:n.target.value}),"key-press":(e,n)=>{n.key==="Enter"&&(e.userInput||"").trim()&&l.run("send-message")},"send-message":async e=>{if(!(e.userInput||"").trim())return e;const n=e.userInput||"",t={id:Date.now()+Math.random(),type:"user",sender:"HUMAN",text:n,createdAt:new Date().toISOString(),worldName:e.worldName,userEntered:!0},r={...e,messages:[...e.messages||[],t],userInput:"",isSending:!0,isWaiting:!0};try{return await At(e.worldName,n,"HUMAN"),{...r,isSending:!1}}catch(o){return{...r,isSending:!1,isWaiting:!1,error:o.message||"Failed to send message"}}},handleStreamStart:(e,n)=>{const t=Nt(e,n),r=n.sender,o=e.agents.find(a=>a.name===r);return{...t,isWaiting:!1,activeAgent:o?{spriteIndex:o.spriteIndex,name:o.name}:null}},handleStreamChunk:(e,n)=>Ct(e,n),handleStreamEnd:(e,n)=>{var a;const t=kt(e,n),r=n.sender;let o={...t,activeAgent:null};if(r&&r!=="HUMAN"){const s=o.agents.map(u=>u.name===r?{...u,messageCount:u.messageCount+1}:u),i=o.world?{...o.world,agents:s}:null,h=((a=o.selectedAgent)==null?void 0:a.name)===r?{...o.selectedAgent,messageCount:o.selectedAgent.messageCount+1}:o.selectedAgent;o={...o,world:i,agents:s,selectedAgent:h}}return o},handleStreamError:(e,n)=>({..._t(e,n),activeAgent:null}),handleMessage:(e,n)=>Mt(e,n),handleConnectionStatus:(e,n)=>xt(e,n),handleError:(e,n)=>Dt(e,n),handleComplete:(e,n)=>Wt(e)};class Tt extends L{constructor(){super(...arguments);S(this,"is_global_event",()=>!0);S(this,"state",async()=>({worldName:"World",world:null,agents:[],messages:[],userInput:"",loading:!0,error:null,messagesLoading:!1,isSending:!1,isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null,showAgentEdit:!1,agentEditMode:"create",selectedAgentForEdit:null,showWorldEdit:!1,worldEditMode:"edit",selectedWorldForEdit:null,connectionStatus:"disconnected",wsError:null,needScroll:!1}));S(this,"view",t=>{var r;return t.loading?l.h("div",{className:"world-container"},l.h("div",{className:"world-columns"},l.h("div",{className:"chat-column"},l.h("div",{className:"agents-section"},l.h("div",{className:"agents-row"},l.h("div",{className:"loading-agents"},"Loading..."))),l.h("div",{className:"loading-state"},l.h("p",null,"Loading world data..."))),l.h("div",{className:"settings-column"},l.h("div",{className:"settings-section"},l.h("div",{className:"settings-row"},l.h("button",{className:"world-settings-btn",title:"World Settings"},l.h("span",{className:"world-gear-icon"},"⚙"))))))):t.error?l.h("div",{className:"world-container"},l.h("div",{className:"world-columns"},l.h("div",{className:"chat-column"},l.h("div",{className:"agents-section"},l.h("div",{className:"agents-row"},l.h("div",{className:"no-agents"},"Error"))),l.h("div",{className:"error-state"},l.h("p",null,"Error: ",t.error),l.h("button",{$onclick:["/World",t.worldName]},"Retry"))),l.h("div",{className:"settings-column"},l.h("div",{className:"settings-section"},l.h("div",{className:"settings-row"},l.h("button",{className:"world-settings-btn",title:"World Settings"},l.h("span",{className:"world-gear-icon"},"⚙"))))))):l.h("div",{className:"world-container"},l.h("div",{className:"world-columns"},l.h("div",{className:"chat-column"},l.h("div",{className:"agents-section"},l.h("div",{className:"agents-row"},t.loading?l.h("div",{className:"loading-agents"},"Loading agents..."):(r=t.agents)!=null&&r.length?l.h("div",{className:"agents-list"},t.agents.map((o,a)=>{var i;const s=t.selectedSettingsTarget==="agent"&&((i=t.selectedAgent)==null?void 0:i.id)===o.id;return l.h("div",{key:`agent-${o.id||a}`,className:`agent-item ${s?"selected":""}`,$onclick:["select-agent-settings",o]},l.h("div",{className:"agent-sprite-container"},l.h("div",{className:`agent-sprite sprite-${o.spriteIndex}`}),l.h("div",{className:"message-badge"},o.messageCount)),l.h("div",{className:"agent-name"},o.name))})):l.h("div",{className:"no-agents"},"No agents in this world"))),l.h(Qn,{worldName:t.worldName,messages:t.messages,userInput:t.userInput,messagesLoading:t.messagesLoading,isSending:t.isSending,isWaiting:t.isWaiting,activeAgent:t.activeAgent,selectedAgent:t.selectedSettingsTarget==="agent"?t.selectedAgent:null})),l.h("div",{className:"settings-column"},l.h("div",{className:"settings-section"},l.h("div",{className:"settings-row"},l.h("button",{className:"world-settings-btn",title:"World Settings",$onclick:"select-world-settings"},l.h("span",{className:"world-gear-icon"},"⊕")))),l.h(et,{world:t.world,selectedSettingsTarget:t.selectedSettingsTarget,selectedAgent:t.selectedAgent,totalMessages:(t.messages||[]).length}))),t.showAgentEdit&&l.h(lt,{agent:t.selectedAgentForEdit,mode:t.agentEditMode,worldName:t.worldName}),t.showWorldEdit&&l.h(ze,{world:t.selectedWorldForEdit,mode:t.worldEditMode}))});S(this,"update",{...vt,...Lt,..._e,...bt,"select-agent-settings":(t,r)=>{const o=_e["select-agent-settings"](t,r);return o.selectedSettingsTarget==="agent"&&o.selectedAgent?{...o,userInput:"@"+o.selectedAgent.name+" "}:o},"open-agent-create":t=>({...t,showAgentEdit:!0,agentEditMode:"create",selectedAgentForEdit:null}),"open-agent-edit":(t,r)=>({...t,showAgentEdit:!0,agentEditMode:"edit",selectedAgentForEdit:r}),"open-agent-delete":(t,r)=>({...t,showAgentEdit:!0,agentEditMode:"delete",selectedAgentForEdit:r}),"close-agent-edit":t=>({...t,showAgentEdit:!1}),"agent-saved":async t=>{const r=await Z(t.worldName);return{...t,agents:r,showAgentEdit:!1}},"agent-deleted":async t=>{const r=await Z(t.worldName);return{...t,agents:r,showAgentEdit:!1}},"open-world-edit":t=>({...t,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:t.world}),"close-world-edit":t=>({...t,showWorldEdit:!1}),"world-saved":t=>({...t,showWorldEdit:!1}),"world-deleted":t=>({...t,showWorldEdit:!1})})}}l.render("#root",l.h(Bn,null));l.addComponents("#pages",{"/":Zn,"/World":Tt});
