var dl=Object.defineProperty;var hl=(t,e,n)=>e in t?dl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var x=(t,e,n)=>hl(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}})();const mr="3.38.0",pl=`AppRun-${mr}`;class br{constructor(){this._events={}}on(e,n,r={}){this._events[e]=this._events[e]||[],this._events[e].push({fn:n,options:r})}off(e,n){const r=this._events[e]||[];this._events[e]=r.filter(l=>l.fn!==n)}find(e){return this._events[e]}run(e,...n){const r=this.getSubscribers(e,this._events);return console.assert(r&&r.length>0,"No subscriber for event: "+e),r.forEach(l=>{const{fn:o,options:a}=l;if(!o||typeof o!="function")return console.error(`AppRun event handler for '${e}' is not a function:`,o),!1;if(a.delay)this.delay(e,o,n,a);else try{Object.keys(a).length>0?o.apply(this,[...n,a]):o.apply(this,n)}catch(i){console.error(`Error in event handler for '${e}':`,i)}return!l.options.once}),r.length}once(e,n,r={}){this.on(e,n,{...r,once:!0})}delay(e,n,r,l){l._t&&clearTimeout(l._t),l._t=setTimeout(()=>{clearTimeout(l._t);try{Object.keys(l).length>0?n.apply(this,[...r,l]):n.apply(this,r)}catch(o){console.error(`Error in delayed event handler for '${e}':`,o)}},l.delay)}runAsync(e,...n){const r=this.getSubscribers(e,this._events);console.assert(r&&r.length>0,"No subscriber for event: "+e);const l=r.map(o=>{const{fn:a,options:i}=o;if(!a||typeof a!="function")return console.error(`AppRun async event handler for '${e}' is not a function:`,a),Promise.resolve(null);try{return Object.keys(i).length>0?a.apply(this,[...n,i]):a.apply(this,n)}catch(h){return console.error(`Error in async event handler for '${e}':`,h),Promise.reject(h)}});return Promise.all(l)}query(e,...n){return console.warn("app.query() is deprecated. Use app.runAsync() instead."),this.runAsync(e,...n)}getSubscribers(e,n){const r=n[e]||[];return n[e]=r.filter(l=>!l.options.once),Object.keys(n).filter(l=>l.endsWith("*")&&e.startsWith(l.replace("*",""))).sort((l,o)=>o.length-l.length).forEach(l=>r.push(...n[l].map(o=>({...o,options:{...o.options,event:e}})))),r}}const fl=pl;let dt;const ze=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};ze.app&&ze._AppRunVersions?dt=ze.app:(dt=new br,ze.app=dt,ze._AppRunVersions=fl);const T=dt;function be(t){return(t==null?void 0:t.target)instanceof HTMLElement?t.target:null}function gl(t,e=document){try{return e.querySelector(t)}catch(n){return console.warn(`Invalid selector: ${t}`,n),null}}function ml(t){try{return document.getElementById(t)}catch(e){return console.warn(`Error getting element by id: ${t}`,e),null}}const yr=t=>{if(!t)return[];const e=[];let n="",r=!1,l="";for(let o=0;o<t.length;o++){const a=t[o];a==="["&&!r?(n&&(e.push(n),n=""),r=!0):a==="]"&&r?(l?n=n.slice(1,-1):/^\d+$/.test(n)&&(n=parseInt(n,10)),e.push(n),n="",r=!1,l=""):(a==='"'||a==="'")&&r?(l?a===l&&(l=""):l=a,n+=a):a==="."&&!r?n&&(e.push(n),n=""):n+=a}return n&&e.push(n),e},bl=(t,e)=>{let n=t;for(const r of e){if(n==null)return;n=n[r]}return n},yl=(t,e,n)=>{if(e.length===0)return n;const r={...t};let l=r;for(let o=0;o<e.length-1;o++){const a=e[o],i=e[o+1];l[a]==null?l[a]=typeof i=="number"?[]:{}:Array.isArray(l[a])?l[a]=[...l[a]]:typeof l[a]=="object"&&(l[a]={...l[a]}),l=l[a]}return l[e[e.length-1]]=n,r},ye=(t,e)=>{if(!e)return t.state||"";const n=yr(e),r=bl(t.state,n);return r!==void 0?r:""},we=(t,e,n)=>{if(!e){t.setState(n);return}const r=yr(e),l=t.state||{},o=yl(l,r,n);t.setState(o)},wl=(t,e,n,r)=>{if(t.startsWith("$on")){const l=e[t];if(t=t.substring(1),typeof l=="boolean")e[t]=o=>r.run?r.run(t,o):T.run(t,o);else if(typeof l=="string")e[t]=o=>r.run?r.run(l,o):T.run(l,o);else if(typeof l=="function")e[t]=o=>r.setState(l(r.state,o));else if(Array.isArray(l)){const[o,...a]=l;typeof o=="string"?e[t]=i=>r.run?r.run(o,...a,i):T.run(o,...a,i):typeof o=="function"&&(e[t]=i=>r.setState(o(r.state,...a,i)))}}else if(t==="$bind"){const l=e.type||"text",o=typeof e[t]=="string"?e[t]:e.name;if(n==="input")switch(l){case"checkbox":e.checked=ye(r,o),e.onclick=a=>{const i=be(a);i&&we(r,o||i.name,i.checked)};break;case"radio":e.checked=ye(r,o)===e.value,e.onclick=a=>{const i=be(a);i&&we(r,o||i.name,i.value)};break;case"number":case"range":e.value=ye(r,o),e.oninput=a=>{const i=be(a);i&&we(r,o||i.name,Number(i.value))};break;default:e.value=ye(r,o),e.oninput=a=>{const i=be(a);i&&we(r,o||i.name,i.value)}}else n==="select"?(e.value=ye(r,o),e.onchange=a=>{const i=be(a);i&&!i.multiple&&we(r,o||i.name,i.value)}):n==="option"?(e.selected=ye(r,o),e.onclick=a=>{const i=be(a);i&&we(r,o||i.name,i.selected)}):n==="textarea"&&(e.innerHTML=ye(r,o),e.oninput=a=>{const i=be(a);i&&we(r,o||i.name,i.value)})}else T.run("$",{key:t,tag:n,props:e,component:r})},mt=(t,e)=>{if(Array.isArray(t))return t.map(n=>mt(n,e));{let{type:n,tag:r,props:l,children:o}=t;return r=r||n,o=o||(l==null?void 0:l.children),l&&Object.keys(l).forEach(a=>{a.startsWith("$")&&(wl(a,l,r,e),delete l[a])}),o&&mt(o,e),t}};class Ke{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}Ke.prototype.normal={};Ke.prototype.property={};Ke.prototype.space=void 0;function wr(t,e){const n={},r={};for(const l of t)Object.assign(n,l.property),Object.assign(r,l.normal);return new Ke(n,r,e)}function Yt(t){return t.toLowerCase()}class X{constructor(e,n){this.attribute=n,this.property=e}}X.prototype.attribute="";X.prototype.booleanish=!1;X.prototype.boolean=!1;X.prototype.commaOrSpaceSeparated=!1;X.prototype.commaSeparated=!1;X.prototype.defined=!1;X.prototype.mustUseProperty=!1;X.prototype.number=!1;X.prototype.overloadedBoolean=!1;X.prototype.property="";X.prototype.spaceSeparated=!1;X.prototype.space=void 0;let kl=0;const k=ve(),M=ve(),Zt=ve(),p=ve(),_=ve(),Oe=ve(),K=ve();function ve(){return 2**++kl}const Xt=Object.freeze(Object.defineProperty({__proto__:null,boolean:k,booleanish:M,commaOrSpaceSeparated:K,commaSeparated:Oe,number:p,overloadedBoolean:Zt,spaceSeparated:_},Symbol.toStringTag,{value:"Module"})),zt=Object.keys(Xt);class sn extends X{constructor(e,n,r,l){let o=-1;if(super(e,n),Bn(this,"space",l),typeof r=="number")for(;++o<zt.length;){const a=zt[o];Bn(this,zt[o],(r&Xt[a])===Xt[a])}}}sn.prototype.defined=!0;function Bn(t,e,n){n&&(t[e]=n)}function De(t){const e={},n={};for(const[r,l]of Object.entries(t.properties)){const o=new sn(r,t.transform(t.attributes||{},r),l,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),e[r]=o,n[Yt(r)]=r,n[Yt(o.attribute)]=r}return new Ke(e,n,t.space)}const kr=De({properties:{ariaActiveDescendant:null,ariaAtomic:M,ariaAutoComplete:null,ariaBusy:M,ariaChecked:M,ariaColCount:p,ariaColIndex:p,ariaColSpan:p,ariaControls:_,ariaCurrent:null,ariaDescribedBy:_,ariaDetails:null,ariaDisabled:M,ariaDropEffect:_,ariaErrorMessage:null,ariaExpanded:M,ariaFlowTo:_,ariaGrabbed:M,ariaHasPopup:null,ariaHidden:M,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:_,ariaLevel:p,ariaLive:null,ariaModal:M,ariaMultiLine:M,ariaMultiSelectable:M,ariaOrientation:null,ariaOwns:_,ariaPlaceholder:null,ariaPosInSet:p,ariaPressed:M,ariaReadOnly:M,ariaRelevant:null,ariaRequired:M,ariaRoleDescription:_,ariaRowCount:p,ariaRowIndex:p,ariaRowSpan:p,ariaSelected:M,ariaSetSize:p,ariaSort:null,ariaValueMax:p,ariaValueMin:p,ariaValueNow:p,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function xr(t,e){return e in t?t[e]:e}function Ar(t,e){return xr(t,e.toLowerCase())}const xl=De({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Oe,acceptCharset:_,accessKey:_,action:null,allow:null,allowFullScreen:k,allowPaymentRequest:k,allowUserMedia:k,alt:null,as:null,async:k,autoCapitalize:null,autoComplete:_,autoFocus:k,autoPlay:k,blocking:_,capture:null,charSet:null,checked:k,cite:null,className:_,cols:p,colSpan:null,content:null,contentEditable:M,controls:k,controlsList:_,coords:p|Oe,crossOrigin:null,data:null,dateTime:null,decoding:null,default:k,defer:k,dir:null,dirName:null,disabled:k,download:Zt,draggable:M,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:k,formTarget:null,headers:_,height:p,hidden:Zt,high:p,href:null,hrefLang:null,htmlFor:_,httpEquiv:_,id:null,imageSizes:null,imageSrcSet:null,inert:k,inputMode:null,integrity:null,is:null,isMap:k,itemId:null,itemProp:_,itemRef:_,itemScope:k,itemType:_,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:k,low:p,manifest:null,max:null,maxLength:p,media:null,method:null,min:null,minLength:p,multiple:k,muted:k,name:null,nonce:null,noModule:k,noValidate:k,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:k,optimum:p,pattern:null,ping:_,placeholder:null,playsInline:k,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:k,referrerPolicy:null,rel:_,required:k,reversed:k,rows:p,rowSpan:p,sandbox:_,scope:null,scoped:k,seamless:k,selected:k,shadowRootClonable:k,shadowRootDelegatesFocus:k,shadowRootMode:null,shape:null,size:p,sizes:null,slot:null,span:p,spellCheck:M,src:null,srcDoc:null,srcLang:null,srcSet:null,start:p,step:null,style:null,tabIndex:p,target:null,title:null,translate:null,type:null,typeMustMatch:k,useMap:null,value:M,width:p,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:_,axis:null,background:null,bgColor:null,border:p,borderColor:null,bottomMargin:p,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:k,declare:k,event:null,face:null,frame:null,frameBorder:null,hSpace:p,leftMargin:p,link:null,longDesc:null,lowSrc:null,marginHeight:p,marginWidth:p,noResize:k,noHref:k,noShade:k,noWrap:k,object:null,profile:null,prompt:null,rev:null,rightMargin:p,rules:null,scheme:null,scrolling:M,standby:null,summary:null,text:null,topMargin:p,valueType:null,version:null,vAlign:null,vLink:null,vSpace:p,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:k,disableRemotePlayback:k,prefix:null,property:null,results:p,security:null,unselectable:null},space:"html",transform:Ar}),Al=De({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:K,accentHeight:p,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:p,amplitude:p,arabicForm:null,ascent:p,attributeName:null,attributeType:null,azimuth:p,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:p,by:null,calcMode:null,capHeight:p,className:_,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:p,diffuseConstant:p,direction:null,display:null,dur:null,divisor:p,dominantBaseline:null,download:k,dx:null,dy:null,edgeMode:null,editable:null,elevation:p,enableBackground:null,end:null,event:null,exponent:p,externalResourcesRequired:null,fill:null,fillOpacity:p,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Oe,g2:Oe,glyphName:Oe,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:p,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:p,horizOriginX:p,horizOriginY:p,id:null,ideographic:p,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:p,k:p,k1:p,k2:p,k3:p,k4:p,kernelMatrix:K,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:p,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:p,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:p,overlineThickness:p,paintOrder:null,panose1:null,path:null,pathLength:p,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:_,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:p,pointsAtY:p,pointsAtZ:p,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:K,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:K,rev:K,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:K,requiredFeatures:K,requiredFonts:K,requiredFormats:K,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:p,specularExponent:p,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:p,strikethroughThickness:p,string:null,stroke:null,strokeDashArray:K,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:p,strokeOpacity:p,strokeWidth:null,style:null,surfaceScale:p,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:K,tabIndex:p,tableValues:null,target:null,targetX:p,targetY:p,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:K,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:p,underlineThickness:p,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:p,values:null,vAlphabetic:p,vMathematical:p,vectorEffect:null,vHanging:p,vIdeographic:p,version:null,vertAdvY:p,vertOriginX:p,vertOriginY:p,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:p,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:xr}),Sr=De({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),vr=De({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Ar}),Er=De({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),Sl=/[A-Z]/g,qn=/-[a-z]/g,vl=/^data[-\w.:]+$/i;function El(t,e){const n=Yt(e);let r=e,l=X;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&vl.test(e)){if(e.charAt(4)==="-"){const o=e.slice(5).replace(qn,_l);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=e.slice(4);if(!qn.test(o)){let a=o.replace(Sl,Tl);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}l=sn}return new l(r,e)}function Tl(t){return"-"+t.toLowerCase()}function _l(t){return t.charAt(1).toUpperCase()}const Nl=wr([kr,xl,Sr,vr,Er],"html"),Cl=wr([kr,Al,Sr,vr,Er],"svg"),jn="_props",Gn=new Map;function Rl(t,e){if(e&&(e.class=e.class||e.className,delete e.className),!t||Object.keys(t).length===0)return e||{};if(!e||Object.keys(e).length===0){const r={};return Object.keys(t).forEach(l=>r[l]=null),r}const n={};return Object.keys(t).forEach(r=>{r in e||(n[r]=null)}),Object.keys(e).forEach(r=>n[r]=e[r]),n}function Ll(t){return t.length<=1?t.toLowerCase():t.split("-").map((e,n)=>n===0?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("")}function Ml(t,e){const n=`${t}:${e}`;let r=Gn.get(n);return r===void 0&&(r=El(e?Cl:Nl,t)||null,Gn.set(n,r)),r}function Il(t,e,n){const r=Ll(e.slice(5));n==null?delete t.dataset[r]:t.dataset[r]=String(n)}function Ol(t,e,n){e.startsWith("on")&&(!n||typeof n=="function"?t[e]=n:typeof n=="string"&&(n?t.setAttribute(e,n):t.removeAttribute(e)))}function Vn(t,e,n){Dl(n)?t.setAttribute(e,e):t.removeAttribute(e)}function st(t,e,n){try{t[e]=n}catch{ht(t,e,n,!1)}}function ht(t,e,n,r){if(n==null){t.removeAttribute(e);return}const l=String(n);if(r&&e.includes(":")){const[o]=e.split(":");o==="xlink"?t.setAttributeNS("http://www.w3.org/1999/xlink",e,l):t.setAttribute(e,l)}else t.setAttribute(e,l)}function Dl(t){return t==null||t===!1||t===""?!1:t===!0?!0:typeof t=="string"?t.toLowerCase()!=="false"&&t!=="0":!!t}function Pl(t,e,n,r){if($l(t,e))return;if(e==="style"){if(t.style.cssText&&(t.style.cssText=""),typeof n=="string")t.style.cssText=n;else if(n&&typeof n=="object")for(const o in n)t.style[o]!==n[o]&&(t.style[o]=n[o]);return}if(e==="key"){n!=null&&(t.key=n);return}if(e.startsWith("data-")){Il(t,e,n);return}if(e.startsWith("on")){Ol(t,e,n);return}if((t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.tagName==="SELECT")&&(e==="value"||e==="selected"||e==="selectedIndex")){st(t,e,n);return}if(t.tagName==="INPUT"&&e==="checked"){st(t,e,n),Vn(t,e,n);return}const l=Ml(e,r);l?l.boolean||l.overloadedBoolean?Vn(t,l.attribute,n):l.mustUseProperty&&!r?st(t,l.property,n):ht(t,l.attribute,n,r):e.startsWith("aria-")||e==="role"?ht(t,e,n,r):e in t||t[e]!==void 0?st(t,e,n):ht(t,e,n,r)}function $l(t,e){return document.activeElement===t?["selectionStart","selectionEnd","selectionDirection"].includes(e):!!(e==="scrollTop"||e==="scrollLeft"||t instanceof HTMLMediaElement&&["currentTime","paused","playbackRate","volume"].includes(e))}function Wl(t){return/^[a-zA-Z_:][\w\-:.]*$/.test(t)&&!t.includes("<")&&!t.includes(">")&&!t.includes('"')&&!t.includes("'")}function an(t,e,n){const r=t[jn]||{},l=Rl(r,e);t[jn]=e||{},Ul(t,l,e,n)}function Ul(t,e,n,r){for(const l in e)Wl(l)&&Pl(t,l,e[l],r);e&&typeof e.ref=="function"&&window.requestAnimationFrame(()=>e.ref(t))}function zl(t,...e){return Tr(e)}function Tr(t){const e=[],n=r=>{r!=null&&r!==""&&r!==!1&&e.push(typeof r=="function"||typeof r=="object"?r:`${r}`)};return t&&t.forEach(r=>{Array.isArray(r)?r.forEach(l=>n(l)):n(r)}),e}const Ye={};let Yn=0;const Fl=500,Hl=1e3;function Bl(){if(!(Object.keys(Ye).length<=Hl))for(const[t,e]of Object.entries(Ye))e.isConnected||delete Ye[t]}function ql(t,e,...n){const r=Tr(n);if(typeof t=="string")return{tag:t,props:e,children:r};if(Array.isArray(t))return t;if(t===void 0&&n)return r;if(Object.getPrototypeOf(t).__isAppRunComponent)return{tag:t,props:e,children:r};if(typeof t=="function")return t(e,r);throw new Error(`Unknown tag in vdom ${t}`)}const jl=(t,e,n={})=>{if(e==null||e===!1)return;const r=typeof t=="string"&&t?document.getElementById(t)||document.querySelector(t):t;e=mt(e,n),Gl(r,e,n)};function Gl(t,e,n={}){if(e==null||e===!1||(e=pt(e,n),!t))return;const r=t.nodeName==="SVG";Array.isArray(e)?Kt(t,e,r):Kt(t,[e],r)}function Vl(t,e){const n=t.nodeName,r=`${e.tag||""}`;return n.toUpperCase()===r.toUpperCase()}function Ft(t,e,n){if(n=n||e.tag==="svg",!Vl(t,e)){t.parentNode.replaceChild(yt(e,n),t);return}Kt(t,e.children,n),an(t,e.props,n)}function Kt(t,e,n){var i,h;const r=((i=t.childNodes)==null?void 0:i.length)||0,l=(e==null?void 0:e.length)||0,o=Math.min(r,l);for(let u=0;u<o;u++){const d=e[u],g=t.childNodes[u];if(typeof d=="string")g.textContent!==d&&(g.nodeType===3?g.nodeValue=d:t.replaceChild(Qt(d),g));else if(d instanceof HTMLElement||d instanceof SVGElement)t.insertBefore(d,g);else{const m=d.props&&d.props.key;if(m)if(g.key===m)Ft(t.childNodes[u],d,n);else{const S=Ye[m];S?(t.insertBefore(S,g),Ft(t.childNodes[u],d,n)):t.replaceChild(yt(d,n),g)}else Ft(t.childNodes[u],d,n)}}let a=((h=t.childNodes)==null?void 0:h.length)||0;for(;a>o;)t.removeChild(t.lastChild),a--;if(l>o){const u=document.createDocumentFragment();for(let d=o;d<e.length;d++)u.appendChild(yt(e[d],n));t.appendChild(u)}}const bt=t=>{const e=document.createElement("section");return e.insertAdjacentHTML("afterbegin",t),Array.from(e.children)};function Qt(t){if((t==null?void 0:t.indexOf("_html:"))===0){const e=document.createElement("div");return e.insertAdjacentHTML("afterbegin",t.substring(6)),e}else return document.createTextNode(t??"")}function yt(t,e){if(t instanceof HTMLElement||t instanceof SVGElement)return t;if(typeof t=="string")return Qt(t);if(!t.tag||typeof t.tag=="function")return Qt(JSON.stringify(t));e=e||t.tag==="svg";const n=e?document.createElementNS("http://www.w3.org/2000/svg",t.tag):document.createElement(t.tag);return an(n,t.props,e),t.children&&t.children.forEach(r=>n.appendChild(yt(r,e))),t.props&&t.props.key!==void 0&&(n.key=t.props.key,Ye[t.props.key]=n,++Yn>=Fl&&(Bl(),Yn=0)),n}function Yl(t,e,n){const{tag:r,props:l,children:o}=t;let a=`_${n}`,i=l&&l.id;i?a=i:i=`_${n}${Date.now()}`;let h="section";l&&l.as&&(h=l.as,delete l.as),e.__componentCache||(e.__componentCache={});let u=e.__componentCache[a];if(!u||!(u instanceof r)||!u.element){const d=document.createElement(h);u=e.__componentCache[a]=new r({...l,children:o}).mount(d,{render:!0})}else u.renderState(u.state);if(u.mounted){const d=u.mounted(l,o,u.state);typeof d<"u"&&u.setState(d)}return an(u.element,l,!1),u.element}function pt(t,e,n=0){var l;if(typeof t=="string")return t;if(Array.isArray(t))return t.map(o=>pt(o,e,n++));let r=t;if(t&&typeof t.tag=="function"&&Object.getPrototypeOf(t.tag).__isAppRunComponent&&(r=Yl(t,e,n)),r&&Array.isArray(r.children)){const o=(l=r.props)==null?void 0:l._component;if(o){let a=0;r.children=r.children.map(i=>pt(i,o,a++))}else r.children=r.children.map(a=>pt(a,e,n++))}return r}const Zl=(t,e={})=>class extends HTMLElement{constructor(){super()}get component(){return this._component}get state(){return this._component.state}static get observedAttributes(){return(e.observedAttributes||[]).map(r=>r.toLowerCase())}connectedCallback(){if(this.isConnected&&!this._component){const r=e||{};this._shadowRoot=r.shadow?this.attachShadow({mode:"open"}):this;const l=r.observedAttributes||[],o=l.reduce((i,h)=>{const u=h.toLowerCase();return u!==h&&(i[u]=h),i},{});this._attrMap=i=>o[i]||i;const a={};Array.from(this.attributes).forEach(i=>a[this._attrMap(i.name)]=i.value),l.forEach(i=>{this[i]!==void 0&&(a[i]=this[i]),Object.defineProperty(this,i,{get(){return a[i]},set(h){this.attributeChangedCallback(i,a[i],h)},configurable:!0,enumerable:!0})}),requestAnimationFrame(()=>{const i=this.children?Array.from(this.children):[];if(this._component=new t({...a,children:i}).mount(this._shadowRoot,r),this._component._props=a,this._component.dispatchEvent=this.dispatchEvent.bind(this),this._component.mounted){const h=this._component.mounted(a,i,this._component.state);typeof h<"u"&&(this._component.state=h)}this.on=this._component.on.bind(this._component),this.run=this._component.run.bind(this._component),r.render!==!1&&this._component.run(".")})}}disconnectedCallback(){var r,l,o,a;(l=(r=this._component)==null?void 0:r.unload)==null||l.call(r),(a=(o=this._component)==null?void 0:o.unmount)==null||a.call(o),this._component=null}attributeChangedCallback(r,l,o){if(this._component){const a=this._attrMap(r);this._component._props[a]=o,this._component.run("attributeChanged",a,l,o),o!==l&&e.render!==!1&&window.requestAnimationFrame(()=>{this._component.run(".")})}}},_r=(t,e,n)=>{typeof customElements<"u"&&customElements.define(t,Zl(e,n))},Jt={meta:new WeakMap,defineMetadata(t,e,n){this.meta.has(n)||this.meta.set(n,{}),this.meta.get(n)[t]=e},getMetadataKeys(t){return t=Object.getPrototypeOf(t),this.meta.get(t)?Object.keys(this.meta.get(t)):[]},getMetadata(t,e){return e=Object.getPrototypeOf(e),this.meta.get(e)?this.meta.get(e)[t]:null}};function Xl(t,e={}){return function(n,r){const l=t?t.toString():r;Jt.defineMetadata(`apprun-update:${l}`,{name:l,key:r,options:e},n)}}function Kl(t,e){return function(r){return _r(t,r,e),r}}const Zn=t=>t,W=T;class Ae{renderState(e,n=null){if(!this.view)return;let r=n||this.view(e);if(W.debug&&W.run("debug",{component:this,_:r?".":"-",state:e,vdom:r,el:this.element}),typeof document!="object")return;const l=typeof this.element=="string"&&this.element?ml(this.element)||gl(this.element):this.element;if(!l){console.warn(`Component element not found: ${this.element}`);return}const o="_c";this.unload?(l._component!==this||l.getAttribute(o)!==this.tracking_id)&&(this.tracking_id=new Date().valueOf().toString(),l.setAttribute(o,this.tracking_id),typeof MutationObserver<"u"&&(this.observer||(this.observer=new MutationObserver(a=>{(a[0].oldValue===this.tracking_id||!document.body.contains(l))&&(this.unload(this.state),this.observer.disconnect(),this.observer=null)})),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[o]}))):l.removeAttribute&&l.removeAttribute(o),l._component=this,!n&&r&&(r=mt(r,this),this.options.transition&&document&&document.startViewTransition?document.startViewTransition(()=>W.render(l,r,this)):W.render(l,r,this)),this.rendered&&this.rendered(this.state)}setState(e,n={render:!0,history:!1}){const r=async o=>{try{for(;;){const{value:a,done:i}=await o.next();if(i)break;this.setState(a,n)}}catch(a){console.error("Error in async iterator:",a)}},l=e;if(l!=null&&l[Symbol.asyncIterator]){this.setState(r(l[Symbol.asyncIterator]()),n);return}else if(l!=null&&l[Symbol.iterator]&&typeof l.next=="function"){for(const o of l)this.setState(o,n);return}else if(e&&e instanceof Promise)Promise.resolve(e).then(o=>{this.setState(o,n),this._state=e});else{if(this._state=e,e==null)return;this.state=e,n.render!==!1&&(n.transition&&document&&document.startViewTransition?document.startViewTransition(()=>this.renderState(e)):this.renderState(e)),n.history!==!1&&this.enable_history&&(this._history=[...this._history,e],this._history_idx=this._history.length-1),typeof n.callback=="function"&&n.callback(this.state)}}constructor(e,n,r,l){this.state=e,this.view=n,this.update=r,this.options=l,this._app=new br,this._actions=[],this._global_events=[],this._history=[],this._history_idx=-1,this._history_prev=()=>{this._history_idx--,this._history_idx>=0?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=0},this._history_next=()=>{this._history_idx++,this._history_idx<this._history.length?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=this._history.length-1},this.start=(o=null,a)=>{if(this.mount(o,{render:!0,...a}),this.mounted&&typeof this.mounted=="function"){const i=this.mounted({},[],this.state);typeof i<"u"&&this.setState(i)}return this}}mount(e=null,n){var r;return console.assert(!this.element,"Component already mounted."),this.options=n={...this.options,...n},this.element=e,this.global_event=n.global_event,this.enable_history=!!n.history,this.enable_history&&(this.on(n.history.prev||"history-prev",this._history_prev),this.on(n.history.next||"history-next",this._history_next)),n.route&&(this.update=this.update||{},this.update[n.route]||(this.update[n.route]=Zn)),this.add_actions(),this.state=this.state??this.model??{},typeof this.state=="function"&&(this.state=this.state()),this.setState(this.state,{render:!!n.render,history:!0}),W.debug&&((r=W.find("debug-create-component"))!=null&&r.length)&&W.run("debug-create-component",this),this}is_global_event(e){return e&&(this.global_event||this._global_events.indexOf(e)>=0||e.startsWith("#")||e.startsWith("/")||e.startsWith("@"))}add_action(e,n,r={}){if(!n||typeof n!="function"){console.warn(`Component action for '${e}' is not a valid function:`,n);return}r.global&&this._global_events.push(e),this.on(e,(...l)=>{W.debug&&W.run("debug",{component:this,_:">",event:e,p:l,current_state:this.state,options:r});try{const o=n(this.state,...l);W.debug&&W.run("debug",{component:this,_:"<",event:e,p:l,newState:o,state:this.state,options:r}),this.setState(o,r)}catch(o){console.error(`Error in component action '${e}':`,o),W.debug&&W.run("debug",{component:this,_:"!",event:e,p:l,error:o,state:this.state,options:r})}},r)}add_actions(){const e=this.update||{};Jt.getMetadataKeys(this).forEach(r=>{if(r.startsWith("apprun-update:")){const l=Jt.getMetadata(r,this);e[l.name]=[this[l.key].bind(this),l.options]}});const n={};Array.isArray(e)?e.forEach(r=>{const[l,o,a]=r;l.toString().split(",").forEach(h=>n[h.trim()]=[o,a])}):Object.keys(e).forEach(r=>{const l=e[r];(typeof l=="function"||Array.isArray(l))&&r.split(",").forEach(o=>n[o.trim()]=l)}),n["."]||(n["."]=Zn),Object.keys(n).forEach(r=>{const l=n[r];typeof l=="function"?this.add_action(r,l):Array.isArray(l)&&this.add_action(r,l[0],l[1])})}run(e,...n){if(this.state instanceof Promise)return Promise.resolve(this.state).then(r=>{this.state=r,this.run(e,...n)});{const r=e.toString();return this.is_global_event(r)?W.run(r,...n):this._app.run(r,...n)}}on(e,n,r){const l=e.toString();return this._actions.push({name:l,fn:n}),this.is_global_event(l)?W.on(l,n,r):this._app.on(l,n,r)}runAsync(e,...n){const r=e.toString();return this.is_global_event(r)?W.runAsync(r,...n):this._app.runAsync(r,...n)}query(e,...n){return console.warn("component.query() is deprecated. Use component.runAsync() instead."),this.runAsync(e,...n)}unmount(){var e;(e=this.observer)==null||e.disconnect(),this._actions.forEach(n=>{const{name:r,fn:l}=n;this.is_global_event(r)?W.off(r,l):this._app.off(r,l)})}}Ae.__isAppRunComponent=!0;function Ql(t){return t?t.startsWith("#/")?t.substring(2).split("/"):t.startsWith("#")||t.startsWith("/")?t.substring(1).split("/"):t.split("/"):[]}function Jl(t){return!t||t==="/"||t==="#"||t==="#/"?t:t.endsWith("/")?t.slice(0,-1):t}function eo(t){const e=t.filter(Boolean);e.length>11&&console.warn(`Deep route hierarchy detected: ${e.join("/")} (${e.length} levels)`)}function to(t,e){if(!e||e==="/"||e==="")return t;const n=e.startsWith("/")?e:"/"+e;if(t.startsWith(n)){const r=t.substring(n.length);return r.startsWith("/")?r:"/"+r}return t}function no(t,e){const n=[];for(let r=t.length;r>0;r--){const l=t.slice(0,r);let o="";switch(e){case"path":o="/"+l.join("/");break;case"hash":o="#"+l.join("/");break;case"hash-slash":o="#/"+l.join("/");break;case"non-prefixed":o=l.join("/");break}n.push(o)}return n}function ro(t,e){for(let n=0;n<t.length;n++){const r=t[n],l=T.find(r);if(l&&l.length>0){const o=t.length-n,a=e.slice(o);return{eventName:r,parameters:a}}}return null}function Xn(){const t=T.find("#");if(t&&t.length>0){T.run("#"),T.run(he,"#");return}const e=T.find("/");if(e&&e.length>0){T.run("/"),T.run(he,"/");return}const n=T.find("#/");if(n&&n.length>0){T.run("#/"),T.run(he,"#/");return}console.warn("No subscribers for event: "),T.run(Xe,""),T.run(he,"")}function lo(t){if(!t){Xn();return}t=Jl(t);const e=T.basePath;e&&(t=to(t,e));const n=Ql(t);eo(n);let r;t.startsWith("#/")?r="hash-slash":t.startsWith("#")?r="hash":t.startsWith("/")?r="path":r="non-prefixed";const l=no(n,r),o=ro(l,n);if(o)oo(o.eventName,...o.parameters);else if(l.length>0){const a=l[l.length-1];console.warn(`No subscribers for event: ${a}`),T.run(Xe,t),T.run(he,t)}else Xn()}const oo=(t,...e)=>{if(!t||t===he||t===Xe)return;const n=T.find(t);!n||n.length===0?(console.warn(`No subscribers for event: ${t}`),T.run(Xe,t,...e)):T.run(t,...e),T.run(he,t,...e)},he="//",Xe="///",Ie=t=>{T.lastUrl!==t&&(T.lastUrl=t,lo(t))};function Kn(t){return t&&typeof t=="object"&&typeof t.mount=="function"}function en(t){return typeof t=="function"&&t.prototype&&t.prototype.constructor===t&&(t.prototype.mount!==void 0||t.prototype.state!==void 0||t.prototype.view!==void 0)}function Nr(t){return typeof t=="function"&&!en(t)}async function so(t,e=3){let n=t,r=0;for(;Nr(n)&&r<e;)try{const l=await n();if(l===n)break;n=l,r++}catch(l){console.error(`Error executing component function: ${l}`);break}return n}const ao=async(t,e)=>{for(const[n,r]of Object.entries(e)){if(!r||!n){console.error(`Invalid component configuration: component=${r}, route=${n}`);continue}if(Kn(r)){const l={route:n};r.mount(t,l);continue}if(en(r)){const l=new r,o={route:n};l.mount(t,o);continue}if(Nr(r)){let l=await so(r);if(Kn(l)){const o={route:n};l.mount(t,o);continue}if(en(l)){const o=new l,a={route:n};o.mount(t,a);continue}T.on(n,(...o)=>{const a=r(...o);if(typeof t=="string"&&(t=document.querySelector(t),!t)){console.error(`Element not found: ${t}`);return}return T.render(t,a)});continue}console.error("Invalid component: component must be a class, instance, or function that returns a class/instance")}},s=T;if(!s.start){s.version=mr,s.h=s.createElement=ql,s.render=jl,s.Fragment=zl,s.webComponent=_r,s.safeHTML=bt,s.start=(e,n,r,l,o)=>{const a={render:!0,global_event:!0,...o},i=new Ae(n,r,l);return o&&o.rendered&&(i.rendered=o.rendered),o&&o.mounted&&(i.mounted=o.mounted),i.start(e,a),i},s.query=s.query||s.runAsync;const t=e=>{};if(s.on("/",t),s.on("debug",e=>t),s.on(he,t),s.on(Xe,t),s.route=Ie,s.on("route",e=>s.route&&s.route(e)),typeof document=="object"&&document.addEventListener("DOMContentLoaded",()=>{const e=document.body.hasAttribute("apprun-no-init")||s["no-init-route"]||!1,n=s.find("#")||s.find("#/")||!1;window.addEventListener("hashchange",()=>Ie(location.hash)),window.addEventListener("popstate",()=>Ie(location.pathname)),n?!e&&Ie(location.hash):(!e&&(()=>{const r=s.basePath||"";let l=location.pathname;r&&l.startsWith(r)&&(l=l.substring(r.length),l.startsWith("/")||(l="/"+l)),Ie(l)})(),document.body.addEventListener("click",r=>{const l=r.target;if(!l)return;const o=l.tagName==="A"?l:l.closest("a");if(o&&o.origin===location.origin&&o.pathname){r.preventDefault();const i=(s.basePath||"")+o.pathname;history.pushState(null,"",i),Ie(o.pathname)}}))}),typeof window=="object"){const e=window;e.Component=Ae,e._React=e.React,e.React=s,e.on=Xl,e.customElement=Kl,e.safeHTML=bt}s.use_render=(e,n=0)=>{n===0?s.render=(r,l)=>e(l,r):s.render=(r,l)=>e(r,l)},s.use_react=(e,n)=>{if(!e||!n){console.error("AppRun use_react: React and ReactDOM parameters are required");return}if(typeof e.createElement!="function"){console.error("AppRun use_react: Invalid React object - createElement method not found");return}if(!e.Fragment){console.error("AppRun use_react: Invalid React object - Fragment not found");return}if(s.h=s.createElement=e.createElement,s.Fragment=e.Fragment,e.version&&e.version.startsWith("18")){if(!n.createRoot||typeof n.createRoot!="function"){console.error("AppRun use_react: ReactDOM.createRoot not found in React 18+");return}s.render=(r,l)=>{!r||l===void 0||(r._root||(r._root=n.createRoot(r)),r._root.render(l))}}else{if(!n.render||typeof n.render!="function"){console.error("AppRun use_react: ReactDOM.render not found in legacy React");return}s.render=(r,l)=>n.render(l,r)}},s.addComponents=ao}const io=()=>s.h("div",{id:"main"},s.h("div",{id:"pages"})),co="/api";async function U(t,e={}){const n=`${co}${t}`;try{const r=await fetch(n,{headers:{"Content-Type":"application/json",...e.headers},...e});if(!r.ok){let l=`HTTP ${r.status}: ${r.statusText}`;try{const o=await r.json();o.error&&(l=o.error,o.code&&(l+=` (${o.code})`))}catch{}throw new Error(l)}return r}catch(r){throw console.error(`API request failed for ${t}:`,r),r}}async function uo(){return(await U("/worlds")).json()}async function ho(t){if(!t)throw new Error("World name is required");return(await U(`/worlds/${encodeURIComponent(t)}`)).json()}async function po(t){if(!t||!t.name)throw new Error("World data with name is required");const e={id:t.id??"",name:t.name,description:t.description||"",turnLimit:t.turnLimit??5,agents:t.agents??[],currentChatId:t.currentChatId??"",chats:t.chats??[]};return(await U("/worlds",{method:"POST",body:JSON.stringify(e)})).json()}async function fo(t,e){if(!t||!e)throw new Error("World name and update data are required");return(await U(`/worlds/${encodeURIComponent(t)}`,{method:"PATCH",body:JSON.stringify(e)})).json()}async function go(t){if(!t)throw new Error("World name is required");await U(`/worlds/${encodeURIComponent(t)}`,{method:"DELETE"})}async function mo(t,e){if(!t||!e)throw new Error("World name and agent data are required");return(await U(`/worlds/${encodeURIComponent(t)}/agents`,{method:"POST",body:JSON.stringify(e)})).json()}async function bo(t,e,n){if(!t||!e||!n)throw new Error("World name, agent name, and update data are required");return(await U(`/worlds/${encodeURIComponent(t)}/agents/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(n)})).json()}async function yo(t,e){if(!t||!e)throw new Error("World name and agent name are required");await U(`/worlds/${encodeURIComponent(t)}/agents/${encodeURIComponent(e)}`,{method:"DELETE"})}async function wo(t,e){if(!t||!e)throw new Error("World name and agent name are required");await U(`/worlds/${encodeURIComponent(t)}/agents/${encodeURIComponent(e)}/memory`,{method:"DELETE"})}async function ko(t){if(!t)throw new Error("World name is required");const e=await U(`/worlds/${encodeURIComponent(t)}/export`),n=e.headers.get("Content-Disposition");let r=`${t}-export.md`;if(n){const h=n.match(/filename="(.+)"/);h&&(r=h[1])}const l=await e.text(),o=new Blob([l],{type:"text/markdown"}),a=URL.createObjectURL(o),i=document.createElement("a");i.href=a,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}async function xo(t){if(!t)throw new Error("World name is required");return(await U(`/worlds/${encodeURIComponent(t)}/export`)).text()}async function Cr(t,e){return await(await U(`/worlds/${encodeURIComponent(t)}/load-chat/${encodeURIComponent(e)}`,{method:"POST"})).json()}async function Ao(t,e){if(!t||!e)throw new Error("World name and chat ID are required");await U(`/worlds/${encodeURIComponent(t)}/chats/${encodeURIComponent(e)}`,{method:"DELETE"})}async function So(t){if(!t)throw new Error("World name is required");return await(await U(`/worlds/${encodeURIComponent(t)}/new-chat`,{method:"POST"})).json()}async function vo(t,e){if(!t||!e)throw new Error("World name and chat ID are required");return await(await U(`/worlds/${encodeURIComponent(t)}/load-chat/${encodeURIComponent(e)}`,{method:"POST"})).json()}async function Eo(t,e){if(!t||!e)throw new Error("World name and chat ID are required");return(await Cr(t,e)).world}const L={apiRequest:U,getWorlds:uo,getWorld:ho,createWorld:po,updateWorld:fo,deleteWorld:go,exportWorldToMarkdown:ko,getWorldMarkdown:xo,createAgent:mo,updateAgent:bo,deleteAgent:yo,clearAgentMemory:wo,setCurrentChat:Cr,deleteChat:Ao,createNewChat:So,loadChatById:vo,getChat:Eo},To=t=>({mode:t.mode||"create",world:t.world||Rr(),parentComponent:t.parentComponent,loading:!1}),Rr=()=>({name:"",description:"",turnLimit:5}),Qn=async function*(t){if(!t.world.name.trim()){yield{...t,error:"World name is required"};return}yield{...t,loading:!0,error:null};try{t.mode==="create"?await L.createWorld(t.world):await L.updateWorld(t.world.name,t.world);const e=t.mode==="create"?"World created successfully!":"World updated successfully!";yield{...t,loading:!1,successMessage:e},setTimeout(()=>{t.mode==="create"?window.location.href="/World/"+encodeURIComponent(t.world.name):location.reload()},2e3)}catch(e){yield{...t,loading:!1,error:e.message||"Failed to save world"}}},Jn=async function*(t){yield{...t,loading:!0,error:null};try{await L.deleteWorld(t.world.name),yield{...t,loading:!1,successMessage:"World deleted successfully!"},setTimeout(()=>{location.reload()},2e3)}catch(e){yield{...t,loading:!1,error:e.message||"Failed to delete world"}}},ke=t=>{t!=null&&t.parentComponent&&typeof t.parentComponent.run=="function"?t.parentComponent.run("close-world-edit"):s.run("close-world-edit")};class Lr extends Ae{constructor(){super(...arguments);x(this,"mounted",n=>To(n));x(this,"state",{mode:"create",world:Rr(),parentComponent:void 0,loading:!1,error:null,successMessage:null});x(this,"view",n=>{if(n.successMessage)return s.h("div",{className:"modal-backdrop",$onclick:ke},s.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},s.h("div",{className:"modal-header"},s.h("h2",{className:"modal-title"},"Success!"),s.h("button",{className:"modal-close-btn",$onclick:ke,title:"Close"},"×")),s.h("div",{className:"modal-body"},s.h("div",{className:"success-message"},s.h("p",null,n.successMessage)))));const r=n.mode==="edit",l=n.mode==="delete";let o;return l?o=`Delete ${n.world.name||"World"}`:r?o=`Edit ${n.world.name||"World"}`:o="Create New World",s.h("div",{className:"modal-backdrop",$onclick:ke},s.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},s.h("div",{className:"modal-header"},s.h("h2",{className:"modal-title"},o),s.h("button",{className:"modal-close-btn",$onclick:ke,title:"Close"},"×")),s.h("div",{className:"modal-body"},n.error&&s.h("div",{className:"error-message"},n.error),l?s.h("div",{className:"delete-confirmation"},s.h("p",{className:"delete-confirmation-text"},"Are you sure you want to delete ",s.h("span",{className:"delete-confirmation-name"},'"',n.world.name,'"'),"?"),s.h("p",{className:"delete-confirmation-text"},"This action cannot be undone and will delete all agents and messages in this world.")):s.h("form",{className:"world-form"},s.h("div",{className:"form-section"},s.h("div",{className:`form-group ${r?"hidden":""}`},s.h("label",{htmlFor:"world-name"},"World Name *"),s.h("input",{id:"world-name",type:"text",className:"form-input",placeholder:"Enter world name",value:n.world.name,$bind:"world.name",disabled:n.loading})),s.h("div",{className:"form-group"},s.h("label",{htmlFor:"world-description"},"Description"),s.h("input",{id:"world-description",type:"text",className:"form-input",placeholder:"Brief description of the world",value:n.world.description,$bind:"world.description",disabled:n.loading})),s.h("div",{className:"form-group"},s.h("label",{htmlFor:"world-turn-limit"},"Turn Limit"),s.h("input",{id:"world-turn-limit",type:"number",className:"form-input",placeholder:"5",min:"1",max:"50",value:n.world.turnLimit,$bind:"world.turnLimit",disabled:n.loading}))))),s.h("div",{className:"modal-footer"},s.h("div",{className:"modal-actions"},l?s.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},s.h("button",{className:"btn btn-secondary",$onclick:ke,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-danger",$onclick:[Jn],disabled:n.loading},n.loading?"Deleting...":"Delete")):r?s.h(s.Fragment,null,s.h("button",{className:"btn btn-danger",$onclick:[Jn],disabled:n.loading,title:"Delete world"},n.loading?"Deleting...":"Delete"),s.h("div",{className:"modal-primary-actions"},s.h("button",{className:"btn btn-secondary",$onclick:ke,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-primary",$onclick:[Qn],disabled:n.loading||!n.world.name.trim()},n.loading?"Saving...":"Update"))):s.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},s.h("button",{className:"btn btn-secondary",$onclick:ke,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-primary",$onclick:[Qn],disabled:n.loading||!n.world.name.trim()},n.loading?"Saving...":"Create"))))))})}}class _o extends Ae{constructor(){super(...arguments);x(this,"state",async()=>({worlds:await L.getWorlds(),currentIndex:0,loading:!1,error:null,showWorldEdit:!1,worldEditMode:"create",selectedWorldForEdit:null}));x(this,"view",n=>{var r,l,o,a;return n.loading?s.h("div",{class:"container"},s.h("div",{class:"row"},s.h("div",{class:"col"},s.h("div",{class:"loading-message"},"Loading worlds...")))):n.error?s.h("div",{class:"container"},s.h("div",{class:"row"},s.h("div",{class:"col"},s.h("div",{class:"error-message"},s.h("h3",null,"Error loading worlds"),s.h("p",null,n.error),s.h("button",{class:"btn btn-primary",$onclick:"/"},"Retry"))))):n.worlds.length===0?s.h("div",{class:"container"},s.h("div",{class:"row"},s.h("div",{class:"col"},s.h("div",{class:"no-worlds-message"},s.h("h3",null,"No worlds found"),s.h("p",null,"Create your first world to get started!"),s.h("button",{class:"btn btn-primary",$onclick:"open-world-create"},"Create World"))))):s.h("div",{class:"container"},s.h("div",{class:"row"},s.h("div",{class:"col banner-col"},s.h("h1",{class:"banner-title"},"PICK YOUR WORLD"))),s.h("div",{class:"row carousel-row"},s.h("div",{class:"col"},s.h("div",{class:"world-carousel"},s.h("button",{class:"btn carousel-arrow",$onclick:"prev-world"},"‹"),s.h("div",{class:"world-cards"},n.worlds.map((i,h)=>{const u=h===n.currentIndex;let d=!1;return n.worlds.length<=3?d=!0:d=Math.abs(h-n.currentIndex)<=1,d?s.h("button",{class:`btn world-card-btn ${u?"btn-primary center":"btn-secondary side"}`,$onclick:u?["enter-world",i]:["select-world",i]},s.h("span",{class:"world-name"},i.name)):null})),s.h("button",{class:"btn carousel-arrow",$onclick:"next-world"},"›")),s.h("div",{class:"world-indicators"},n.worlds.map((i,h)=>s.h("button",{class:`world-dot ${h===n.currentIndex?"active":""}`,$onclick:["select-world",i],title:i.name}))))),s.h("div",{class:"row"},s.h("div",{class:"col"},s.h("div",{class:"description-card"},s.h("h4",{class:"description-title"},((r=n.worlds[n.currentIndex])==null?void 0:r.name)||"Unknown World"),s.h("p",{class:"description-text"},((l=n.worlds[n.currentIndex])==null?void 0:l.description)||"No description available"),s.h("div",{class:"action-buttons"},s.h("button",{class:"btn add-world-btn",title:"Add New World",$onclick:"open-world-create"},s.h("span",{class:"plus-icon"},"+")),s.h("a",{href:"/World/"+(((o=n.worlds[n.currentIndex])==null?void 0:o.name)||"")},s.h("button",{class:"btn btn-primary enter-btn"},"Enter ",((a=n.worlds[n.currentIndex])==null?void 0:a.name)||"World")),s.h("button",{class:"btn add-world-btn delete-world-btn",title:"Delete World",$onclick:["open-world-delete",n.worlds[n.currentIndex]]},s.h("span",{class:"plus-icon"},"×")))))),n.showWorldEdit&&s.h(Lr,{world:n.selectedWorldForEdit,mode:n.worldEditMode,parentComponent:this}))});x(this,"update",{"prev-world":n=>({...n,currentIndex:n.currentIndex>0?n.currentIndex-1:n.worlds.length-1}),"next-world":n=>({...n,currentIndex:n.currentIndex<n.worlds.length-1?n.currentIndex+1:0}),"select-world":(n,r)=>{const l=n.worlds.findIndex(o=>o.name===r.name);return{...n,currentIndex:l>=0?l:n.currentIndex}},"enter-world":(n,r)=>{window.location.href="/World/"+r.name},"open-world-create":n=>({...n,showWorldEdit:!0,worldEditMode:"create",selectedWorldForEdit:null}),"open-world-edit":(n,r)=>({...n,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:r}),"open-world-delete":(n,r)=>({...n,showWorldEdit:!0,worldEditMode:"delete",selectedWorldForEdit:r}),"close-world-edit":n=>({...n,showWorldEdit:!1})})}}function wt(t){return t?t.replace(/\s+/g,"-").replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").toLowerCase():""}function cn(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ee=cn();function Mr(t){Ee=t}var Ze={exec:()=>null};function E(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(l,o)=>{let a=typeof o=="string"?o:o.source;return a=a.replace(q.caret,"$1"),n=n.replace(l,a),r},getRegex:()=>new RegExp(n,e)};return r}var q={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},No=/^(?:[ \t]*(?:\n|$))+/,Co=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ro=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Qe=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Lo=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,un=/(?:[*+-]|\d{1,9}[.)])/,Ir=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Or=E(Ir).replace(/bull/g,un).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Mo=E(Ir).replace(/bull/g,un).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),dn=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Io=/^[^\n]+/,hn=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Oo=E(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",hn).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Do=E(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,un).getRegex(),St="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",pn=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Po=E("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",pn).replace("tag",St).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dr=E(dn).replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",St).getRegex(),$o=E(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dr).getRegex(),fn={blockquote:$o,code:Co,def:Oo,fences:Ro,heading:Lo,hr:Qe,html:Po,lheading:Or,list:Do,newline:No,paragraph:Dr,table:Ze,text:Io},er=E("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",St).getRegex(),Wo={...fn,lheading:Mo,table:er,paragraph:E(dn).replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",er).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",St).getRegex()},Uo={...fn,html:E(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",pn).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ze,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:E(dn).replace("hr",Qe).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Or).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},zo=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Fo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Pr=/^( {2,}|\\)\n(?!\s*$)/,Ho=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,vt=/[\p{P}\p{S}]/u,gn=/[\s\p{P}\p{S}]/u,$r=/[^\s\p{P}\p{S}]/u,Bo=E(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,gn).getRegex(),Wr=/(?!~)[\p{P}\p{S}]/u,qo=/(?!~)[\s\p{P}\p{S}]/u,jo=/(?:[^\s\p{P}\p{S}]|~)/u,Go=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Ur=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Vo=E(Ur,"u").replace(/punct/g,vt).getRegex(),Yo=E(Ur,"u").replace(/punct/g,Wr).getRegex(),zr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Zo=E(zr,"gu").replace(/notPunctSpace/g,$r).replace(/punctSpace/g,gn).replace(/punct/g,vt).getRegex(),Xo=E(zr,"gu").replace(/notPunctSpace/g,jo).replace(/punctSpace/g,qo).replace(/punct/g,Wr).getRegex(),Ko=E("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,$r).replace(/punctSpace/g,gn).replace(/punct/g,vt).getRegex(),Qo=E(/\\(punct)/,"gu").replace(/punct/g,vt).getRegex(),Jo=E(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),es=E(pn).replace("(?:-->|$)","-->").getRegex(),ts=E("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",es).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),kt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ns=E(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",kt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fr=E(/^!?\[(label)\]\[(ref)\]/).replace("label",kt).replace("ref",hn).getRegex(),Hr=E(/^!?\[(ref)\](?:\[\])?/).replace("ref",hn).getRegex(),rs=E("reflink|nolink(?!\\()","g").replace("reflink",Fr).replace("nolink",Hr).getRegex(),mn={_backpedal:Ze,anyPunctuation:Qo,autolink:Jo,blockSkip:Go,br:Pr,code:Fo,del:Ze,emStrongLDelim:Vo,emStrongRDelimAst:Zo,emStrongRDelimUnd:Ko,escape:zo,link:ns,nolink:Hr,punctuation:Bo,reflink:Fr,reflinkSearch:rs,tag:ts,text:Ho,url:Ze},ls={...mn,link:E(/^!?\[(label)\]\((.*?)\)/).replace("label",kt).getRegex(),reflink:E(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",kt).getRegex()},tn={...mn,emStrongRDelimAst:Xo,emStrongLDelim:Yo,url:E(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},os={...tn,br:E(Pr).replace("{2,}","*").getRegex(),text:E(tn.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},at={normal:fn,gfm:Wo,pedantic:Uo},Fe={normal:mn,gfm:tn,breaks:os,pedantic:ls},ss={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tr=t=>ss[t];function oe(t,e){if(e){if(q.escapeTest.test(t))return t.replace(q.escapeReplace,tr)}else if(q.escapeTestNoEncode.test(t))return t.replace(q.escapeReplaceNoEncode,tr);return t}function nr(t){try{t=encodeURI(t).replace(q.percentDecode,"%")}catch{return null}return t}function rr(t,e){var o;let n=t.replace(q.findPipe,(a,i,h)=>{let u=!1,d=i;for(;--d>=0&&h[d]==="\\";)u=!u;return u?"|":" |"}),r=n.split(q.splitPipe),l=0;if(r[0].trim()||r.shift(),r.length>0&&!((o=r.at(-1))!=null&&o.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;l<r.length;l++)r[l]=r[l].trim().replace(q.slashPipe,"|");return r}function He(t,e,n){let r=t.length;if(r===0)return"";let l=0;for(;l<r&&t.charAt(r-l-1)===e;)l++;return t.slice(0,r-l)}function as(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function lr(t,e,n,r,l){let o=e.href,a=e.title||null,i=t[1].replace(l.other.outputLinkReplace,"$1");r.state.inLink=!0;let h={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:a,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,h}function is(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let l=r[1];return e.split(`
`).map(o=>{let a=o.match(n.other.beginningSpace);if(a===null)return o;let[i]=a;return i.length>=l.length?o.slice(l.length):o}).join(`
`)}var xt=class{constructor(t){x(this,"options");x(this,"rules");x(this,"lexer");this.options=t||Ee}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:He(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=is(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=He(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:He(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=He(e[0],`
`).split(`
`),r="",l="",o=[];for(;n.length>0;){let a=!1,i=[],h;for(h=0;h<n.length;h++)if(this.rules.other.blockquoteStart.test(n[h]))i.push(n[h]),a=!0;else if(!a)i.push(n[h]);else break;n=n.slice(h);let u=i.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${u}`:u,l=l?`${l}
${d}`:d;let g=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,o,!0),this.lexer.state.top=g,n.length===0)break;let m=o.at(-1);if((m==null?void 0:m.type)==="code")break;if((m==null?void 0:m.type)==="blockquote"){let S=m,w=S.raw+`
`+n.join(`
`),N=this.blockquote(w);o[o.length-1]=N,r=r.substring(0,r.length-S.raw.length)+N.raw,l=l.substring(0,l.length-S.text.length)+N.text;break}else if((m==null?void 0:m.type)==="list"){let S=m,w=S.raw+`
`+n.join(`
`),N=this.list(w);o[o.length-1]=N,r=r.substring(0,r.length-m.raw.length)+N.raw,l=l.substring(0,l.length-S.raw.length)+N.raw,n=w.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:o,text:l}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),r=n.length>1,l={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let o=this.rules.other.listItemRegex(n),a=!1;for(;t;){let h=!1,u="",d="";if(!(e=o.exec(t))||this.rules.block.hr.test(t))break;u=e[0],t=t.substring(u.length);let g=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,re=>" ".repeat(3*re.length)),m=t.split(`
`,1)[0],S=!g.trim(),w=0;if(this.options.pedantic?(w=2,d=g.trimStart()):S?w=e[1].length+1:(w=e[2].search(this.rules.other.nonSpaceChar),w=w>4?1:w,d=g.slice(w),w+=e[1].length),S&&this.rules.other.blankLine.test(m)&&(u+=m+`
`,t=t.substring(m.length+1),h=!0),!h){let re=this.rules.other.nextBulletRegex(w),ee=this.rules.other.hrRegex(w),te=this.rules.other.fencesBeginRegex(w),O=this.rules.other.headingBeginRegex(w),pe=this.rules.other.htmlBeginRegex(w);for(;t;){let fe=t.split(`
`,1)[0],ge;if(m=fe,this.options.pedantic?(m=m.replace(this.rules.other.listReplaceNesting,"  "),ge=m):ge=m.replace(this.rules.other.tabCharGlobal,"    "),te.test(m)||O.test(m)||pe.test(m)||re.test(m)||ee.test(m))break;if(ge.search(this.rules.other.nonSpaceChar)>=w||!m.trim())d+=`
`+ge.slice(w);else{if(S||g.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||te.test(g)||O.test(g)||ee.test(g))break;d+=`
`+m}!S&&!m.trim()&&(S=!0),u+=fe+`
`,t=t.substring(fe.length+1),g=ge.slice(w)}}l.loose||(a?l.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(a=!0));let N=null,J;this.options.gfm&&(N=this.rules.other.listIsTask.exec(d),N&&(J=N[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),l.items.push({type:"list_item",raw:u,task:!!N,checked:J,loose:!1,text:d,tokens:[]}),l.raw+=u}let i=l.items.at(-1);if(i)i.raw=i.raw.trimEnd(),i.text=i.text.trimEnd();else return;l.raw=l.raw.trimEnd();for(let h=0;h<l.items.length;h++)if(this.lexer.state.top=!1,l.items[h].tokens=this.lexer.blockTokens(l.items[h].text,[]),!l.loose){let u=l.items[h].tokens.filter(g=>g.type==="space"),d=u.length>0&&u.some(g=>this.rules.other.anyLine.test(g.raw));l.loose=d}if(l.loose)for(let h=0;h<l.items.length;h++)l.items[h].loose=!0;return l}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",l=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:l}}}table(t){var a;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=rr(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),l=(a=e[3])!=null&&a.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let i of r)this.rules.other.tableAlignRight.test(i)?o.align.push("right"):this.rules.other.tableAlignCenter.test(i)?o.align.push("center"):this.rules.other.tableAlignLeft.test(i)?o.align.push("left"):o.align.push(null);for(let i=0;i<n.length;i++)o.header.push({text:n[i],tokens:this.lexer.inline(n[i]),header:!0,align:o.align[i]});for(let i of l)o.rows.push(rr(i,o.header.length).map((h,u)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:o.align[u]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=He(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=as(e[2],"()");if(o===-2)return;if(o>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let r=e[2],l="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(r);o&&(r=o[1],l=o[3])}else l=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),lr(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:l&&l.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),l=e[r.toLowerCase()];if(!l){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return lr(n,l,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let l=[...r[0]].length-1,o,a,i=l,h=0,u=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,e=e.slice(-1*t.length+l);(r=u.exec(e))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(a=[...o].length,r[3]||r[4]){i+=a;continue}else if((r[5]||r[6])&&l%3&&!((l+a)%3)){h+=a;continue}if(i-=a,i>0)continue;a=Math.min(a,a+i+h);let d=[...r[0]][0].length,g=t.slice(0,l+r.index+d+a);if(Math.min(l,a)%2){let S=g.slice(1,-1);return{type:"em",raw:g,text:S,tokens:this.lexer.inlineTokens(S)}}let m=g.slice(2,-2);return{type:"strong",raw:g,text:m,tokens:this.lexer.inlineTokens(m)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),l=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&l&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,l;if(e[2]==="@")r=e[0],l="mailto:"+r;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);r=e[0],e[1]==="www."?l="http://"+e[0]:l=e[0]}return{type:"link",raw:e[0],text:r,href:l,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},ue=class nn{constructor(e){x(this,"tokens");x(this,"options");x(this,"state");x(this,"tokenizer");x(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ee,this.options.tokenizer=this.options.tokenizer||new xt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:q,block:at.normal,inline:Fe.normal};this.options.pedantic?(n.block=at.pedantic,n.inline=Fe.pedantic):this.options.gfm&&(n.block=at.gfm,this.options.breaks?n.inline=Fe.breaks:n.inline=Fe.gfm),this.tokenizer.rules=n}static get rules(){return{block:at,inline:Fe}}static lex(e,n){return new nn(n).lex(e)}static lexInline(e,n){return new nn(n).inlineTokens(e)}lex(e){e=e.replace(q.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var l,o,a;for(this.options.pedantic&&(e=e.replace(q.tabCharGlobal,"    ").replace(q.spaceLine,""));e;){let i;if((o=(l=this.options.extensions)==null?void 0:l.block)!=null&&o.some(u=>(i=u.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let u=n.at(-1);i.raw.length===1&&u!==void 0?u.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let u=n.at(-1);(u==null?void 0:u.type)==="paragraph"||(u==null?void 0:u.type)==="text"?(u.raw+=`
`+i.raw,u.text+=`
`+i.text,this.inlineQueue.at(-1).src=u.text):n.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let u=n.at(-1);(u==null?void 0:u.type)==="paragraph"||(u==null?void 0:u.type)==="text"?(u.raw+=`
`+i.raw,u.text+=`
`+i.raw,this.inlineQueue.at(-1).src=u.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),n.push(i);continue}let h=e;if((a=this.options.extensions)!=null&&a.startBlock){let u=1/0,d=e.slice(1),g;this.options.extensions.startBlock.forEach(m=>{g=m.call({lexer:this},d),typeof g=="number"&&g>=0&&(u=Math.min(u,g))}),u<1/0&&u>=0&&(h=e.substring(0,u+1))}if(this.state.top&&(i=this.tokenizer.paragraph(h))){let u=n.at(-1);r&&(u==null?void 0:u.type)==="paragraph"?(u.raw+=`
`+i.raw,u.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(i),r=h.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let u=n.at(-1);(u==null?void 0:u.type)==="text"?(u.raw+=`
`+i.raw,u.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(i);continue}if(e){let u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var i,h,u;let r=e,l=null;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)d.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,l.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(l=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,a="";for(;e;){o||(a=""),o=!1;let d;if((h=(i=this.options.extensions)==null?void 0:i.inline)!=null&&h.some(m=>(d=m.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.escape(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.tag(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.link(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(d.raw.length);let m=n.at(-1);d.type==="text"&&(m==null?void 0:m.type)==="text"?(m.raw+=d.raw,m.text+=d.text):n.push(d);continue}if(d=this.tokenizer.emStrong(e,r,a)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.codespan(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.br(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.del(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.autolink(e)){e=e.substring(d.raw.length),n.push(d);continue}if(!this.state.inLink&&(d=this.tokenizer.url(e))){e=e.substring(d.raw.length),n.push(d);continue}let g=e;if((u=this.options.extensions)!=null&&u.startInline){let m=1/0,S=e.slice(1),w;this.options.extensions.startInline.forEach(N=>{w=N.call({lexer:this},S),typeof w=="number"&&w>=0&&(m=Math.min(m,w))}),m<1/0&&m>=0&&(g=e.substring(0,m+1))}if(d=this.tokenizer.inlineText(g)){e=e.substring(d.raw.length),d.raw.slice(-1)!=="_"&&(a=d.raw.slice(-1)),o=!0;let m=n.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=d.raw,m.text+=d.text):n.push(d);continue}if(e){let m="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return n}},At=class{constructor(t){x(this,"options");x(this,"parser");this.options=t||Ee}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let r=(o=(e||"").match(q.notSpaceStart))==null?void 0:o[0],l=t.replace(q.endingNewline,"")+`
`;return r?'<pre><code class="language-'+oe(r)+'">'+(n?l:oe(l,!0))+`</code></pre>
`:"<pre><code>"+(n?l:oe(l,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let a=0;a<t.items.length;a++){let i=t.items[a];r+=this.listitem(i)}let l=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+l+o+`>
`+r+"</"+l+`>
`}listitem(t){var n;let e="";if(t.task){let r=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=r+" "+oe(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):e+=r+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let l=0;l<t.header.length;l++)n+=this.tablecell(t.header[l]);e+=this.tablerow({text:n});let r="";for(let l=0;l<t.rows.length;l++){let o=t.rows[l];n="";for(let a=0;a<o.length;a++)n+=this.tablecell(o[a]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${oe(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),l=nr(t);if(l===null)return r;t=l;let o='<a href="'+t+'"';return e&&(o+=' title="'+oe(e)+'"'),o+=">"+r+"</a>",o}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let l=nr(t);if(l===null)return oe(n);t=l;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${oe(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:oe(t.text)}},bn=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},de=class rn{constructor(e){x(this,"options");x(this,"renderer");x(this,"textRenderer");this.options=e||Ee,this.options.renderer=this.options.renderer||new At,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new bn}static parse(e,n){return new rn(n).parse(e)}static parseInline(e,n){return new rn(n).parseInline(e)}parse(e,n=!0){var l,o;let r="";for(let a=0;a<e.length;a++){let i=e[a];if((o=(l=this.options.extensions)==null?void 0:l.renderers)!=null&&o[i.type]){let u=i,d=this.options.extensions.renderers[u.type].call({parser:this},u);if(d!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(u.type)){r+=d||"";continue}}let h=i;switch(h.type){case"space":{r+=this.renderer.space(h);continue}case"hr":{r+=this.renderer.hr(h);continue}case"heading":{r+=this.renderer.heading(h);continue}case"code":{r+=this.renderer.code(h);continue}case"table":{r+=this.renderer.table(h);continue}case"blockquote":{r+=this.renderer.blockquote(h);continue}case"list":{r+=this.renderer.list(h);continue}case"html":{r+=this.renderer.html(h);continue}case"paragraph":{r+=this.renderer.paragraph(h);continue}case"text":{let u=h,d=this.renderer.text(u);for(;a+1<e.length&&e[a+1].type==="text";)u=e[++a],d+=`
`+this.renderer.text(u);n?r+=this.renderer.paragraph({type:"paragraph",raw:d,text:d,tokens:[{type:"text",raw:d,text:d,escaped:!0}]}):r+=d;continue}default:{let u='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return r}parseInline(e,n=this.renderer){var l,o;let r="";for(let a=0;a<e.length;a++){let i=e[a];if((o=(l=this.options.extensions)==null?void 0:l.renderers)!=null&&o[i.type]){let u=this.options.extensions.renderers[i.type].call({parser:this},i);if(u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=u||"";continue}}let h=i;switch(h.type){case"escape":{r+=n.text(h);break}case"html":{r+=n.html(h);break}case"link":{r+=n.link(h);break}case"image":{r+=n.image(h);break}case"strong":{r+=n.strong(h);break}case"em":{r+=n.em(h);break}case"codespan":{r+=n.codespan(h);break}case"br":{r+=n.br(h);break}case"del":{r+=n.del(h);break}case"text":{r+=n.text(h);break}default:{let u='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return r}},Vt,ft=(Vt=class{constructor(t){x(this,"options");x(this,"block");this.options=t||Ee}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?ue.lex:ue.lexInline}provideParser(){return this.block?de.parse:de.parseInline}},x(Vt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),Vt),cs=class{constructor(...t){x(this,"defaults",cn());x(this,"options",this.setOptions);x(this,"parse",this.parseMarkdown(!0));x(this,"parseInline",this.parseMarkdown(!1));x(this,"Parser",de);x(this,"Renderer",At);x(this,"TextRenderer",bn);x(this,"Lexer",ue);x(this,"Tokenizer",xt);x(this,"Hooks",ft);this.use(...t)}walkTokens(t,e){var r,l;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let a=o;for(let i of a.header)n=n.concat(this.walkTokens(i.tokens,e));for(let i of a.rows)for(let h of i)n=n.concat(this.walkTokens(h.tokens,e));break}case"list":{let a=o;n=n.concat(this.walkTokens(a.items,e));break}default:{let a=o;(l=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&l[a.type]?this.defaults.extensions.childTokens[a.type].forEach(i=>{let h=a[i].flat(1/0);n=n.concat(this.walkTokens(h,e))}):a.tokens&&(n=n.concat(this.walkTokens(a.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(l=>{if(!l.name)throw new Error("extension name required");if("renderer"in l){let o=e.renderers[l.name];o?e.renderers[l.name]=function(...a){let i=l.renderer.apply(this,a);return i===!1&&(i=o.apply(this,a)),i}:e.renderers[l.name]=l.renderer}if("tokenizer"in l){if(!l.level||l.level!=="block"&&l.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[l.level];o?o.unshift(l.tokenizer):e[l.level]=[l.tokenizer],l.start&&(l.level==="block"?e.startBlock?e.startBlock.push(l.start):e.startBlock=[l.start]:l.level==="inline"&&(e.startInline?e.startInline.push(l.start):e.startInline=[l.start]))}"childTokens"in l&&l.childTokens&&(e.childTokens[l.name]=l.childTokens)}),r.extensions=e),n.renderer){let l=this.defaults.renderer||new At(this.defaults);for(let o in n.renderer){if(!(o in l))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let a=o,i=n.renderer[a],h=l[a];l[a]=(...u)=>{let d=i.apply(l,u);return d===!1&&(d=h.apply(l,u)),d||""}}r.renderer=l}if(n.tokenizer){let l=this.defaults.tokenizer||new xt(this.defaults);for(let o in n.tokenizer){if(!(o in l))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let a=o,i=n.tokenizer[a],h=l[a];l[a]=(...u)=>{let d=i.apply(l,u);return d===!1&&(d=h.apply(l,u)),d}}r.tokenizer=l}if(n.hooks){let l=this.defaults.hooks||new ft;for(let o in n.hooks){if(!(o in l))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let a=o,i=n.hooks[a],h=l[a];ft.passThroughHooks.has(o)?l[a]=u=>{if(this.defaults.async)return Promise.resolve(i.call(l,u)).then(g=>h.call(l,g));let d=i.call(l,u);return h.call(l,d)}:l[a]=(...u)=>{let d=i.apply(l,u);return d===!1&&(d=h.apply(l,u)),d}}r.hooks=l}if(n.walkTokens){let l=this.defaults.walkTokens,o=n.walkTokens;r.walkTokens=function(a){let i=[];return i.push(o.call(this,a)),l&&(i=i.concat(l.call(this,a))),i}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return ue.lex(t,e??this.defaults)}parser(t,e){return de.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},l={...this.defaults,...r},o=this.onError(!!l.silent,!!l.async);if(this.defaults.async===!0&&r.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));l.hooks&&(l.hooks.options=l,l.hooks.block=t);let a=l.hooks?l.hooks.provideLexer():t?ue.lex:ue.lexInline,i=l.hooks?l.hooks.provideParser():t?de.parse:de.parseInline;if(l.async)return Promise.resolve(l.hooks?l.hooks.preprocess(e):e).then(h=>a(h,l)).then(h=>l.hooks?l.hooks.processAllTokens(h):h).then(h=>l.walkTokens?Promise.all(this.walkTokens(h,l.walkTokens)).then(()=>h):h).then(h=>i(h,l)).then(h=>l.hooks?l.hooks.postprocess(h):h).catch(o);try{l.hooks&&(e=l.hooks.preprocess(e));let h=a(e,l);l.hooks&&(h=l.hooks.processAllTokens(h)),l.walkTokens&&this.walkTokens(h,l.walkTokens);let u=i(h,l);return l.hooks&&(u=l.hooks.postprocess(u)),u}catch(h){return o(h)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+oe(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},Se=new cs;function v(t,e){return Se.parse(t,e)}v.options=v.setOptions=function(t){return Se.setOptions(t),v.defaults=Se.defaults,Mr(v.defaults),v};v.getDefaults=cn;v.defaults=Ee;v.use=function(...t){return Se.use(...t),v.defaults=Se.defaults,Mr(v.defaults),v};v.walkTokens=function(t,e){return Se.walkTokens(t,e)};v.parseInline=Se.parseInline;v.Parser=de;v.parser=de.parse;v.Renderer=At;v.TextRenderer=bn;v.Lexer=ue;v.lexer=ue.lex;v.Tokenizer=xt;v.Hooks=ft;v.parse=v;v.options;v.setOptions;v.use;v.walkTokens;v.parseInline;de.parse;ue.lex;/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:Br,setPrototypeOf:or,isFrozen:us,getPrototypeOf:ds,getOwnPropertyDescriptor:hs}=Object;let{freeze:j,seal:Q,create:qr}=Object,{apply:ln,construct:on}=typeof Reflect<"u"&&Reflect;j||(j=function(e){return e});Q||(Q=function(e){return e});ln||(ln=function(e,n,r){return e.apply(n,r)});on||(on=function(e,n){return new e(...n)});const it=G(Array.prototype.forEach),ps=G(Array.prototype.lastIndexOf),sr=G(Array.prototype.pop),Be=G(Array.prototype.push),fs=G(Array.prototype.splice),gt=G(String.prototype.toLowerCase),Ht=G(String.prototype.toString),ar=G(String.prototype.match),qe=G(String.prototype.replace),gs=G(String.prototype.indexOf),ms=G(String.prototype.trim),ne=G(Object.prototype.hasOwnProperty),B=G(RegExp.prototype.test),je=bs(TypeError);function G(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),l=1;l<n;l++)r[l-1]=arguments[l];return ln(t,e,r)}}function bs(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return on(t,n)}}function A(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gt;or&&or(t,null);let r=e.length;for(;r--;){let l=e[r];if(typeof l=="string"){const o=n(l);o!==l&&(us(e)||(e[r]=o),l=o)}t[l]=!0}return t}function ys(t){for(let e=0;e<t.length;e++)ne(t,e)||(t[e]=null);return t}function ce(t){const e=qr(null);for(const[n,r]of Br(t))ne(t,n)&&(Array.isArray(r)?e[n]=ys(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=ce(r):e[n]=r);return e}function Ge(t,e){for(;t!==null;){const r=hs(t,e);if(r){if(r.get)return G(r.get);if(typeof r.value=="function")return G(r.value)}t=ds(t)}function n(){return null}return n}const ir=j(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Bt=j(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),qt=j(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ws=j(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),jt=j(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ks=j(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),cr=j(["#text"]),ur=j(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Gt=j(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),dr=j(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ct=j(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),xs=Q(/\{\{[\w\W]*|[\w\W]*\}\}/gm),As=Q(/<%[\w\W]*|[\w\W]*%>/gm),Ss=Q(/\$\{[\w\W]*/gm),vs=Q(/^data-[\-\w.\u00B7-\uFFFF]+$/),Es=Q(/^aria-[\-\w]+$/),jr=Q(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ts=Q(/^(?:\w+script|data):/i),_s=Q(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Gr=Q(/^html$/i),Ns=Q(/^[a-z][.\w]*(-[.\w]+)+$/i);var hr=Object.freeze({__proto__:null,ARIA_ATTR:Es,ATTR_WHITESPACE:_s,CUSTOM_ELEMENT:Ns,DATA_ATTR:vs,DOCTYPE_NAME:Gr,ERB_EXPR:As,IS_ALLOWED_URI:jr,IS_SCRIPT_OR_DATA:Ts,MUSTACHE_EXPR:xs,TMPLIT_EXPR:Ss});const Ve={element:1,text:3,progressingInstruction:7,comment:8,document:9},Cs=function(){return typeof window>"u"?null:window},Rs=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const l="data-tt-policy-suffix";n&&n.hasAttribute(l)&&(r=n.getAttribute(l));const o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},pr=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Vr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cs();const e=y=>Vr(y);if(e.version="3.2.6",e.removed=[],!t||!t.document||t.document.nodeType!==Ve.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,l=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:i,Element:h,NodeFilter:u,NamedNodeMap:d=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:g,DOMParser:m,trustedTypes:S}=t,w=h.prototype,N=Ge(w,"cloneNode"),J=Ge(w,"remove"),re=Ge(w,"nextSibling"),ee=Ge(w,"childNodes"),te=Ge(w,"parentNode");if(typeof a=="function"){const y=n.createElement("template");y.content&&y.content.ownerDocument&&(n=y.content.ownerDocument)}let O,pe="";const{implementation:fe,createNodeIterator:ge,createDocumentFragment:Xr,getElementsByTagName:Kr}=n,{importNode:Qr}=r;let H=pr();e.isSupported=typeof Br=="function"&&typeof te=="function"&&fe&&fe.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Tt,ERB_EXPR:_t,TMPLIT_EXPR:Nt,DATA_ATTR:Jr,ARIA_ATTR:el,IS_SCRIPT_OR_DATA:tl,ATTR_WHITESPACE:yn,CUSTOM_ELEMENT:nl}=hr;let{IS_ALLOWED_URI:wn}=hr,D=null;const kn=A({},[...ir,...Bt,...qt,...jt,...cr]);let $=null;const xn=A({},[...ur,...Gt,...dr,...ct]);let R=Object.seal(qr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Pe=null,Ct=null,An=!0,Rt=!0,Sn=!1,vn=!0,Te=!1,Je=!0,me=!1,Lt=!1,Mt=!1,_e=!1,et=!1,tt=!1,En=!0,Tn=!1;const rl="user-content-";let It=!0,$e=!1,Ne={},Ce=null;const _n=A({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Nn=null;const Cn=A({},["audio","video","img","source","image","track"]);let Ot=null;const Rn=A({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),nt="http://www.w3.org/1998/Math/MathML",rt="http://www.w3.org/2000/svg",se="http://www.w3.org/1999/xhtml";let Re=se,Dt=!1,Pt=null;const ll=A({},[nt,rt,se],Ht);let lt=A({},["mi","mo","mn","ms","mtext"]),ot=A({},["annotation-xml"]);const ol=A({},["title","style","font","a","script"]);let We=null;const sl=["application/xhtml+xml","text/html"],al="text/html";let P=null,Le=null;const il=n.createElement("form"),Ln=function(c){return c instanceof RegExp||c instanceof Function},$t=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Le&&Le===c)){if((!c||typeof c!="object")&&(c={}),c=ce(c),We=sl.indexOf(c.PARSER_MEDIA_TYPE)===-1?al:c.PARSER_MEDIA_TYPE,P=We==="application/xhtml+xml"?Ht:gt,D=ne(c,"ALLOWED_TAGS")?A({},c.ALLOWED_TAGS,P):kn,$=ne(c,"ALLOWED_ATTR")?A({},c.ALLOWED_ATTR,P):xn,Pt=ne(c,"ALLOWED_NAMESPACES")?A({},c.ALLOWED_NAMESPACES,Ht):ll,Ot=ne(c,"ADD_URI_SAFE_ATTR")?A(ce(Rn),c.ADD_URI_SAFE_ATTR,P):Rn,Nn=ne(c,"ADD_DATA_URI_TAGS")?A(ce(Cn),c.ADD_DATA_URI_TAGS,P):Cn,Ce=ne(c,"FORBID_CONTENTS")?A({},c.FORBID_CONTENTS,P):_n,Pe=ne(c,"FORBID_TAGS")?A({},c.FORBID_TAGS,P):ce({}),Ct=ne(c,"FORBID_ATTR")?A({},c.FORBID_ATTR,P):ce({}),Ne=ne(c,"USE_PROFILES")?c.USE_PROFILES:!1,An=c.ALLOW_ARIA_ATTR!==!1,Rt=c.ALLOW_DATA_ATTR!==!1,Sn=c.ALLOW_UNKNOWN_PROTOCOLS||!1,vn=c.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=c.SAFE_FOR_TEMPLATES||!1,Je=c.SAFE_FOR_XML!==!1,me=c.WHOLE_DOCUMENT||!1,_e=c.RETURN_DOM||!1,et=c.RETURN_DOM_FRAGMENT||!1,tt=c.RETURN_TRUSTED_TYPE||!1,Mt=c.FORCE_BODY||!1,En=c.SANITIZE_DOM!==!1,Tn=c.SANITIZE_NAMED_PROPS||!1,It=c.KEEP_CONTENT!==!1,$e=c.IN_PLACE||!1,wn=c.ALLOWED_URI_REGEXP||jr,Re=c.NAMESPACE||se,lt=c.MATHML_TEXT_INTEGRATION_POINTS||lt,ot=c.HTML_INTEGRATION_POINTS||ot,R=c.CUSTOM_ELEMENT_HANDLING||{},c.CUSTOM_ELEMENT_HANDLING&&Ln(c.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(R.tagNameCheck=c.CUSTOM_ELEMENT_HANDLING.tagNameCheck),c.CUSTOM_ELEMENT_HANDLING&&Ln(c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(R.attributeNameCheck=c.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),c.CUSTOM_ELEMENT_HANDLING&&typeof c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(R.allowCustomizedBuiltInElements=c.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(Rt=!1),et&&(_e=!0),Ne&&(D=A({},cr),$=[],Ne.html===!0&&(A(D,ir),A($,ur)),Ne.svg===!0&&(A(D,Bt),A($,Gt),A($,ct)),Ne.svgFilters===!0&&(A(D,qt),A($,Gt),A($,ct)),Ne.mathMl===!0&&(A(D,jt),A($,dr),A($,ct))),c.ADD_TAGS&&(D===kn&&(D=ce(D)),A(D,c.ADD_TAGS,P)),c.ADD_ATTR&&($===xn&&($=ce($)),A($,c.ADD_ATTR,P)),c.ADD_URI_SAFE_ATTR&&A(Ot,c.ADD_URI_SAFE_ATTR,P),c.FORBID_CONTENTS&&(Ce===_n&&(Ce=ce(Ce)),A(Ce,c.FORBID_CONTENTS,P)),It&&(D["#text"]=!0),me&&A(D,["html","head","body"]),D.table&&(A(D,["tbody"]),delete Pe.tbody),c.TRUSTED_TYPES_POLICY){if(typeof c.TRUSTED_TYPES_POLICY.createHTML!="function")throw je('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof c.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw je('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=c.TRUSTED_TYPES_POLICY,pe=O.createHTML("")}else O===void 0&&(O=Rs(S,l)),O!==null&&typeof pe=="string"&&(pe=O.createHTML(""));j&&j(c),Le=c}},Mn=A({},[...Bt,...qt,...ws]),In=A({},[...jt,...ks]),cl=function(c){let f=te(c);(!f||!f.tagName)&&(f={namespaceURI:Re,tagName:"template"});const b=gt(c.tagName),C=gt(f.tagName);return Pt[c.namespaceURI]?c.namespaceURI===rt?f.namespaceURI===se?b==="svg":f.namespaceURI===nt?b==="svg"&&(C==="annotation-xml"||lt[C]):!!Mn[b]:c.namespaceURI===nt?f.namespaceURI===se?b==="math":f.namespaceURI===rt?b==="math"&&ot[C]:!!In[b]:c.namespaceURI===se?f.namespaceURI===rt&&!ot[C]||f.namespaceURI===nt&&!lt[C]?!1:!In[b]&&(ol[b]||!Mn[b]):!!(We==="application/xhtml+xml"&&Pt[c.namespaceURI]):!1},le=function(c){Be(e.removed,{element:c});try{te(c).removeChild(c)}catch{J(c)}},Me=function(c,f){try{Be(e.removed,{attribute:f.getAttributeNode(c),from:f})}catch{Be(e.removed,{attribute:null,from:f})}if(f.removeAttribute(c),c==="is")if(_e||et)try{le(f)}catch{}else try{f.setAttribute(c,"")}catch{}},On=function(c){let f=null,b=null;if(Mt)c="<remove></remove>"+c;else{const I=ar(c,/^[\r\n\t ]+/);b=I&&I[0]}We==="application/xhtml+xml"&&Re===se&&(c='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+c+"</body></html>");const C=O?O.createHTML(c):c;if(Re===se)try{f=new m().parseFromString(C,We)}catch{}if(!f||!f.documentElement){f=fe.createDocument(Re,"template",null);try{f.documentElement.innerHTML=Dt?pe:C}catch{}}const z=f.body||f.documentElement;return c&&b&&z.insertBefore(n.createTextNode(b),z.childNodes[0]||null),Re===se?Kr.call(f,me?"html":"body")[0]:me?f.documentElement:z},Dn=function(c){return ge.call(c.ownerDocument||c,c,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Wt=function(c){return c instanceof g&&(typeof c.nodeName!="string"||typeof c.textContent!="string"||typeof c.removeChild!="function"||!(c.attributes instanceof d)||typeof c.removeAttribute!="function"||typeof c.setAttribute!="function"||typeof c.namespaceURI!="string"||typeof c.insertBefore!="function"||typeof c.hasChildNodes!="function")},Pn=function(c){return typeof i=="function"&&c instanceof i};function ae(y,c,f){it(y,b=>{b.call(e,c,f,Le)})}const $n=function(c){let f=null;if(ae(H.beforeSanitizeElements,c,null),Wt(c))return le(c),!0;const b=P(c.nodeName);if(ae(H.uponSanitizeElement,c,{tagName:b,allowedTags:D}),Je&&c.hasChildNodes()&&!Pn(c.firstElementChild)&&B(/<[/\w!]/g,c.innerHTML)&&B(/<[/\w!]/g,c.textContent)||c.nodeType===Ve.progressingInstruction||Je&&c.nodeType===Ve.comment&&B(/<[/\w]/g,c.data))return le(c),!0;if(!D[b]||Pe[b]){if(!Pe[b]&&Un(b)&&(R.tagNameCheck instanceof RegExp&&B(R.tagNameCheck,b)||R.tagNameCheck instanceof Function&&R.tagNameCheck(b)))return!1;if(It&&!Ce[b]){const C=te(c)||c.parentNode,z=ee(c)||c.childNodes;if(z&&C){const I=z.length;for(let V=I-1;V>=0;--V){const ie=N(z[V],!0);ie.__removalCount=(c.__removalCount||0)+1,C.insertBefore(ie,re(c))}}}return le(c),!0}return c instanceof h&&!cl(c)||(b==="noscript"||b==="noembed"||b==="noframes")&&B(/<\/no(script|embed|frames)/i,c.innerHTML)?(le(c),!0):(Te&&c.nodeType===Ve.text&&(f=c.textContent,it([Tt,_t,Nt],C=>{f=qe(f,C," ")}),c.textContent!==f&&(Be(e.removed,{element:c.cloneNode()}),c.textContent=f)),ae(H.afterSanitizeElements,c,null),!1)},Wn=function(c,f,b){if(En&&(f==="id"||f==="name")&&(b in n||b in il))return!1;if(!(Rt&&!Ct[f]&&B(Jr,f))){if(!(An&&B(el,f))){if(!$[f]||Ct[f]){if(!(Un(c)&&(R.tagNameCheck instanceof RegExp&&B(R.tagNameCheck,c)||R.tagNameCheck instanceof Function&&R.tagNameCheck(c))&&(R.attributeNameCheck instanceof RegExp&&B(R.attributeNameCheck,f)||R.attributeNameCheck instanceof Function&&R.attributeNameCheck(f))||f==="is"&&R.allowCustomizedBuiltInElements&&(R.tagNameCheck instanceof RegExp&&B(R.tagNameCheck,b)||R.tagNameCheck instanceof Function&&R.tagNameCheck(b))))return!1}else if(!Ot[f]){if(!B(wn,qe(b,yn,""))){if(!((f==="src"||f==="xlink:href"||f==="href")&&c!=="script"&&gs(b,"data:")===0&&Nn[c])){if(!(Sn&&!B(tl,qe(b,yn,"")))){if(b)return!1}}}}}}return!0},Un=function(c){return c!=="annotation-xml"&&ar(c,nl)},zn=function(c){ae(H.beforeSanitizeAttributes,c,null);const{attributes:f}=c;if(!f||Wt(c))return;const b={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$,forceKeepAttr:void 0};let C=f.length;for(;C--;){const z=f[C],{name:I,namespaceURI:V,value:ie}=z,Ue=P(I),Ut=ie;let F=I==="value"?Ut:ms(Ut);if(b.attrName=Ue,b.attrValue=F,b.keepAttr=!0,b.forceKeepAttr=void 0,ae(H.uponSanitizeAttribute,c,b),F=b.attrValue,Tn&&(Ue==="id"||Ue==="name")&&(Me(I,c),F=rl+F),Je&&B(/((--!?|])>)|<\/(style|title)/i,F)){Me(I,c);continue}if(b.forceKeepAttr)continue;if(!b.keepAttr){Me(I,c);continue}if(!vn&&B(/\/>/i,F)){Me(I,c);continue}Te&&it([Tt,_t,Nt],Hn=>{F=qe(F,Hn," ")});const Fn=P(c.nodeName);if(!Wn(Fn,Ue,F)){Me(I,c);continue}if(O&&typeof S=="object"&&typeof S.getAttributeType=="function"&&!V)switch(S.getAttributeType(Fn,Ue)){case"TrustedHTML":{F=O.createHTML(F);break}case"TrustedScriptURL":{F=O.createScriptURL(F);break}}if(F!==Ut)try{V?c.setAttributeNS(V,I,F):c.setAttribute(I,F),Wt(c)?le(c):sr(e.removed)}catch{Me(I,c)}}ae(H.afterSanitizeAttributes,c,null)},ul=function y(c){let f=null;const b=Dn(c);for(ae(H.beforeSanitizeShadowDOM,c,null);f=b.nextNode();)ae(H.uponSanitizeShadowNode,f,null),$n(f),zn(f),f.content instanceof o&&y(f.content);ae(H.afterSanitizeShadowDOM,c,null)};return e.sanitize=function(y){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=null,b=null,C=null,z=null;if(Dt=!y,Dt&&(y="<!-->"),typeof y!="string"&&!Pn(y))if(typeof y.toString=="function"){if(y=y.toString(),typeof y!="string")throw je("dirty is not a string, aborting")}else throw je("toString is not a function");if(!e.isSupported)return y;if(Lt||$t(c),e.removed=[],typeof y=="string"&&($e=!1),$e){if(y.nodeName){const ie=P(y.nodeName);if(!D[ie]||Pe[ie])throw je("root node is forbidden and cannot be sanitized in-place")}}else if(y instanceof i)f=On("<!---->"),b=f.ownerDocument.importNode(y,!0),b.nodeType===Ve.element&&b.nodeName==="BODY"||b.nodeName==="HTML"?f=b:f.appendChild(b);else{if(!_e&&!Te&&!me&&y.indexOf("<")===-1)return O&&tt?O.createHTML(y):y;if(f=On(y),!f)return _e?null:tt?pe:""}f&&Mt&&le(f.firstChild);const I=Dn($e?y:f);for(;C=I.nextNode();)$n(C),zn(C),C.content instanceof o&&ul(C.content);if($e)return y;if(_e){if(et)for(z=Xr.call(f.ownerDocument);f.firstChild;)z.appendChild(f.firstChild);else z=f;return($.shadowroot||$.shadowrootmode)&&(z=Qr.call(r,z,!0)),z}let V=me?f.outerHTML:f.innerHTML;return me&&D["!doctype"]&&f.ownerDocument&&f.ownerDocument.doctype&&f.ownerDocument.doctype.name&&B(Gr,f.ownerDocument.doctype.name)&&(V="<!DOCTYPE "+f.ownerDocument.doctype.name+`>
`+V),Te&&it([Tt,_t,Nt],ie=>{V=qe(V,ie," ")}),O&&tt?O.createHTML(V):V},e.setConfig=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$t(y),Lt=!0},e.clearConfig=function(){Le=null,Lt=!1},e.isValidAttribute=function(y,c,f){Le||$t({});const b=P(y),C=P(c);return Wn(b,C,f)},e.addHook=function(y,c){typeof c=="function"&&Be(H[y],c)},e.removeHook=function(y,c){if(c!==void 0){const f=ps(H[y],c);return f===-1?void 0:fs(H[y],f,1)[0]}return sr(H[y])},e.removeHooks=function(y){H[y]=[]},e.removeAllHooks=function(){H=pr()},e}var ut=Vr();const Ls=typeof window<"u"&&ut&&ut.default?ut.default:ut;v.setOptions({gfm:!0,breaks:!0});const Ms=["p","br","strong","em","u","strike","del","s","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","table","thead","tbody","tr","th","td","a","img","hr","div","span"],Is={a:["href","title"],img:["src","alt","title","width","height"],table:["class"],th:["align","class"],td:["align","class"],code:["class"],pre:["class"],div:["class"],span:["class"]};function Yr(t){if(!t||typeof t!="string")return"";try{const e=v(t);return Ls.sanitize(e,{ALLOWED_TAGS:Ms,ALLOWED_ATTR:Is,ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!1,FORBID_TAGS:["script","object","embed","form","input","button"],FORBID_ATTR:["onload","onerror","onclick","onmouseover","onfocus","onblur"]})}catch(e){return console.error("Error rendering markdown:",e),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}}function Os(t){const{worldName:e,messages:n=[],userInput:r="",messagesLoading:l,isSending:o,isWaiting:a,activeAgent:i,selectedAgent:h,currentChat:u}=t;u&&!u.isSaved&&n.length>0&&n.filter(g=>g.sender!=="HUMAN"&&g.sender!=="human"&&g.sender!=="system"&&g.type!=="user");const d=g=>{const m=wt(g.sender),S=wt(g.fromAgentId);return m!==S};return s.h("fieldset",{className:"chat-fieldset"},s.h("legend",null,e," - ",u?u.name:"",u&&!u.isSaved&&s.h("span",{className:"unsaved-indicator",title:"Unsaved chat"}," ●")),s.h("div",{className:"chat-container"},s.h("div",{className:"conversation-area",ref:g=>g.scrollTop=g.scrollHeight},l?s.h("div",{className:"loading-messages"},"Loading messages..."):n.length===0?s.h("div",{className:"no-messages"},"No messages yet. Start a conversation!"):n.map((g,m)=>{const S=d(g),w=g.sender==="system"||g.sender==="SYSTEM",ee=`message ${g.sender==="HUMAN"||g.sender==="USER"||g.type==="user"?"user-message":"agent-message"} ${w?"system-message":""} ${S?"cross-agent-message":""}`.trim();return s.h("div",{key:g.id||m,className:ee},s.h("div",{className:"message-sender"},g.sender||(g.type==="user"?"User":"Agent"),S&&g.fromAgentId&&s.h("span",{className:"source-agent-indicator",title:`From agent: ${g.fromAgentId}`},"→ ",g.fromAgentId)),s.h("div",{className:"message-content"},bt(Yr(g.text))),s.h("div",{className:"message-timestamp"},g.createdAt?new Date(g.createdAt).toLocaleTimeString():"Now"),g.isStreaming&&s.h("div",{className:"streaming-indicator"},s.h("div",{className:"streaming-content"},s.h("div",{className:`agent-sprite sprite-${(i==null?void 0:i.spriteIndex)??0}`}),s.h("span",null,"responding ..."))),g.hasError&&s.h("div",{className:"error-indicator"},"Error: ",g.errorMessage),s.h("div",{className:"message-debug-info"},JSON.stringify({type:g.type,sender:g.sender,fromAgentId:g.fromAgentId})))}),a&&s.h("div",{className:"message user-message waiting-message"},s.h("div",{className:"message-content"},s.h("div",{className:"waiting-dots"},s.h("span",null,"."),s.h("span",null,"."),s.h("span",null,"."))))),s.h("div",{className:"input-area"},s.h("div",{className:"input-container"},s.h("input",{type:"text",className:"message-input",placeholder:"Type your message...",value:r||"",$oninput:"update-input",$onkeypress:"key-press"}),s.h("button",{className:"send-button",$onclick:"send-message",disabled:!r.trim()||o},o?"Sending...":"Send")))))}function Ds(t){const{world:e,selectedSettingsTarget:n,selectedAgent:r,totalMessages:l}=t,o=()=>{n==="agent"&&r?confirm(`Clear all messages for agent ${r.name}?`)&&s.run("clear-agent-messages",r):n==="world"&&e&&confirm(`Clear all messages for world ${e.name}?`)&&s.run("clear-world-messages")};return s.h("fieldset",{className:"settings-fieldset"},s.h("legend",null,n==="agent"&&r?`${r.name} Settings`:n==="world"&&e?`${e.name} Settings`:"Settings"),s.h("div",{className:"chat-settings"},n==="agent"&&r?s.h("div",{className:"agent-settings"},s.h("div",{className:"setting-item"},s.h("label",null,"Agent Name:"),s.h("span",null,s.h("span",{className:"setting-value"},r.name),s.h("button",{className:"action-btn",$onclick:["open-agent-edit",r],title:"Edit agent"},s.h("span",{className:"btn-icon"},"⚙")),s.h("button",{className:"action-btn",$onclick:["open-agent-delete",r],title:"Delete agent"},s.h("span",{className:"btn-icon"},"×")))),s.h("div",{className:"setting-item"},s.h("label",null,"Message Count:"),s.h("span",null,s.h("span",{className:"setting-value"},r.messageCount),s.h("button",{className:"action-btn",onclick:o,title:"Clear agent messages"},s.h("span",{className:"btn-icon"},"-")))),s.h("div",{className:"setting-item"},s.h("label",null,"LLM Provider:"),s.h("span",{className:"setting-value"},r.provider||"N/A")),s.h("div",{className:"setting-item"},s.h("label",null,"Model:"),s.h("span",{className:"setting-value"},r.model||"N/A")),s.h("div",{className:"setting-item"},s.h("label",null,"Temperature:"),s.h("span",{className:"setting-value"},r.temperature!==void 0?r.temperature:"N/A")),s.h("div",{className:"setting-item"},s.h("label",null,"System Prompt:"),s.h("span",{className:"system-prompt-preview"},r.systemPrompt?r.systemPrompt.length>100?r.systemPrompt.substring(0,100)+"...":r.systemPrompt:"N/A"))):n==="world"&&e?s.h("div",{className:"world-settings"},s.h("div",{className:"setting-item"},s.h("label",null,"World Name:"),s.h("span",null,s.h("span",{className:"setting-value"},e.name),s.h("button",{className:"action-btn",$onclick:"open-world-edit",title:"Edit world"},s.h("span",{className:"btn-icon"},"⚙")))),s.h("div",{className:"setting-item"},s.h("label",null,"Agents Count:"),s.h("span",null,s.h("span",{className:"setting-value"},e.agents.length),s.h("button",{className:"action-btn",$onclick:"open-agent-create",title:"Add new agent"},s.h("span",{className:"btn-icon"},"+")))),s.h("div",{className:"setting-item"},s.h("label",null,"Total Messages:"),s.h("span",null,s.h("span",{className:"setting-value"},l),s.h("button",{className:"action-btn",$onclick:o,title:"Clear all messages"},s.h("span",{className:"btn-icon"},"-")))),s.h("div",{className:"setting-item"},s.h("label",null,"LLM Call Limit:"),s.h("span",{className:"setting-value"},e.llmCallLimit||"Unlimited"))):s.h("div",{className:"default-settings"},s.h("p",null,"Click on an agent or the gear icon to view settings"))))}function Ps(t){const{world:e}=t,n=e&&e.agents&&e.agents.length>0,r=(e==null?void 0:e.chats)||[];return s.h("fieldset",{className:"settings-fieldset"},s.h("legend",null,"Chat History"),s.h("div",{className:"chat-history-header centered"},s.h("button",{className:"new-chat-btn",$onclick:"create-new-chat",title:n?"Create new chat session":"Create an agent first to enable new chats",disabled:!n},"✚ New Chat")),s.h("div",{className:"chat-history-container"},r.length===0?s.h("div",{className:"no-chats"},s.h("p",null,"No chat history entries found."),s.h("p",null,"Start a conversation with agents to auto-save chats.")):s.h("ul",{className:"chat-list simplified-chat-list"},r.map(l=>s.h("li",{key:l.id,className:"chat-item simplified-chat-item chat-list-li"},s.h("span",{className:"chat-title clickable chat-list-title",$onclick:["load-chat-from-history",l.id],title:l.name},l.name),s.h("button",{className:"chat-close-btn chat-list-close-btn",$onclick:["chat-history-show-delete-confirm",l],title:"Delete chat"},"×"))))))}const $s=t=>({mode:t.mode||"create",worldName:t.worldName,agent:t.agent||Zr,parentComponent:t.parentComponent,loading:!1}),Zr={name:"",description:"",provider:"ollama",model:"llama3.2:3b",temperature:.7,maxTokens:2048,systemPrompt:"You are a helpful assistant."},fr=async function*(t){if(!t.agent.name.trim()){yield{...t,error:"Agent name is required"};return}yield{...t,loading:!0,error:null};try{t.mode==="create"?await L.createAgent(t.worldName,t.agent):await L.updateAgent(t.worldName,t.agent.name,t.agent);const e=t.mode==="create"?"Agent created successfully!":"Agent updated successfully!";yield{...t,loading:!1,successMessage:e},setTimeout(()=>{t.parentComponent.run("agent-saved")},2e3)}catch(e){yield{...t,loading:!1,error:e.message||"Failed to save agent"}}},gr=async function*(t){yield{...t,loading:!0,error:null};try{await L.deleteAgent(t.worldName,t.agent.name),yield{...t,loading:!1,successMessage:"Agent deleted successfully!"},setTimeout(()=>{t.parentComponent.run("agent-deleted")},2e3)}catch(e){yield{...t,loading:!1,error:e.message||"Failed to delete agent"}}},xe=t=>{t!=null&&t.parentComponent&&typeof t.parentComponent.run=="function"?t.parentComponent.run("close-agent-edit"):s.run("close-agent-edit")};class Ws extends Ae{constructor(){super(...arguments);x(this,"mounted",n=>$s(n));x(this,"state",{mode:"create",worldName:"",agent:Zr,parentComponent:void 0,loading:!0});x(this,"view",n=>{if(n.loading)return s.h("div",{className:"modal-backdrop"},s.h("div",{className:"modal-content"},s.h("div",{className:"modal-body"},s.h("div",{className:"loading-spinner"},n.mode==="create"?"Creating agent...":n.mode==="edit"?"Updating agent...":"Deleting agent..."))));if(n.successMessage)return s.h("div",{className:"modal-backdrop",$onclick:xe},s.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},s.h("div",{className:"modal-header"},s.h("h2",{className:"modal-title"},"Success!"),s.h("button",{className:"modal-close-btn",$onclick:xe,title:"Close"},"×")),s.h("div",{className:"modal-body"},s.h("div",{className:"success-message"},s.h("p",null,n.successMessage)))));const r=n.mode==="edit",l=n.mode==="delete";let o;return l?o=`Delete ${n.agent.name||"Agent"}`:r?o=`Edit ${n.agent.name||"Agent"}`:o="Create New Agent",s.h("div",{className:"modal-backdrop",$onclick:xe},s.h("div",{className:"modal-content agent-edit-modal",onclick:a=>a.stopPropagation()},s.h("div",{className:"modal-header"},s.h("h2",{className:"modal-title"},o),s.h("button",{className:"modal-close-btn",$onclick:xe,title:"Close"},"×")),s.h("div",{className:"modal-body"},n.error&&s.h("div",{className:"error-message"},n.error),l?s.h("div",{className:"delete-confirmation"},s.h("p",{className:"delete-confirmation-text"},"Are you sure you want to delete ",s.h("span",{className:"delete-confirmation-name"},'"',n.agent.name,'"'),"?"),s.h("p",{className:"delete-confirmation-text"},"This action cannot be undone.")):s.h("form",{className:"agent-form"},s.h("div",{className:`form-group ${r?"hidden":""}`},s.h("div",{className:"form-row"},s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-name"},"Agent Name *"),s.h("input",{id:"agent-name",type:"text",className:"form-input",placeholder:"Enter agent name",value:n.agent.name,$bind:"agent.name",disabled:n.loading})))),s.h("div",{className:"form-section"},s.h("div",{className:"form-row"},s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-provider"},"Provider"),s.h("select",{id:"agent-provider",className:"form-select",value:n.agent.provider,$bind:"agent.provider",disabled:n.loading},s.h("option",{value:"",selected:!n.agent.provider},"Select provider"),s.h("option",{value:"openai",selected:n.agent.provider==="openai"},"OpenAI"),s.h("option",{value:"anthropic",selected:n.agent.provider==="anthropic"},"Anthropic"),s.h("option",{value:"google",selected:n.agent.provider==="google"},"Google"),s.h("option",{value:"azure",selected:n.agent.provider==="azure"},"Azure"),s.h("option",{value:"ollama",selected:n.agent.provider==="ollama"},"Ollama"))),s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-model"},"Model"),s.h("input",{id:"agent-model",type:"text",className:"form-input",placeholder:"e.g. gpt-4, claude-3-sonnet, llama3.2:3b",value:n.agent.model,$bind:"agent.model",disabled:n.loading})))),s.h("div",{className:"form-section"},s.h("div",{className:"form-row"},s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-temperature"},"Temperature"),s.h("input",{id:"agent-temperature",type:"number",className:"form-input",placeholder:"0.0 - 2.0",min:"0",max:"2",step:"0.1",value:n.agent.temperature,$bind:"agent.temperature",disabled:n.loading})),s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-max-tokens"},"Max Tokens"),s.h("input",{id:"agent-max-tokens",type:"number",className:"form-input",placeholder:"e.g. 2048",min:"1",max:"32768",step:"1",value:n.agent.maxTokens,$bind:"agent.maxTokens",disabled:n.loading})))),s.h("div",{className:"form-section"},s.h("div",{className:"form-group"},s.h("label",{htmlFor:"agent-prompt"},"System Prompt"),s.h("textarea",{id:"agent-prompt",className:"form-textarea agent-system-prompt-textarea",placeholder:"Enter the system prompt for this agent...",rows:12,value:n.agent.systemPrompt,$bind:"agent.systemPrompt",disabled:n.loading}))))),s.h("div",{className:"modal-footer"},s.h("div",{className:"modal-actions"},l?s.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},s.h("button",{className:"btn btn-secondary",$onclick:xe,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-danger",$onclick:[gr],disabled:n.loading},n.loading?"Deleting...":"Delete")):r?s.h(s.Fragment,null,s.h("button",{className:"btn btn-danger",$onclick:[gr],disabled:n.loading,title:"Delete agent"},n.loading?"Deleting...":"Delete"),s.h("div",{className:"modal-primary-actions"},s.h("button",{className:"btn btn-secondary",$onclick:xe,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-primary",$onclick:[fr],disabled:n.loading||!n.agent.name.trim()},n.loading?"Saving...":"Update"))):s.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},s.h("button",{className:"btn btn-secondary",$onclick:xe,disabled:n.loading},"Cancel"),s.h("button",{className:"btn btn-primary",$onclick:[fr],disabled:n.loading||!n.agent.name.trim()},n.loading?"Saving...":"Create"))))))})}}function Et(t){return t&&typeof t=="object"&&typeof t.worldName=="string"&&Array.isArray(t.messages)&&t.world&&Array.isArray(t.world.agents)}function Us(t){return!t||!t.currentChatId?null:t.chats.find(e=>e.id===t.currentChatId)||null}function zs(t){const e=Us(t);return e?{id:e.id,name:e.name,isSaved:!0,messageCount:e.messageCount,lastUpdated:new Date(e.updatedAt)}:{id:(t==null?void 0:t.currentChatId)||null,name:"New Chat",isSaved:!1,messageCount:0,lastUpdated:new Date}}const Z=(t,e)=>{s!=null&&s.run?s.run(t,e):console.warn("AppRun app not available for event:",t)};let Y={activeMessages:new Map,currentWorldName:null};const Fs=t=>{var e;!t||typeof t!="object"||(t.type==="sse"?Hs(t):t.type==="message"?Z("handleMessage",t):t.type==="response"||(t.type==="error"?Z("handleError",{message:t.message||"SSE error"}):t.type==="connected"?(Z("handleConnectionStatus","connected"),Y.currentWorldName=((e=t.payload)==null?void 0:e.worldName)||null):t.type==="complete"&&Z("handleComplete",t.payload)))},Hs=t=>{const e=t.data;if(!e)return;const n=e.messageId||"default",r=e.sender||"Agent";switch(e.type){case"start":Y.activeMessages.set(n,{content:"",sender:r,messageId:n,isStreaming:!0}),Z("handleStreamStart",{messageId:n,sender:r,worldName:e.worldName||Y.currentWorldName});break;case"chunk":const l=Y.activeMessages.get(n);if(l){const a=e.accumulatedContent!==void 0?e.accumulatedContent:l.content+(e.content||"");l.content=a,Z("handleStreamChunk",{messageId:n,sender:r,content:a,isAccumulated:e.accumulatedContent!==void 0,worldName:e.worldName||Y.currentWorldName})}break;case"end":const o=Y.activeMessages.get(n);if(o){const a=e.finalContent!==void 0?e.finalContent:o.content;Z("handleStreamEnd",{messageId:n,sender:r,content:a,worldName:e.worldName||Y.currentWorldName}),Y.activeMessages.delete(n),Y.activeMessages.size}break;case"error":Z("handleStreamError",{messageId:n,sender:r,error:e.error||"Streaming error",worldName:e.worldName||Y.currentWorldName}),Y.activeMessages.delete(n);break;case"chat-created":Z("handleChatCreated",{worldName:e.worldName||Y.currentWorldName,chatData:e.content?JSON.parse(e.content):{}});break;case"chat-updated":Z("handleChatUpdated",{worldName:e.worldName||Y.currentWorldName,chatData:e.content?JSON.parse(e.content):{}});break}};async function Bs(t,e,n="HUMAN",r,l,o){if(!t||!e)throw new Error("World name and message are required");if(!e.trim())throw new Error("Message cannot be empty");Y.currentWorldName=t;const a={message:e,sender:n},h=(await U(`/worlds/${encodeURIComponent(t)}/chat`,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"}})).body.getReader(),u=new TextDecoder;let d="",g=!0;const m=()=>{if(g){g=!1;try{h.cancel()}catch(w){console.warn("Error canceling SSE reader:",w)}}};return(async()=>{try{for(;g;){const{done:w,value:N}=await h.read();if(w)break;d+=u.decode(N,{stream:!0});const J=d.split(`
`);d=J.pop()||"";for(const re of J)if(re.trim()!==""&&re.startsWith("data: "))try{const ee=re.slice(6).trim();if(ee==="")continue;const te=JSON.parse(ee);Fs(te),te.type}catch(ee){console.error("Error parsing SSE data:",ee),Z("handleError",{message:"Failed to parse SSE data"})}}}catch(w){console.error("SSE stream error:",w);const N={message:w.message||"SSE stream error"};Z("handleError",N)}finally{m()}})(),m}const qs=(t,e)=>{const{messageId:n,sender:r,worldName:l}=e,o=r||"Agent";let a;if(Et(t)&&t.world&&Array.isArray(t.world.agents)){const i=t.world.agents.find(h=>h.name===o);a=i==null?void 0:i.id}return{...t,messages:[...t.messages||[],{id:Date.now()+Math.random(),type:"agent-stream",sender:o,text:"",createdAt:new Date().toISOString(),worldName:l||t.worldName,isStreaming:!0,messageId:n,fromAgentId:a}],needScroll:!0}},js=(t,e)=>{const{messageId:n,sender:r,content:l,isAccumulated:o}=e,a=[...t.messages||[]];for(let i=a.length-1;i>=0;i--)if(a[i].isStreaming&&(a[i].messageId===n||!n&&a[i].sender===r&&a[i].type==="agent-stream"))return a[i]={...a[i],text:l||"",createdAt:new Date().toISOString()},{...t,messages:a,needScroll:!0};return{...t,messages:[...a,{id:Date.now()+Math.random(),type:"agent-stream",sender:r||"Agent",text:l||"",createdAt:new Date().toISOString(),worldName:e.worldName||t.worldName,isStreaming:!0,messageId:n}],needScroll:!0}},Gs=(t,e)=>(t.messages=t.messages.filter(n=>n.messageId!==e.messageId),t),Vs=(t,e)=>{const{messageId:n,sender:r,error:l}=e,o=(t.messages||[]).map(a=>a.isStreaming&&(a.messageId===n||!n&&a.sender===r&&a.type==="agent-stream")?{...a,isStreaming:!1,hasError:!0,errorMessage:l}:a);return{...t,messages:o}},Ys=(t,e)=>{const n=e.data||{},r=n.sender||n.agentName||"Agent";let l;if(Et(t)&&t.world&&Array.isArray(t.world.agents)){const a=t.world.agents.find(i=>i.name===r);a&&a.messageCount++,l=a==null?void 0:a.id}const o={id:Date.now()+Math.random(),type:n.type||"message",sender:r,text:n.content||n.message||"",createdAt:n.createdAt||new Date().toISOString(),worldName:n.worldName||t.worldName,fromAgentId:l};return{...t,messages:[...t.messages||[],o],needScroll:!0,isWaiting:!1}},Zs=(t,e)=>({...t,connectionStatus:e,wsError:e==="error"?t.wsError:null}),Xs=(t,e)=>{const n=e.message||"SSE error",r={id:Date.now()+Math.random(),type:"error",sender:"System",text:n,createdAt:new Date().toISOString(),worldName:t.worldName,hasError:!0};return{...t,wsError:n,messages:[...t.messages||[],r],needScroll:!0}},Ks=(t,e)=>({...t,connectionStatus:"completed",isSending:!1,isWaiting:!1}),Qs=(t,e)=>(Et(t)&&e.worldName===t.worldName&&setTimeout(()=>{Z("reloadWorldChats",{worldName:e.worldName})},100),t),Js=(t,e)=>(Et(t)&&e.worldName===t.worldName&&setTimeout(()=>{Z("reloadWorldChats",{worldName:e.worldName})},100),t),ea={"/World":async function*(t,e,n){if(!e){location.href="/";return}const r=decodeURIComponent(e);try{yield{...t,worldName:r,loading:!0,error:null,isWaiting:!1,activeAgent:null};const l=await L.getWorld(r);if(!l){yield{...t,worldName:r,loading:!1,error:"World not found",isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null};return}let o=[];if(n)try{const d=await L.getChat(r,n);d&&d.messages&&(o=d.messages)}catch(d){console.warn("Failed to load specific chat:",d)}let a=[];const i=await Promise.all(l.agents.map(async(d,g)=>{var m;if(d.memory&&Array.isArray(d.memory)){const S=d.memory.map(w=>{const N=wt(w.sender||d.name);let J="agent";return(N==="HUMAN"||N==="USER")&&(J="user"),{id:w.id||`${w.createdAt||Date.now()}-${Math.random()}`,sender:N,text:w.text||w.content||"",createdAt:w.createdAt||new Date().toISOString(),type:J,fromAgentId:d.id}});a=a.concat(S)}return{...d,spriteIndex:g%9,messageCount:((m=d.memory)==null?void 0:m.length)||0}})),h=a.sort((d,g)=>{const m=new Date(d.createdAt).getTime(),S=new Date(g.createdAt).getTime();return m-S}),u=o.length>0?o:h;yield{...t,worldName:r,world:l,messages:u,loading:!1,error:null,isWaiting:!1,selectedSettingsTarget:"chat",selectedAgent:null,activeAgent:null,chatToDelete:null}}catch(l){yield{...t,worldName:r,world:null,loading:!1,error:l.message||"Failed to load world data",isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null}}},"update-input":(t,e)=>({...t,userInput:e.target.value}),"key-press":(t,e)=>{e.key==="Enter"&&(t.userInput||"").trim()&&s.run("send-message")},"send-message":async t=>{if(!(t.userInput||"").trim())return t;const e=t.userInput||"",n={id:Date.now()+Math.random(),type:"user",sender:"HUMAN",text:e,createdAt:new Date().toISOString(),worldName:t.worldName,userEntered:!0},r={...t,messages:[...t.messages||[],n],userInput:"",isSending:!0,isWaiting:!0};try{return await Bs(t.worldName,e,"HUMAN"),{...r,isSending:!1}}catch(l){return{...r,isSending:!1,isWaiting:!1,error:l.message||"Failed to send message"}}},handleStreamStart:(t,e)=>{var o;const n=qs(t,e),r=e.sender,l=(o=t.world)==null?void 0:o.agents.find(a=>a.name===r);return{...n,isWaiting:!1,activeAgent:l?{spriteIndex:l.spriteIndex,name:l.name}:null}},handleStreamChunk:(t,e)=>js(t,e),handleStreamEnd:(t,e)=>({...Gs(t,e),activeAgent:null}),handleStreamError:(t,e)=>({...Vs(t,e),activeAgent:null}),handleMessage:async(t,e)=>{var r,l;const n=Ys(t,e);if(((r=e==null?void 0:e.data)==null?void 0:r.type)==="chat-created"||((l=e==null?void 0:e.data)==null?void 0:l.type)==="chat-updated"){const o=await L.getWorld(t.worldName);return o?{...n,world:o}:{...n,error:"World not found"}}return n},handleConnectionStatus:(t,e)=>Zs(t,e),handleError:(t,e)=>Xs(t,e),handleComplete:(t,e)=>Ks(t),handleChatCreated:(t,e)=>Qs(t,e),handleChatUpdated:(t,e)=>Js(t,e),"clear-agent-messages":async(t,e)=>{var n,r;try{await L.clearAgentMemory(t.worldName,e.name);const l=(n=t.world)==null?void 0:n.agents.map(h=>h.id===e.id?{...h,messageCount:0}:h),o=(t.messages||[]).filter(h=>h.sender!==e.name),a=((r=t.selectedAgent)==null?void 0:r.id)===e.id?{...t.selectedAgent,messageCount:0}:t.selectedAgent,i=t.world?{...t.world,agents:l??[]}:null;return{...t,world:i,messages:o,selectedAgent:a}}catch(l){return{...t,error:l.message||"Failed to clear agent messages"}}},"clear-world-messages":async t=>{var e,n;try{await Promise.all((((e=t.world)==null?void 0:e.agents)??[]).map(a=>L.clearAgentMemory(t.worldName,a.name)));const r=(((n=t.world)==null?void 0:n.agents)??[]).map(a=>({...a,messageCount:0})),l=t.selectedAgent?{...t.selectedAgent,messageCount:0}:null,o=t.world?{...t.world,agents:r??[]}:null;return{...t,world:o,messages:[],selectedAgent:l}}catch(r){return{...t,error:r.message||"Failed to clear world messages"}}},"select-world-settings":t=>({...t,selectedSettingsTarget:"world",selectedAgent:null,messages:(t.messages||[]).filter(e=>!e.userEntered)}),"select-agent-settings":(t,e)=>{var n;return t.selectedSettingsTarget==="agent"&&((n=t.selectedAgent)==null?void 0:n.id)===e.id?{...t,selectedSettingsTarget:"world",selectedAgent:null,messages:(t.messages||[]).filter(r=>!r.userEntered),userInput:""}:{...t,selectedSettingsTarget:"agent",selectedAgent:e,messages:(t.messages||[]).filter(r=>!r.userEntered),userInput:"@"+wt(e.name||"")+" "}},"select-chat-history":async t=>{const e={...t,selectedSettingsTarget:"chat",selectedAgent:null,messages:(t.messages||[]).filter(n=>!n.userEntered),loading:!0,error:null};try{return{...e,loading:!1}}catch(n){return{...e,loading:!1,error:n.message||"Failed to load chat history"}}},"toggle-settings-chat-history":t=>t.selectedSettingsTarget!=="world"?{...t,selectedSettingsTarget:"world"}:(s.run("select-chat-history"),t),"chat-history-show-delete-confirm":(t,e)=>({...t,chatToDelete:e}),"chat-history-delete-confirm":async t=>t,"chat-history-hide-modals":t=>({...t,chatToDelete:null}),"delete-agent":async(t,e)=>{var n,r,l;try{await L.deleteAgent(t.worldName,e.name);const o=(((n=t.world)==null?void 0:n.agents)??[]).filter(d=>d.id!==e.id),a=(t.messages||[]).filter(d=>d.sender!==e.name),i=t.world?{...t.world,agents:o??[]}:null,h=((r=t.selectedAgent)==null?void 0:r.id)===e.id?null:t.selectedAgent,u=((l=t.selectedAgent)==null?void 0:l.id)===e.id?"world":t.selectedSettingsTarget;return{...t,world:i,messages:a,selectedAgent:h,selectedSettingsTarget:u}}catch(o){return{...t,error:o.message||"Failed to delete agent"}}},"export-world-markdown":async(t,e)=>{try{return window.location.href=`/api/worlds/${encodeURIComponent(e)}/export`,t}catch(n){return{...t,error:n.message||"Failed to export world"}}},"view-world-markdown":async(t,e)=>{try{const n=await L.getWorldMarkdown(e),r=Yr(n),l=`
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Export: ${e}</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3 { color: #2c3e50; }
        h1 { border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #bdc3c7; padding-bottom: 5px; }
        code { 
            background: #f8f9fa; 
            padding: 2px 4px; 
            border-radius: 3px; 
            font-family: 'Monaco', 'Consolas', monospace;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            padding: 0;
        }
        ul { padding-left: 20px; }
        li { margin-bottom: 5px; }
        hr { 
            border: none; 
            height: 1px; 
            background: #bdc3c7; 
            margin: 30px 0; 
        }
        strong { color: #2c3e50; }
    </style>
</head>
<body>
    ${r}
</body>
</html>`,o=window.open();return o&&(o.document.write(l),o.document.close()),t}catch(n){return{...t,error:n.message||"Failed to view world markdown"}}},"create-new-chat":async function*(t){try{if(yield{...t,loading:!0},(await L.createNewChat(t.worldName)).success){const n=await L.getWorld(t.worldName);yield{...t,loading:!1,world:n,messages:[],selectedAgent:null,activeAgent:null,userInput:"",chatToDelete:null}}else yield{...t,loading:!1,error:"Failed to create new chat"}}catch(e){yield{...t,loading:!1,error:e.message||"Failed to create new chat"}}},"load-chat-from-history":async function*(t,e){try{yield{...t,loading:!0};const n=await L.loadChatById(t.worldName,e);if(n.success){const r=await L.getChat(t.worldName,e);yield{...t,loading:!1,world:n.world,messages:r.messages||[],selectedAgent:null,activeAgent:null,userInput:"",error:null,chatToDelete:null}}else yield{...t,loading:!1,error:"Failed to load chat"}}catch(n){yield{...t,loading:!1,error:n.message||"Failed to load chat from history"}}},"delete-chat-from-history":async function*(t,e){try{yield{...t,loading:!0,chatToDelete:null},await L.deleteChat(t.worldName,e);const n=await L.getWorld(t.worldName),r=n.currentChatId===null||n.currentChatId===e;yield{...t,world:n,loading:!1,chatToDelete:null,messages:r?[]:t.messages}}catch(n){yield{...t,loading:!1,chatToDelete:null,error:n.message||"Failed to delete chat"}}},reloadWorldChats:async function*(t,e){try{if(e.worldName&&e.worldName!==t.worldName)return t;const n=await L.getWorld(t.worldName);n&&(yield{...t,world:n})}catch(n){console.warn("Failed to reload world chats:",n.message)}}};class ta extends Ae{constructor(){super(...arguments);x(this,"state",async()=>({worldName:"World",world:null,messages:[],userInput:"",loading:!0,error:null,messagesLoading:!1,isSending:!1,isWaiting:!1,selectedSettingsTarget:"chat",selectedAgent:null,activeAgent:null,showAgentEdit:!1,agentEditMode:"create",selectedAgentForEdit:null,showWorldEdit:!1,worldEditMode:"edit",selectedWorldForEdit:null,chatToDelete:null,connectionStatus:"disconnected",wsError:null,needScroll:!1}));x(this,"view",n=>{var r,l,o;return n.loading?s.h("div",{className:"world-container"},s.h("div",{className:"world-columns"},s.h("div",{className:"chat-column"},s.h("div",{className:"agents-section"},s.h("div",{className:"agents-row"},s.h("div",{className:"loading-agents"},"Loading..."))),s.h("div",{className:"loading-state"},s.h("p",null,"Loading world data..."))),s.h("div",{className:"settings-column"},s.h("div",{className:"settings-section"},s.h("div",{className:"settings-row"},s.h("button",{className:"world-settings-btn",title:"World Settings"},s.h("span",{className:"world-gear-icon"},"⚙"))))))):n.error?s.h("div",{className:"world-container"},s.h("div",{className:"world-columns"},s.h("div",{className:"chat-column"},s.h("div",{className:"agents-section"},s.h("div",{className:"agents-row"},s.h("div",{className:"no-agents"},"Error"))),s.h("div",{className:"error-state"},s.h("p",null,"Error: ",n.error),s.h("button",{$onclick:["/World",n.worldName]},"Retry"))),s.h("div",{className:"settings-column"},s.h("div",{className:"settings-section"},s.h("div",{className:"settings-row"},s.h("button",{className:"world-settings-btn",title:"World Settings"},s.h("span",{className:"world-gear-icon"},"⚙"))))))):s.h("div",{className:"world-container"},s.h("div",{className:"world-columns"},s.h("div",{className:"chat-column"},s.h("div",{className:"agents-section"},s.h("div",{className:"agents-row agents-row-with-back"},s.h("div",{className:"back-button-container"},s.h("a",{href:"/"},s.h("button",{className:"back-button",title:"Back to Worlds"},s.h("span",{className:"world-back-icon"},"←")))),s.h("div",{className:"agents-list-container"},n.loading?s.h("div",{className:"loading-agents"},"Loading agents..."):(l=(r=n.world)==null?void 0:r.agents)!=null&&l.length?s.h("div",{className:"agents-list"},(o=n.world)==null?void 0:o.agents.map((a,i)=>{var u;const h=n.selectedSettingsTarget==="agent"&&((u=n.selectedAgent)==null?void 0:u.id)===a.id;return s.h("div",{key:`agent-${a.id||i}`,className:`agent-item ${h?"selected":""}`,$onclick:["select-agent-settings",a]},s.h("div",{className:"agent-sprite-container"},s.h("div",{className:`agent-sprite sprite-${a.spriteIndex}`}),s.h("div",{className:"message-badge"},a.messageCount)),s.h("div",{className:"agent-name"},a.name))})):s.h("div",{className:"no-agents"},"No agents in this world:",s.h("span",null," ",bt(`<a href="#" onclick="app.run('open-agent-create')">Create Agent</a>`)))))),s.h(Os,{worldName:n.worldName,messages:n.messages,userInput:n.userInput,messagesLoading:n.messagesLoading,isSending:n.isSending,isWaiting:n.isWaiting,activeAgent:n.activeAgent,selectedAgent:n.selectedSettingsTarget==="agent"?n.selectedAgent:null,currentChat:zs(n.world)})),s.h("div",{className:"settings-column"},s.h("div",{className:"settings-section"},s.h("div",{className:"settings-row"},s.h("button",{className:"world-settings-btn",title:"Toggle Settings/Chat History",$onclick:"toggle-settings-chat-history"},s.h("span",{className:"world-gear-icon"},"⊕")),s.h("button",{className:"world-settings-btn",$onclick:["export-world-markdown",n.world.name],title:"Export world to markdown file",style:{marginLeft:"8px"}},s.h("span",{className:"world-gear-icon"},"↓")),s.h("button",{className:"world-settings-btn",$onclick:["view-world-markdown",n.world.name],title:"View world markdown in new tab",style:{marginLeft:"4px"}},s.h("span",{className:"world-gear-icon"},"🗎")))),n.selectedSettingsTarget==="chat"?s.h(Ps,{world:n.world}):s.h(Ds,{world:n.world,selectedSettingsTarget:n.selectedSettingsTarget,selectedAgent:n.selectedAgent,totalMessages:(n.messages||[]).length}))),n.showAgentEdit&&s.h(Ws,{agent:n.selectedAgentForEdit,mode:n.agentEditMode,worldName:n.worldName,parentComponent:this}),n.showWorldEdit&&s.h(Lr,{world:n.selectedWorldForEdit,mode:n.worldEditMode,parentComponent:this}),n.chatToDelete&&s.h("div",{className:"modal-overlay",$onclick:"chat-history-hide-modals"},s.h("div",{className:"modal-content chat-history-modal",onclick:a=>a.stopPropagation()},s.h("button",{className:"modal-close-btn",$onclick:"chat-history-hide-modals",title:"Close"},"×"),s.h("h3",null,"Delete Chat"),s.h("p",{className:"delete-confirmation-text"},"Are you sure you want to delete chat ",s.h("span",{className:"delete-confirmation-name"},'"',n.chatToDelete.name,'"'),"?"),s.h("p",{className:"warning delete-confirmation-warning"},"⚠️ This action cannot be undone."),s.h("div",{className:"form-actions"},s.h("button",{className:"btn-danger",$onclick:["delete-chat-from-history",n.chatToDelete.id]},"Delete Chat"),s.h("button",{className:"btn-secondary",$onclick:"chat-history-hide-modals"},"Cancel")))))});x(this,"is_global_event",()=>!0);x(this,"update",{...ea,"open-agent-create":n=>({...n,showAgentEdit:!0,agentEditMode:"create",selectedAgentForEdit:null}),"open-agent-edit":(n,r)=>({...n,showAgentEdit:!0,agentEditMode:"edit",selectedAgentForEdit:r}),"open-agent-delete":(n,r)=>({...n,showAgentEdit:!0,agentEditMode:"delete",selectedAgentForEdit:r}),"close-agent-edit":n=>({...n,showAgentEdit:!1}),"open-world-edit":n=>({...n,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:n.world}),"close-world-edit":n=>({...n,showWorldEdit:!1}),"agent-saved":n=>{location.reload()},"agent-deleted":n=>{location.reload()}})}}s.render("#root",s.h(io,null));s.addComponents("#pages",{"/":_o,"/World":ta});
