var He=Object.defineProperty;var Be=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var S=(e,t,n)=>Be(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}})();const ke="3.38.0",qe=`AppRun-${ke}`;class _e{constructor(){this._events={}}on(t,n,r={}){this._events[t]=this._events[t]||[],this._events[t].push({fn:n,options:r})}off(t,n){const r=this._events[t]||[];this._events[t]=r.filter(l=>l.fn!==n)}find(t){return this._events[t]}run(t,...n){const r=this.getSubscribers(t,this._events);return console.assert(r&&r.length>0,"No subscriber for event: "+t),r.forEach(l=>{const{fn:s,options:a}=l;if(!s||typeof s!="function")return console.error(`AppRun event handler for '${t}' is not a function:`,s),!1;if(a.delay)this.delay(t,s,n,a);else try{Object.keys(a).length>0?s.apply(this,[...n,a]):s.apply(this,n)}catch(i){console.error(`Error in event handler for '${t}':`,i)}return!l.options.once}),r.length}once(t,n,r={}){this.on(t,n,{...r,once:!0})}delay(t,n,r,l){l._t&&clearTimeout(l._t),l._t=setTimeout(()=>{clearTimeout(l._t);try{Object.keys(l).length>0?n.apply(this,[...r,l]):n.apply(this,r)}catch(s){console.error(`Error in delayed event handler for '${t}':`,s)}},l.delay)}runAsync(t,...n){const r=this.getSubscribers(t,this._events);console.assert(r&&r.length>0,"No subscriber for event: "+t);const l=r.map(s=>{const{fn:a,options:i}=s;if(!a||typeof a!="function")return console.error(`AppRun async event handler for '${t}' is not a function:`,a),Promise.resolve(null);try{return Object.keys(i).length>0?a.apply(this,[...n,i]):a.apply(this,n)}catch(m){return console.error(`Error in async event handler for '${t}':`,m),Promise.reject(m)}});return Promise.all(l)}query(t,...n){return console.warn("app.query() is deprecated. Use app.runAsync() instead."),this.runAsync(t,...n)}getSubscribers(t,n){const r=n[t]||[];return n[t]=r.filter(l=>!l.options.once),Object.keys(n).filter(l=>l.endsWith("*")&&t.startsWith(l.replace("*",""))).sort((l,s)=>s.length-l.length).forEach(l=>r.push(...n[l].map(s=>({...s,options:{...s.options,event:t}})))),r}}const Ve=qe;let K;const j=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};j.app&&j._AppRunVersions?K=j.app:(K=new _e,j.app=K,j._AppRunVersions=Ve);const g=K;function W(e){return(e==null?void 0:e.target)instanceof HTMLElement?e.target:null}function ze(e,t=document){try{return t.querySelector(e)}catch(n){return console.warn(`Invalid selector: ${e}`,n),null}}function Ke(e){try{return document.getElementById(e)}catch(t){return console.warn(`Error getting element by id: ${e}`,t),null}}const Me=e=>{if(!e)return[];const t=[];let n="",r=!1,l="";for(let s=0;s<e.length;s++){const a=e[s];a==="["&&!r?(n&&(t.push(n),n=""),r=!0):a==="]"&&r?(l?n=n.slice(1,-1):/^\d+$/.test(n)&&(n=parseInt(n,10)),t.push(n),n="",r=!1,l=""):(a==='"'||a==="'")&&r?(l?a===l&&(l=""):l=a,n+=a):a==="."&&!r?n&&(t.push(n),n=""):n+=a}return n&&t.push(n),t},Xe=(e,t)=>{let n=e;for(const r of t){if(n==null)return;n=n[r]}return n},Ye=(e,t,n)=>{if(t.length===0)return n;const r={...e};let l=r;for(let s=0;s<t.length-1;s++){const a=t[s],i=t[s+1];l[a]==null?l[a]=typeof i=="number"?[]:{}:Array.isArray(l[a])?l[a]=[...l[a]]:typeof l[a]=="object"&&(l[a]={...l[a]}),l=l[a]}return l[t[t.length-1]]=n,r},L=(e,t)=>{if(!t)return e.state||"";const n=Me(t),r=Xe(e.state,n);return r!==void 0?r:""},T=(e,t,n)=>{if(!t){e.setState(n);return}const r=Me(t),l=e.state||{},s=Ye(l,r,n);e.setState(s)},Je=(e,t,n,r)=>{if(e.startsWith("$on")){const l=t[e];if(e=e.substring(1),typeof l=="boolean")t[e]=s=>r.run?r.run(e,s):g.run(e,s);else if(typeof l=="string")t[e]=s=>r.run?r.run(l,s):g.run(l,s);else if(typeof l=="function")t[e]=s=>r.setState(l(r.state,s));else if(Array.isArray(l)){const[s,...a]=l;typeof s=="string"?t[e]=i=>r.run?r.run(s,...a,i):g.run(s,...a,i):typeof s=="function"&&(t[e]=i=>r.setState(s(r.state,...a,i)))}}else if(e==="$bind"){const l=t.type||"text",s=typeof t[e]=="string"?t[e]:t.name;if(n==="input")switch(l){case"checkbox":t.checked=L(r,s),t.onclick=a=>{const i=W(a);i&&T(r,s||i.name,i.checked)};break;case"radio":t.checked=L(r,s)===t.value,t.onclick=a=>{const i=W(a);i&&T(r,s||i.name,i.value)};break;case"number":case"range":t.value=L(r,s),t.oninput=a=>{const i=W(a);i&&T(r,s||i.name,Number(i.value))};break;default:t.value=L(r,s),t.oninput=a=>{const i=W(a);i&&T(r,s||i.name,i.value)}}else n==="select"?(t.value=L(r,s),t.onchange=a=>{const i=W(a);i&&!i.multiple&&T(r,s||i.name,i.value)}):n==="option"?(t.selected=L(r,s),t.onclick=a=>{const i=W(a);i&&T(r,s||i.name,i.selected)}):n==="textarea"&&(t.innerHTML=L(r,s),t.oninput=a=>{const i=W(a);i&&T(r,s||i.name,i.value)})}else g.run("$",{key:e,tag:n,props:t,component:r})},J=(e,t)=>{if(Array.isArray(e))return e.map(n=>J(n,t));{let{type:n,tag:r,props:l,children:s}=e;return r=r||n,s=s||(l==null?void 0:l.children),l&&Object.keys(l).forEach(a=>{a.startsWith("$")&&(Je(a,l,r,t),delete l[a])}),s&&J(s,t),e}};class q{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}}q.prototype.normal={};q.prototype.property={};q.prototype.space=void 0;function xe(e,t){const n={},r={};for(const l of e)Object.assign(n,l.property),Object.assign(r,l.normal);return new q(n,r,t)}function te(e){return e.toLowerCase()}class v{constructor(t,n){this.attribute=n,this.property=t}}v.prototype.attribute="";v.prototype.booleanish=!1;v.prototype.boolean=!1;v.prototype.commaOrSpaceSeparated=!1;v.prototype.commaSeparated=!1;v.prototype.defined=!1;v.prototype.mustUseProperty=!1;v.prototype.number=!1;v.prototype.overloadedBoolean=!1;v.prototype.property="";v.prototype.spaceSeparated=!1;v.prototype.space=void 0;let Ge=0;const h=O(),y=O(),re=O(),c=O(),p=O(),D=O(),N=O();function O(){return 2**++Ge}const oe=Object.freeze(Object.defineProperty({__proto__:null,boolean:h,booleanish:y,commaOrSpaceSeparated:N,commaSeparated:D,number:c,overloadedBoolean:re,spaceSeparated:p},Symbol.toStringTag,{value:"Module"})),ee=Object.keys(oe);class ce extends v{constructor(t,n,r,l){let s=-1;if(super(t,n),he(this,"space",l),typeof r=="number")for(;++s<ee.length;){const a=ee[s];he(this,ee[s],(r&oe[a])===oe[a])}}}ce.prototype.defined=!0;function he(e,t,n){n&&(e[t]=n)}function U(e){const t={},n={};for(const[r,l]of Object.entries(e.properties)){const s=new ce(r,e.transform(e.attributes||{},r),l,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),t[r]=s,n[te(r)]=r,n[te(s.attribute)]=r}return new q(t,n,e.space)}const We=U({properties:{ariaActiveDescendant:null,ariaAtomic:y,ariaAutoComplete:null,ariaBusy:y,ariaChecked:y,ariaColCount:c,ariaColIndex:c,ariaColSpan:c,ariaControls:p,ariaCurrent:null,ariaDescribedBy:p,ariaDetails:null,ariaDisabled:y,ariaDropEffect:p,ariaErrorMessage:null,ariaExpanded:y,ariaFlowTo:p,ariaGrabbed:y,ariaHasPopup:null,ariaHidden:y,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:p,ariaLevel:c,ariaLive:null,ariaModal:y,ariaMultiLine:y,ariaMultiSelectable:y,ariaOrientation:null,ariaOwns:p,ariaPlaceholder:null,ariaPosInSet:c,ariaPressed:y,ariaReadOnly:y,ariaRelevant:null,ariaRequired:y,ariaRoleDescription:p,ariaRowCount:c,ariaRowIndex:c,ariaRowSpan:c,ariaSelected:y,ariaSetSize:c,ariaSort:null,ariaValueMax:c,ariaValueMin:c,ariaValueNow:c,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function Le(e,t){return t in e?e[t]:t}function Te(e,t){return Le(e,t.toLowerCase())}const Ze=U({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:D,acceptCharset:p,accessKey:p,action:null,allow:null,allowFullScreen:h,allowPaymentRequest:h,allowUserMedia:h,alt:null,as:null,async:h,autoCapitalize:null,autoComplete:p,autoFocus:h,autoPlay:h,blocking:p,capture:null,charSet:null,checked:h,cite:null,className:p,cols:c,colSpan:null,content:null,contentEditable:y,controls:h,controlsList:p,coords:c|D,crossOrigin:null,data:null,dateTime:null,decoding:null,default:h,defer:h,dir:null,dirName:null,disabled:h,download:re,draggable:y,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:h,formTarget:null,headers:p,height:c,hidden:re,high:c,href:null,hrefLang:null,htmlFor:p,httpEquiv:p,id:null,imageSizes:null,imageSrcSet:null,inert:h,inputMode:null,integrity:null,is:null,isMap:h,itemId:null,itemProp:p,itemRef:p,itemScope:h,itemType:p,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:h,low:c,manifest:null,max:null,maxLength:c,media:null,method:null,min:null,minLength:c,multiple:h,muted:h,name:null,nonce:null,noModule:h,noValidate:h,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:h,optimum:c,pattern:null,ping:p,placeholder:null,playsInline:h,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:h,referrerPolicy:null,rel:p,required:h,reversed:h,rows:c,rowSpan:c,sandbox:p,scope:null,scoped:h,seamless:h,selected:h,shadowRootClonable:h,shadowRootDelegatesFocus:h,shadowRootMode:null,shape:null,size:c,sizes:null,slot:null,span:c,spellCheck:y,src:null,srcDoc:null,srcLang:null,srcSet:null,start:c,step:null,style:null,tabIndex:c,target:null,title:null,translate:null,type:null,typeMustMatch:h,useMap:null,value:y,width:c,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:p,axis:null,background:null,bgColor:null,border:c,borderColor:null,bottomMargin:c,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:h,declare:h,event:null,face:null,frame:null,frameBorder:null,hSpace:c,leftMargin:c,link:null,longDesc:null,lowSrc:null,marginHeight:c,marginWidth:c,noResize:h,noHref:h,noShade:h,noWrap:h,object:null,profile:null,prompt:null,rev:null,rightMargin:c,rules:null,scheme:null,scrolling:y,standby:null,summary:null,text:null,topMargin:c,valueType:null,version:null,vAlign:null,vLink:null,vSpace:c,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:h,disableRemotePlayback:h,prefix:null,property:null,results:c,security:null,unselectable:null},space:"html",transform:Te}),Qe=U({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:N,accentHeight:c,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:c,amplitude:c,arabicForm:null,ascent:c,attributeName:null,attributeType:null,azimuth:c,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:c,by:null,calcMode:null,capHeight:c,className:p,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:c,diffuseConstant:c,direction:null,display:null,dur:null,divisor:c,dominantBaseline:null,download:h,dx:null,dy:null,edgeMode:null,editable:null,elevation:c,enableBackground:null,end:null,event:null,exponent:c,externalResourcesRequired:null,fill:null,fillOpacity:c,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:D,g2:D,glyphName:D,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:c,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:c,horizOriginX:c,horizOriginY:c,id:null,ideographic:c,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:c,k:c,k1:c,k2:c,k3:c,k4:c,kernelMatrix:N,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:c,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:c,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:c,overlineThickness:c,paintOrder:null,panose1:null,path:null,pathLength:c,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:p,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:c,pointsAtY:c,pointsAtZ:c,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:N,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:N,rev:N,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:N,requiredFeatures:N,requiredFonts:N,requiredFormats:N,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:c,specularExponent:c,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:c,strikethroughThickness:c,string:null,stroke:null,strokeDashArray:N,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:c,strokeOpacity:c,strokeWidth:null,style:null,surfaceScale:c,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:N,tabIndex:c,tableValues:null,target:null,targetX:c,targetY:c,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:N,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:c,underlineThickness:c,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:c,values:null,vAlphabetic:c,vMathematical:c,vectorEffect:null,vHanging:c,vIdeographic:c,version:null,vertAdvY:c,vertOriginX:c,vertOriginY:c,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:c,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Le}),Pe=U({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),Oe=U({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Te}),$e=U({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),en=/[A-Z]/g,me=/-[a-z]/g,nn=/^data[-\w.:]+$/i;function tn(e,t){const n=te(t);let r=t,l=v;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&nn.test(t)){if(t.charAt(4)==="-"){const s=t.slice(5).replace(me,on);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=t.slice(4);if(!me.test(s)){let a=s.replace(en,rn);a.charAt(0)!=="-"&&(a="-"+a),t="data"+a}}l=ce}return new l(r,t)}function rn(e){return"-"+e.toLowerCase()}function on(e){return e.charAt(1).toUpperCase()}const ln=xe([We,Ze,Pe,Oe,$e],"html"),sn=xe([We,Qe,Pe,Oe,$e],"svg"),ge="_props",fe=new Map;function an(e,t){if(t&&(t.class=t.class||t.className,delete t.className),!e||Object.keys(e).length===0)return t||{};if(!t||Object.keys(t).length===0){const r={};return Object.keys(e).forEach(l=>r[l]=null),r}const n={};return Object.keys(e).forEach(r=>{r in t||(n[r]=null)}),Object.keys(t).forEach(r=>n[r]=t[r]),n}function cn(e){return e.length<=1?e.toLowerCase():e.split("-").map((t,n)=>n===0?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join("")}function dn(e,t){const n=`${e}:${t}`;let r=fe.get(n);return r===void 0&&(r=tn(t?sn:ln,e)||null,fe.set(n,r)),r}function un(e,t,n){const r=cn(t.slice(5));n==null?delete e.dataset[r]:e.dataset[r]=String(n)}function hn(e,t,n){t.startsWith("on")&&(!n||typeof n=="function"?e[t]=n:typeof n=="string"&&(n?e.setAttribute(t,n):e.removeAttribute(t)))}function pe(e,t,n){mn(n)?e.setAttribute(t,t):e.removeAttribute(t)}function z(e,t,n){try{e[t]=n}catch{X(e,t,n,!1)}}function X(e,t,n,r){if(n==null){e.removeAttribute(t);return}const l=String(n);if(r&&t.includes(":")){const[s]=t.split(":");s==="xlink"?e.setAttributeNS("http://www.w3.org/1999/xlink",t,l):e.setAttribute(t,l)}else e.setAttribute(t,l)}function mn(e){return e==null||e===!1||e===""?!1:e===!0?!0:typeof e=="string"?e.toLowerCase()!=="false"&&e!=="0":!!e}function gn(e,t,n,r){if(fn(e,t))return;if(t==="style"){if(e.style.cssText&&(e.style.cssText=""),typeof n=="string")e.style.cssText=n;else if(n&&typeof n=="object")for(const s in n)e.style[s]!==n[s]&&(e.style[s]=n[s]);return}if(t==="key"){n!=null&&(e.key=n);return}if(t.startsWith("data-")){un(e,t,n);return}if(t.startsWith("on")){hn(e,t,n);return}if((e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT")&&(t==="value"||t==="selected"||t==="selectedIndex")){z(e,t,n);return}if(e.tagName==="INPUT"&&t==="checked"){z(e,t,n),pe(e,t,n);return}const l=dn(t,r);l?l.boolean||l.overloadedBoolean?pe(e,l.attribute,n):l.mustUseProperty&&!r?z(e,l.property,n):X(e,l.attribute,n,r):t.startsWith("aria-")||t==="role"?X(e,t,n,r):t in e||e[t]!==void 0?z(e,t,n):X(e,t,n,r)}function fn(e,t){return document.activeElement===e?["selectionStart","selectionEnd","selectionDirection"].includes(t):!!(t==="scrollTop"||t==="scrollLeft"||e instanceof HTMLMediaElement&&["currentTime","paused","playbackRate","volume"].includes(t))}function pn(e){return/^[a-zA-Z_:][\w\-:.]*$/.test(e)&&!e.includes("<")&&!e.includes(">")&&!e.includes('"')&&!e.includes("'")}function de(e,t,n){const r=e[ge]||{},l=an(r,t);e[ge]=t||{},yn(e,l,t,n)}function yn(e,t,n,r){for(const l in t)pn(l)&&gn(e,l,t[l],r);t&&typeof t.ref=="function"&&window.requestAnimationFrame(()=>t.ref(e))}function bn(e,...t){return Ie(t)}function Ie(e){const t=[],n=r=>{r!=null&&r!==""&&r!==!1&&t.push(typeof r=="function"||typeof r=="object"?r:`${r}`)};return e&&e.forEach(r=>{Array.isArray(r)?r.forEach(l=>n(l)):n(r)}),t}const H={};let ye=0;const wn=500,vn=1e3;function Sn(){if(!(Object.keys(H).length<=vn))for(const[e,t]of Object.entries(H))t.isConnected||delete H[e]}function Nn(e,t,...n){const r=Ie(n);if(typeof e=="string")return{tag:e,props:t,children:r};if(Array.isArray(e))return e;if(e===void 0&&n)return r;if(Object.getPrototypeOf(e).__isAppRunComponent)return{tag:e,props:t,children:r};if(typeof e=="function")return e(t,r);throw new Error(`Unknown tag in vdom ${e}`)}const An=(e,t,n={})=>{if(t==null||t===!1)return;const r=typeof e=="string"&&e?document.getElementById(e)||document.querySelector(e):e;t=J(t,n),Cn(r,t,n)};function Cn(e,t,n={}){if(t==null||t===!1||(t=Y(t,n),!e))return;const r=e.nodeName==="SVG";Array.isArray(t)?le(e,t,r):le(e,[t],r)}function En(e,t){const n=e.nodeName,r=`${t.tag||""}`;return n.toUpperCase()===r.toUpperCase()}function ne(e,t,n){if(n=n||t.tag==="svg",!En(e,t)){e.parentNode.replaceChild(G(t,n),e);return}le(e,t.children,n),de(e,t.props,n)}function le(e,t,n){var i,m;const r=((i=e.childNodes)==null?void 0:i.length)||0,l=(t==null?void 0:t.length)||0,s=Math.min(r,l);for(let u=0;u<s;u++){const d=t[u],f=e.childNodes[u];if(typeof d=="string")f.textContent!==d&&(f.nodeType===3?f.nodeValue=d:e.replaceChild(se(d),f));else if(d instanceof HTMLElement||d instanceof SVGElement)e.insertBefore(d,f);else{const w=d.props&&d.props.key;if(w)if(f.key===w)ne(e.childNodes[u],d,n);else{const M=H[w];M?(e.insertBefore(M,f),ne(e.childNodes[u],d,n)):e.replaceChild(G(d,n),f)}else ne(e.childNodes[u],d,n)}}let a=((m=e.childNodes)==null?void 0:m.length)||0;for(;a>s;)e.removeChild(e.lastChild),a--;if(l>s){const u=document.createDocumentFragment();for(let d=s;d<t.length;d++)u.appendChild(G(t[d],n));e.appendChild(u)}}const be=e=>{const t=document.createElement("section");return t.insertAdjacentHTML("afterbegin",e),Array.from(t.children)};function se(e){if((e==null?void 0:e.indexOf("_html:"))===0){const t=document.createElement("div");return t.insertAdjacentHTML("afterbegin",e.substring(6)),t}else return document.createTextNode(e??"")}function G(e,t){if(e instanceof HTMLElement||e instanceof SVGElement)return e;if(typeof e=="string")return se(e);if(!e.tag||typeof e.tag=="function")return se(JSON.stringify(e));t=t||e.tag==="svg";const n=t?document.createElementNS("http://www.w3.org/2000/svg",e.tag):document.createElement(e.tag);return de(n,e.props,t),e.children&&e.children.forEach(r=>n.appendChild(G(r,t))),e.props&&e.props.key!==void 0&&(n.key=e.props.key,H[e.props.key]=n,++ye>=wn&&(Sn(),ye=0)),n}function kn(e,t,n){const{tag:r,props:l,children:s}=e;let a=`_${n}`,i=l&&l.id;i?a=i:i=`_${n}${Date.now()}`;let m="section";l&&l.as&&(m=l.as,delete l.as),t.__componentCache||(t.__componentCache={});let u=t.__componentCache[a];if(!u||!(u instanceof r)||!u.element){const d=document.createElement(m);u=t.__componentCache[a]=new r({...l,children:s}).mount(d,{render:!0})}else u.renderState(u.state);if(u.mounted){const d=u.mounted(l,s,u.state);typeof d<"u"&&u.setState(d)}return de(u.element,l,!1),u.element}function Y(e,t,n=0){var l;if(typeof e=="string")return e;if(Array.isArray(e))return e.map(s=>Y(s,t,n++));let r=e;if(e&&typeof e.tag=="function"&&Object.getPrototypeOf(e.tag).__isAppRunComponent&&(r=kn(e,t,n)),r&&Array.isArray(r.children)){const s=(l=r.props)==null?void 0:l._component;if(s){let a=0;r.children=r.children.map(i=>Y(i,s,a++))}else r.children=r.children.map(a=>Y(a,t,n++))}return r}const _n=(e,t={})=>class extends HTMLElement{constructor(){super()}get component(){return this._component}get state(){return this._component.state}static get observedAttributes(){return(t.observedAttributes||[]).map(r=>r.toLowerCase())}connectedCallback(){if(this.isConnected&&!this._component){const r=t||{};this._shadowRoot=r.shadow?this.attachShadow({mode:"open"}):this;const l=r.observedAttributes||[],s=l.reduce((i,m)=>{const u=m.toLowerCase();return u!==m&&(i[u]=m),i},{});this._attrMap=i=>s[i]||i;const a={};Array.from(this.attributes).forEach(i=>a[this._attrMap(i.name)]=i.value),l.forEach(i=>{this[i]!==void 0&&(a[i]=this[i]),Object.defineProperty(this,i,{get(){return a[i]},set(m){this.attributeChangedCallback(i,a[i],m)},configurable:!0,enumerable:!0})}),requestAnimationFrame(()=>{const i=this.children?Array.from(this.children):[];if(this._component=new e({...a,children:i}).mount(this._shadowRoot,r),this._component._props=a,this._component.dispatchEvent=this.dispatchEvent.bind(this),this._component.mounted){const m=this._component.mounted(a,i,this._component.state);typeof m<"u"&&(this._component.state=m)}this.on=this._component.on.bind(this._component),this.run=this._component.run.bind(this._component),r.render!==!1&&this._component.run(".")})}}disconnectedCallback(){var r,l,s,a;(l=(r=this._component)==null?void 0:r.unload)==null||l.call(r),(a=(s=this._component)==null?void 0:s.unmount)==null||a.call(s),this._component=null}attributeChangedCallback(r,l,s){if(this._component){const a=this._attrMap(r);this._component._props[a]=s,this._component.run("attributeChanged",a,l,s),s!==l&&t.render!==!1&&window.requestAnimationFrame(()=>{this._component.run(".")})}}},Re=(e,t,n)=>{typeof customElements<"u"&&customElements.define(e,_n(t,n))},ae={meta:new WeakMap,defineMetadata(e,t,n){this.meta.has(n)||this.meta.set(n,{}),this.meta.get(n)[e]=t},getMetadataKeys(e){return e=Object.getPrototypeOf(e),this.meta.get(e)?Object.keys(this.meta.get(e)):[]},getMetadata(e,t){return t=Object.getPrototypeOf(t),this.meta.get(t)?this.meta.get(t)[e]:null}};function Mn(e,t={}){return function(n,r){const l=e?e.toString():r;ae.defineMetadata(`apprun-update:${l}`,{name:l,key:r,options:t},n)}}function xn(e,t){return function(r){return Re(e,r,t),r}}const we=e=>e,b=g;class P{renderState(t,n=null){if(!this.view)return;let r=n||this.view(t);if(b.debug&&b.run("debug",{component:this,_:r?".":"-",state:t,vdom:r,el:this.element}),typeof document!="object")return;const l=typeof this.element=="string"&&this.element?Ke(this.element)||ze(this.element):this.element;if(!l){console.warn(`Component element not found: ${this.element}`);return}const s="_c";this.unload?(l._component!==this||l.getAttribute(s)!==this.tracking_id)&&(this.tracking_id=new Date().valueOf().toString(),l.setAttribute(s,this.tracking_id),typeof MutationObserver<"u"&&(this.observer||(this.observer=new MutationObserver(a=>{(a[0].oldValue===this.tracking_id||!document.body.contains(l))&&(this.unload(this.state),this.observer.disconnect(),this.observer=null)})),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[s]}))):l.removeAttribute&&l.removeAttribute(s),l._component=this,!n&&r&&(r=J(r,this),this.options.transition&&document&&document.startViewTransition?document.startViewTransition(()=>b.render(l,r,this)):b.render(l,r,this)),this.rendered&&this.rendered(this.state)}setState(t,n={render:!0,history:!1}){const r=async s=>{try{for(;;){const{value:a,done:i}=await s.next();if(i)break;this.setState(a,n)}}catch(a){console.error("Error in async iterator:",a)}},l=t;if(l!=null&&l[Symbol.asyncIterator]){this.setState(r(l[Symbol.asyncIterator]()),n);return}else if(l!=null&&l[Symbol.iterator]&&typeof l.next=="function"){for(const s of l)this.setState(s,n);return}else if(t&&t instanceof Promise)Promise.resolve(t).then(s=>{this.setState(s,n),this._state=t});else{if(this._state=t,t==null)return;this.state=t,n.render!==!1&&(n.transition&&document&&document.startViewTransition?document.startViewTransition(()=>this.renderState(t)):this.renderState(t)),n.history!==!1&&this.enable_history&&(this._history=[...this._history,t],this._history_idx=this._history.length-1),typeof n.callback=="function"&&n.callback(this.state)}}constructor(t,n,r,l){this.state=t,this.view=n,this.update=r,this.options=l,this._app=new _e,this._actions=[],this._global_events=[],this._history=[],this._history_idx=-1,this._history_prev=()=>{this._history_idx--,this._history_idx>=0?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=0},this._history_next=()=>{this._history_idx++,this._history_idx<this._history.length?this.setState(this._history[this._history_idx],{render:!0,history:!1}):this._history_idx=this._history.length-1},this.start=(s=null,a)=>{if(this.mount(s,{render:!0,...a}),this.mounted&&typeof this.mounted=="function"){const i=this.mounted({},[],this.state);typeof i<"u"&&this.setState(i)}return this}}mount(t=null,n){var r;return console.assert(!this.element,"Component already mounted."),this.options=n={...this.options,...n},this.element=t,this.global_event=n.global_event,this.enable_history=!!n.history,this.enable_history&&(this.on(n.history.prev||"history-prev",this._history_prev),this.on(n.history.next||"history-next",this._history_next)),n.route&&(this.update=this.update||{},this.update[n.route]||(this.update[n.route]=we)),this.add_actions(),this.state=this.state??this.model??{},typeof this.state=="function"&&(this.state=this.state()),this.setState(this.state,{render:!!n.render,history:!0}),b.debug&&((r=b.find("debug-create-component"))!=null&&r.length)&&b.run("debug-create-component",this),this}is_global_event(t){return t&&(this.global_event||this._global_events.indexOf(t)>=0||t.startsWith("#")||t.startsWith("/")||t.startsWith("@"))}add_action(t,n,r={}){if(!n||typeof n!="function"){console.warn(`Component action for '${t}' is not a valid function:`,n);return}r.global&&this._global_events.push(t),this.on(t,(...l)=>{b.debug&&b.run("debug",{component:this,_:">",event:t,p:l,current_state:this.state,options:r});try{const s=n(this.state,...l);b.debug&&b.run("debug",{component:this,_:"<",event:t,p:l,newState:s,state:this.state,options:r}),this.setState(s,r)}catch(s){console.error(`Error in component action '${t}':`,s),b.debug&&b.run("debug",{component:this,_:"!",event:t,p:l,error:s,state:this.state,options:r})}},r)}add_actions(){const t=this.update||{};ae.getMetadataKeys(this).forEach(r=>{if(r.startsWith("apprun-update:")){const l=ae.getMetadata(r,this);t[l.name]=[this[l.key].bind(this),l.options]}});const n={};Array.isArray(t)?t.forEach(r=>{const[l,s,a]=r;l.toString().split(",").forEach(m=>n[m.trim()]=[s,a])}):Object.keys(t).forEach(r=>{const l=t[r];(typeof l=="function"||Array.isArray(l))&&r.split(",").forEach(s=>n[s.trim()]=l)}),n["."]||(n["."]=we),Object.keys(n).forEach(r=>{const l=n[r];typeof l=="function"?this.add_action(r,l):Array.isArray(l)&&this.add_action(r,l[0],l[1])})}run(t,...n){if(this.state instanceof Promise)return Promise.resolve(this.state).then(r=>{this.state=r,this.run(t,...n)});{const r=t.toString();return this.is_global_event(r)?b.run(r,...n):this._app.run(r,...n)}}on(t,n,r){const l=t.toString();return this._actions.push({name:l,fn:n}),this.is_global_event(l)?b.on(l,n,r):this._app.on(l,n,r)}runAsync(t,...n){const r=t.toString();return this.is_global_event(r)?b.runAsync(r,...n):this._app.runAsync(r,...n)}query(t,...n){return console.warn("component.query() is deprecated. Use component.runAsync() instead."),this.runAsync(t,...n)}unmount(){var t;(t=this.observer)==null||t.disconnect(),this._actions.forEach(n=>{const{name:r,fn:l}=n;this.is_global_event(r)?b.off(r,l):this._app.off(r,l)})}}P.__isAppRunComponent=!0;function Wn(e){return e?e.startsWith("#/")?e.substring(2).split("/"):e.startsWith("#")||e.startsWith("/")?e.substring(1).split("/"):e.split("/"):[]}function Ln(e){return!e||e==="/"||e==="#"||e==="#/"?e:e.endsWith("/")?e.slice(0,-1):e}function Tn(e){const t=e.filter(Boolean);t.length>11&&console.warn(`Deep route hierarchy detected: ${t.join("/")} (${t.length} levels)`)}function Pn(e,t){if(!t||t==="/"||t==="")return e;const n=t.startsWith("/")?t:"/"+t;if(e.startsWith(n)){const r=e.substring(n.length);return r.startsWith("/")?r:"/"+r}return e}function On(e,t){const n=[];for(let r=e.length;r>0;r--){const l=e.slice(0,r);let s="";switch(t){case"path":s="/"+l.join("/");break;case"hash":s="#"+l.join("/");break;case"hash-slash":s="#/"+l.join("/");break;case"non-prefixed":s=l.join("/");break}n.push(s)}return n}function $n(e,t){for(let n=0;n<e.length;n++){const r=e[n],l=g.find(r);if(l&&l.length>0){const s=e.length-n,a=t.slice(s);return{eventName:r,parameters:a}}}return null}function ve(){const e=g.find("#");if(e&&e.length>0){g.run("#"),g.run(x,"#");return}const t=g.find("/");if(t&&t.length>0){g.run("/"),g.run(x,"/");return}const n=g.find("#/");if(n&&n.length>0){g.run("#/"),g.run(x,"#/");return}console.warn("No subscribers for event: "),g.run(B,""),g.run(x,"")}function In(e){if(!e){ve();return}e=Ln(e);const t=g.basePath;t&&(e=Pn(e,t));const n=Wn(e);Tn(n);let r;e.startsWith("#/")?r="hash-slash":e.startsWith("#")?r="hash":e.startsWith("/")?r="path":r="non-prefixed";const l=On(n,r),s=$n(l,n);if(s)Rn(s.eventName,...s.parameters);else if(l.length>0){const a=l[l.length-1];console.warn(`No subscribers for event: ${a}`),g.run(B,e),g.run(x,e)}else ve()}const Rn=(e,...t)=>{if(!e||e===x||e===B)return;const n=g.find(e);!n||n.length===0?(console.warn(`No subscribers for event: ${e}`),g.run(B,e,...t)):g.run(e,...t),g.run(x,e,...t)},x="//",B="///",$=e=>{g.lastUrl!==e&&(g.lastUrl=e,In(e))};function Se(e){return e&&typeof e=="object"&&typeof e.mount=="function"}function ie(e){return typeof e=="function"&&e.prototype&&e.prototype.constructor===e&&(e.prototype.mount!==void 0||e.prototype.state!==void 0||e.prototype.view!==void 0)}function De(e){return typeof e=="function"&&!ie(e)}async function Dn(e,t=3){let n=e,r=0;for(;De(n)&&r<t;)try{const l=await n();if(l===n)break;n=l,r++}catch(l){console.error(`Error executing component function: ${l}`);break}return n}const Un=async(e,t)=>{for(const[n,r]of Object.entries(t)){if(!r||!n){console.error(`Invalid component configuration: component=${r}, route=${n}`);continue}if(Se(r)){const l={route:n};r.mount(e,l);continue}if(ie(r)){const l=new r,s={route:n};l.mount(e,s);continue}if(De(r)){let l=await Dn(r);if(Se(l)){const s={route:n};l.mount(e,s);continue}if(ie(l)){const s=new l,a={route:n};s.mount(e,a);continue}g.on(n,(...s)=>{const a=r(...s);if(typeof e=="string"&&(e=document.querySelector(e),!e)){console.error(`Element not found: ${e}`);return}return g.render(e,a)});continue}console.error("Invalid component: component must be a class, instance, or function that returns a class/instance")}},o=g;if(!o.start){o.version=ke,o.h=o.createElement=Nn,o.render=An,o.Fragment=bn,o.webComponent=Re,o.safeHTML=be,o.start=(t,n,r,l,s)=>{const a={render:!0,global_event:!0,...s},i=new P(n,r,l);return s&&s.rendered&&(i.rendered=s.rendered),s&&s.mounted&&(i.mounted=s.mounted),i.start(t,a),i},o.query=o.query||o.runAsync;const e=t=>{};if(o.on("/",e),o.on("debug",t=>e),o.on(x,e),o.on(B,e),o.route=$,o.on("route",t=>o.route&&o.route(t)),typeof document=="object"&&document.addEventListener("DOMContentLoaded",()=>{const t=document.body.hasAttribute("apprun-no-init")||o["no-init-route"]||!1,n=o.find("#")||o.find("#/")||!1;window.addEventListener("hashchange",()=>$(location.hash)),window.addEventListener("popstate",()=>$(location.pathname)),n?!t&&$(location.hash):(!t&&(()=>{const r=o.basePath||"";let l=location.pathname;r&&l.startsWith(r)&&(l=l.substring(r.length),l.startsWith("/")||(l="/"+l)),$(l)})(),document.body.addEventListener("click",r=>{const l=r.target;if(!l)return;const s=l.tagName==="A"?l:l.closest("a");if(s&&s.origin===location.origin&&s.pathname){r.preventDefault();const i=(o.basePath||"")+s.pathname;history.pushState(null,"",i),$(s.pathname)}}))}),typeof window=="object"){const t=window;t.Component=P,t._React=t.React,t.React=o,t.on=Mn,t.customElement=xn,t.safeHTML=be}o.use_render=(t,n=0)=>{n===0?o.render=(r,l)=>t(l,r):o.render=(r,l)=>t(r,l)},o.use_react=(t,n)=>{if(!t||!n){console.error("AppRun use_react: React and ReactDOM parameters are required");return}if(typeof t.createElement!="function"){console.error("AppRun use_react: Invalid React object - createElement method not found");return}if(!t.Fragment){console.error("AppRun use_react: Invalid React object - Fragment not found");return}if(o.h=o.createElement=t.createElement,o.Fragment=t.Fragment,t.version&&t.version.startsWith("18")){if(!n.createRoot||typeof n.createRoot!="function"){console.error("AppRun use_react: ReactDOM.createRoot not found in React 18+");return}o.render=(r,l)=>{!r||l===void 0||(r._root||(r._root=n.createRoot(r)),r._root.render(l))}}else{if(!n.render||typeof n.render!="function"){console.error("AppRun use_react: ReactDOM.render not found in legacy React");return}o.render=(r,l)=>n.render(l,r)}},o.addComponents=Un}const Fn=()=>o.h("div",{id:"main"},o.h("div",{id:"pages"})),jn="/api";async function A(e,t={}){const n=`${jn}${e}`;try{const r=await fetch(n,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!r.ok){let l=`HTTP ${r.status}: ${r.statusText}`;try{const s=await r.json();s.error&&(l=s.error,s.code&&(l+=` (${s.code})`))}catch{}throw new Error(l)}return r}catch(r){throw console.error(`API request failed for ${e}:`,r),r}}async function Hn(){return(await A("/worlds")).json()}async function Bn(e){if(!e)throw new Error("World name is required");return(await A(`/worlds/${encodeURIComponent(e)}`)).json()}async function qn(e){if(!e||!e.name)throw new Error("World data with name is required");const t={name:e.name,description:e.description||"",turnLimit:e.turnLimit??5,agents:e.agents??[]};return(await A("/worlds",{method:"POST",body:JSON.stringify(t)})).json()}async function Vn(e,t){if(!e||!t)throw new Error("World name and update data are required");return(await A(`/worlds/${encodeURIComponent(e)}`,{method:"PATCH",body:JSON.stringify(t)})).json()}async function zn(e){if(!e)throw new Error("World name is required");await A(`/worlds/${encodeURIComponent(e)}`,{method:"DELETE"})}async function Kn(e){if(!e)throw new Error("World name is required");return(await A(`/worlds/${encodeURIComponent(e)}/agents`)).json()}async function Xn(e,t){if(!e||!t)throw new Error("Both world name and agent name are required");return(await A(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(t)}`)).json()}async function Yn(e,t){if(!e||!t)throw new Error("World name and agent data are required");return(await A(`/worlds/${encodeURIComponent(e)}/agents`,{method:"POST",body:JSON.stringify(t)})).json()}async function Jn(e,t,n){if(!e||!t||!n)throw new Error("World name, agent name, and update data are required");return(await A(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(t)}`,{method:"PATCH",body:JSON.stringify(n)})).json()}async function Gn(e,t){if(!e||!t)throw new Error("World name and agent name are required");await A(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(t)}`,{method:"DELETE"})}async function Zn(e,t){if(!e||!t)throw new Error("World name and agent name are required");await A(`/worlds/${encodeURIComponent(e)}/agents/${encodeURIComponent(t)}/memory`,{method:"DELETE"})}const _={apiRequest:A,getWorlds:Hn,getWorld:Bn,createWorld:qn,updateWorld:Vn,deleteWorld:zn,getAgents:Kn,getAgent:Xn,createAgent:Yn,updateAgent:Jn,deleteAgent:Gn,clearAgentMemory:Zn},Qn=e=>({mode:e.mode||"create",world:e.world||Ue(),loading:!1}),Ue=()=>({name:"",description:"",turnLimit:5}),Ne=async function*(e){if(!e.world.name.trim()){yield{...e,error:"World name is required"};return}yield{...e,loading:!0,error:null};try{e.mode==="create"?await _.createWorld(e.world):await _.updateWorld(e.world.name,e.world);const t=e.mode==="create"?"World created successfully!":"World updated successfully!";yield{...e,loading:!1,successMessage:t},setTimeout(()=>{e.mode==="create"?window.location.href="/World/"+encodeURIComponent(e.world.name):o.run("world-saved")},2e3)}catch(t){yield{...e,loading:!1,error:t.message||"Failed to save world"}}},Ae=async function*(e){yield{...e,loading:!0,error:null};try{await _.deleteWorld(e.world.name),yield{...e,loading:!1,successMessage:"World deleted successfully!"},setTimeout(()=>{window.location.href="/"},2e3)}catch(t){yield{...e,loading:!1,error:t.message||"Failed to delete world"}}},I=()=>{o.run("close-world-edit")};class Fe extends P{constructor(){super(...arguments);S(this,"mounted",n=>Qn(n));S(this,"state",{mode:"create",world:Ue(),loading:!1,error:null,successMessage:null});S(this,"view",n=>{if(n.successMessage)return o.h("div",{className:"modal-backdrop",$onclick:[I]},o.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},o.h("div",{className:"modal-body"},o.h("div",{className:"success-message"},o.h("h3",null,"Success!"),o.h("p",null,n.successMessage),o.h("div",{className:"loading-spinner"},n.mode==="create"?"Redirecting to new world...":n.mode==="delete"?"Redirecting to home...":"Closing...")))));const r=n.mode==="edit",l=n.mode==="delete";let s;return l?s=`Delete ${n.world.name||"World"}`:r?s=`Edit ${n.world.name||"World"}`:s="Create New World",o.h("div",{className:"modal-backdrop",$onclick:[I]},o.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},o.h("div",{className:"modal-header"},o.h("h2",{className:"modal-title"},s),o.h("button",{className:"modal-close-btn",$onclick:[I],title:"Close"},"×")),o.h("div",{className:"modal-body"},n.error&&o.h("div",{className:"error-message"},n.error),l?o.h("div",{className:"delete-confirmation"},o.h("h3",null,"Delete World"),o.h("p",null,'Are you sure you want to delete "',n.world.name,'"?'),o.h("p",null,"This action cannot be undone and will delete all agents and messages in this world.")):o.h("form",{className:"world-form"},o.h("div",{className:"form-section"},o.h("h3",{className:"section-title"},"World Configuration"),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"world-name"},"World Name *"),o.h("input",{id:"world-name",type:"text",className:"form-input",placeholder:"Enter world name",value:n.world.name,$bind:"world.name",disabled:n.loading})),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"world-description"},"Description"),o.h("input",{id:"world-description",type:"text",className:"form-input",placeholder:"Brief description of the world",value:n.world.description,$bind:"world.description",disabled:n.loading})),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"world-turn-limit"},"Turn Limit"),o.h("input",{id:"world-turn-limit",type:"number",className:"form-input",placeholder:"5",min:"1",max:"50",value:n.world.turnLimit,$bind:"world.turnLimit",disabled:n.loading}))))),o.h("div",{className:"modal-footer"},o.h("div",{className:"modal-actions"},l?o.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},o.h("button",{className:"btn btn-secondary",$onclick:[I],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-danger",$onclick:[Ae],disabled:n.loading},n.loading?"Deleting...":"Delete")):r?o.h(o.Fragment,null,o.h("button",{className:"btn btn-danger",$onclick:[Ae],disabled:n.loading,title:"Delete world"},n.loading?"Deleting...":"Delete"),o.h("div",{className:"modal-primary-actions"},o.h("button",{className:"btn btn-secondary",$onclick:[I],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-primary",$onclick:[Ne],disabled:n.loading||!n.world.name.trim()},n.loading?"Saving...":"Update"))):o.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},o.h("button",{className:"btn btn-secondary",$onclick:[I],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-primary",$onclick:[Ne],disabled:n.loading||!n.world.name.trim()},n.loading?"Saving...":"Create"))))))})}}class et extends P{constructor(){super(...arguments);S(this,"state",async()=>({worlds:await _.getWorlds(),currentIndex:0,loading:!1,error:null,showWorldEdit:!1,worldEditMode:"create",selectedWorldForEdit:null}));S(this,"view",n=>{var r,l,s,a;return n.loading?o.h("div",{class:"container"},o.h("div",{class:"row"},o.h("div",{class:"col"},o.h("div",{class:"loading-message"},"Loading worlds...")))):n.error?o.h("div",{class:"container"},o.h("div",{class:"row"},o.h("div",{class:"col"},o.h("div",{class:"error-message"},o.h("h3",null,"Error loading worlds"),o.h("p",null,n.error),o.h("button",{class:"btn btn-primary",$onclick:"/"},"Retry"))))):n.worlds.length===0?o.h("div",{class:"container"},o.h("div",{class:"row"},o.h("div",{class:"col"},o.h("div",{class:"no-worlds-message"},o.h("h3",null,"No worlds found"),o.h("p",null,"Create your first world to get started!"),o.h("button",{class:"btn btn-primary",$onclick:"open-world-create"},"Create World"))))):o.h("div",{class:"container"},o.h("div",{class:"row"},o.h("div",{class:"col banner-col"},o.h("h1",{class:"banner-title"},"PICK YOUR WORLD"))),o.h("div",{class:"row carousel-row"},o.h("div",{class:"col"},o.h("div",{class:"world-carousel"},o.h("button",{class:"btn carousel-arrow",$onclick:"prev-world"},"‹"),o.h("div",{class:"world-cards"},n.worlds.map((i,m)=>{const u=m===n.currentIndex;let d=!1;return n.worlds.length<=3?d=!0:d=Math.abs(m-n.currentIndex)<=1,d?o.h("button",{class:`btn world-card-btn ${u?"btn-primary center":"btn-secondary side"}`,$onclick:u?["enter-world",i]:["select-world",i]},o.h("span",{class:"world-name"},i.name)):null})),o.h("button",{class:"btn carousel-arrow",$onclick:"next-world"},"›")),o.h("div",{class:"world-indicators"},n.worlds.map((i,m)=>o.h("button",{class:`world-dot ${m===n.currentIndex?"active":""}`,$onclick:["select-world",i],title:i.name}))))),o.h("div",{class:"row"},o.h("div",{class:"col"},o.h("div",{class:"description-card"},o.h("h4",{class:"description-title"},((r=n.worlds[n.currentIndex])==null?void 0:r.name)||"Unknown World"),o.h("p",{class:"description-text"},((l=n.worlds[n.currentIndex])==null?void 0:l.description)||"No description available"),o.h("div",{class:"action-buttons"},o.h("button",{class:"btn add-world-btn",title:"Add New World",$onclick:"open-world-create"},o.h("span",{class:"plus-icon"},"+")),o.h("a",{href:"/World/"+(((s=n.worlds[n.currentIndex])==null?void 0:s.name)||"")},o.h("button",{class:"btn btn-primary enter-btn"},"Enter ",((a=n.worlds[n.currentIndex])==null?void 0:a.name)||"World")),o.h("button",{class:"btn add-world-btn delete-world-btn",title:"Delete World",$onclick:["open-world-delete",n.worlds[n.currentIndex]]},o.h("span",{class:"plus-icon"},"×")))))),n.showWorldEdit&&o.h(Fe,{world:n.selectedWorldForEdit,mode:n.worldEditMode}))});S(this,"update",{"prev-world":n=>({...n,currentIndex:n.currentIndex>0?n.currentIndex-1:n.worlds.length-1}),"next-world":n=>({...n,currentIndex:n.currentIndex<n.worlds.length-1?n.currentIndex+1:0}),"select-world":(n,r)=>{const l=n.worlds.findIndex(s=>s.name===r.name);return{...n,currentIndex:l>=0?l:n.currentIndex}},"enter-world":(n,r)=>{window.location.href="/World/"+r.name},"open-world-create":n=>({...n,showWorldEdit:!0,worldEditMode:"create",selectedWorldForEdit:null}),"open-world-edit":(n,r)=>({...n,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:r}),"open-world-delete":(n,r)=>({...n,showWorldEdit:!0,worldEditMode:"delete",selectedWorldForEdit:r}),"close-world-edit":n=>({...n,showWorldEdit:!1})})}}function nt(e){const{worldName:t,messages:n=[],userInput:r="",messagesLoading:l,isSending:s,isWaiting:a,activeAgent:i,selectedAgent:m}=e,u=d=>{if(!d.fromAgentId||d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"||d.sender==="system"||d.sender==="SYSTEM")return!1;const f=d.sender.toLowerCase(),w=d.fromAgentId.toLowerCase();return!(f.includes(w)||w.includes(f))};return o.h("fieldset",{className:"chat-fieldset"},o.h("legend",null,t),o.h("div",{className:"chat-container"},o.h("div",{className:"conversation-area",ref:d=>d.scrollTop=d.scrollHeight},l?o.h("div",{className:"loading-messages"},"Loading messages..."):n.length===0?o.h("div",{className:"no-messages"},"No messages yet. Start a conversation!"):n.filter(d=>d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"||d.sender==="system"||d.sender==="SYSTEM"?!0:m!=null&&m.id&&d.fromAgentId!==m.id?!1:d.isStreaming===!0&&d.streamComplete!==!0||d.streamComplete===!0||d.streamComplete===void 0&&d.isStreaming===void 0).map((d,f)=>{const w=u(d),F=`message ${d.sender==="HUMAN"||d.sender==="USER"||d.type==="user"?"user-message":"agent-message"} ${w?"cross-agent-message":""}`.trim();return o.h("div",{key:d.id||f,className:F},o.h("div",{className:"message-sender"},d.sender||(d.type==="user"?"User":"Agent"),w&&d.fromAgentId&&o.h("span",{className:"source-agent-indicator",title:`From agent: ${d.fromAgentId}`},"→ ",d.fromAgentId)),o.h("div",{className:"message-content"},d.text),o.h("div",{className:"message-timestamp"},d.createdAt?new Date(d.createdAt).toLocaleTimeString():"Now"),d.isStreaming&&o.h("div",{className:"streaming-indicator"},o.h("div",{className:"streaming-content"},o.h("div",{className:`agent-sprite sprite-${(i==null?void 0:i.spriteIndex)??0}`}),o.h("span",null,"responding ..."))),d.hasError&&o.h("div",{className:"error-indicator"},"Error: ",d.errorMessage))}),a&&o.h("div",{className:"message user-message waiting-message"},o.h("div",{className:"message-content"},o.h("div",{className:"waiting-dots"},o.h("span",null,"."),o.h("span",null,"."),o.h("span",null,"."))))),o.h("div",{className:"input-area"},o.h("div",{className:"input-container"},o.h("input",{type:"text",className:"message-input",placeholder:"Type your message...",value:r||"",$oninput:"update-input",$onkeypress:"key-press"}),o.h("button",{className:"send-button",$onclick:"send-message",disabled:!r.trim()||s},s?"Sending...":"Send")))))}function tt(e){const{world:t,selectedSettingsTarget:n,selectedAgent:r,totalMessages:l}=e,s=()=>{n==="agent"&&r?confirm(`Clear all messages for agent ${r.name}?`)&&o.run("clear-agent-messages",r):n==="world"&&t&&confirm(`Clear all messages for world ${t.name}?`)&&o.run("clear-world-messages")};return o.h("fieldset",{className:"settings-fieldset"},o.h("legend",null,n==="agent"&&r?`${r.name} Settings`:n==="world"&&t?`${t.name} Settings`:"Settings"),o.h("div",{className:"chat-settings"},n==="agent"&&r?o.h("div",{className:"agent-settings"},o.h("div",{className:"setting-item"},o.h("label",null,"Agent Name:"),o.h("span",null,o.h("span",{className:"setting-value"},r.name),o.h("button",{className:"action-btn",$onclick:["open-agent-edit",r],title:"Edit agent"},o.h("span",{className:"btn-icon"},"⚙")))),o.h("div",{className:"setting-item"},o.h("label",null,"Message Count:"),o.h("span",null,o.h("span",{className:"setting-value"},r.messageCount),o.h("button",{className:"action-btn",onclick:s,title:"Clear agent messages"},o.h("span",{className:"btn-icon"},"×")))),o.h("div",{className:"setting-item"},o.h("label",null,"LLM Provider:"),o.h("span",{className:"setting-value"},r.provider||"N/A")),o.h("div",{className:"setting-item"},o.h("label",null,"Model:"),o.h("span",{className:"setting-value"},r.model||"N/A")),o.h("div",{className:"setting-item"},o.h("label",null,"Temperature:"),o.h("span",{className:"setting-value"},r.temperature!==void 0?r.temperature:"N/A")),o.h("div",{className:"setting-item"},o.h("label",null,"System Prompt:"),o.h("span",{className:"system-prompt-preview"},r.systemPrompt?r.systemPrompt.length>100?r.systemPrompt.substring(0,100)+"...":r.systemPrompt:"N/A"))):n==="world"&&t?o.h("div",{className:"world-settings"},o.h("div",{className:"setting-item"},o.h("label",null,"World Name:"),o.h("span",null,o.h("span",{className:"setting-value"},t.name),o.h("button",{className:"action-btn",$onclick:"open-world-edit",title:"Edit world"},o.h("span",{className:"btn-icon"},"⚙")))),o.h("div",{className:"setting-item"},o.h("label",null,"Agents Count:"),o.h("span",null,o.h("span",{className:"setting-value"},t.agents.length),o.h("button",{className:"action-btn",$onclick:"open-agent-create",title:"Add new agent"},o.h("span",{className:"btn-icon"},"+")))),o.h("div",{className:"setting-item"},o.h("label",null,"Total Messages:"),o.h("span",null,o.h("span",{className:"setting-value"},l),o.h("button",{className:"action-btn",$onclick:s,title:"Clear all messages"},o.h("span",{className:"btn-icon"},"×")))),o.h("div",{className:"setting-item"},o.h("label",null,"LLM Call Limit:"),o.h("span",{className:"setting-value"},t.llmCallLimit||"Unlimited"))):o.h("div",{className:"default-settings"},o.h("p",null,"Click on an agent or the gear icon to view settings"))))}const rt=e=>({mode:e.mode||"create",worldName:e.worldName,agent:e.agent||je,loading:!1}),je={name:"",description:"",provider:"ollama",model:"llama3.2:3b",temperature:.7,systemPrompt:""},Ce=async function*(e){if(!e.agent.name.trim()){yield{...e,error:"Agent name is required"};return}yield{...e,loading:!0,error:null};try{e.mode==="create"?await _.createAgent(e.worldName,e.agent):await _.updateAgent(e.worldName,e.agent.name,e.agent);const t=e.mode==="create"?"Agent created successfully!":"Agent updated successfully!";yield{...e,loading:!1,successMessage:t},setTimeout(()=>{o.run("agent-saved")},2e3)}catch(t){yield{...e,loading:!1,error:t.message||"Failed to save agent"}}},Ee=async function*(e){yield{...e,loading:!0,error:null};try{await _.deleteAgent(e.worldName,e.agent.name),yield{...e,loading:!1,successMessage:"Agent deleted successfully!"},setTimeout(()=>{o.run("agent-deleted")},2e3)}catch(t){yield{...e,loading:!1,error:t.message||"Failed to delete agent"}}},R=()=>{o.run("close-agent-edit")};class ot extends P{constructor(){super(...arguments);S(this,"mounted",n=>rt(n));S(this,"state",{mode:"create",worldName:"",agent:je,loading:!0});S(this,"view",n=>{if(n.loading)return o.h("div",{className:"modal-backdrop"},o.h("div",{className:"modal-content"},o.h("div",{className:"modal-body"},o.h("div",{className:"loading-spinner"},n.mode==="create"?"Creating agent...":n.mode==="edit"?"Updating agent...":"Deleting agent..."))));if(n.successMessage)return o.h("div",{className:"modal-backdrop",$onclick:[R]},o.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},o.h("div",{className:"modal-body"},o.h("div",{className:"success-message"},o.h("h3",null,"Success!"),o.h("p",null,n.successMessage),o.h("div",{className:"loading-spinner"},"Closing...")))));const r=n.mode==="edit",l=n.mode==="delete";let s;return l?s=`Delete ${n.agent.name||"Agent"}`:r?s=`Edit ${n.agent.name||"Agent"}`:s="Create New Agent",o.h("div",{className:"modal-backdrop",$onclick:[R]},o.h("div",{className:"modal-content",onclick:a=>a.stopPropagation()},o.h("div",{className:"modal-header"},o.h("h2",{className:"modal-title"},s),o.h("button",{className:"modal-close-btn",$onclick:[R],title:"Close"},"×")),o.h("div",{className:"modal-body"},n.error&&o.h("div",{className:"error-message"},n.error),l?o.h("div",{className:"delete-confirmation"},o.h("h3",null,"Delete Agent"),o.h("p",null,'Are you sure you want to delete "',n.agent.name,'"?'),o.h("p",null,"This action cannot be undone.")):o.h("form",{className:"agent-form"},o.h("div",{className:"form-section"},o.h("h3",{className:"section-title"},"Basic Information"),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"agent-name"},"Agent Name *"),o.h("input",{id:"agent-name",type:"text",className:"form-input",placeholder:"Enter agent name",value:n.agent.name,$bind:"agent.name",disabled:n.loading})),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"agent-description"},"Description"),o.h("input",{id:"agent-description",type:"text",className:"form-input",placeholder:"Brief description of the agent",value:n.agent.description,$bind:"agent.description",disabled:n.loading}))),o.h("div",{className:"form-section"},o.h("h3",{className:"section-title"},"LLM Configuration"),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"agent-provider"},"Provider"),o.h("select",{id:"agent-provider",className:"form-select",value:n.agent.provider,$bind:"agent.provider",disabled:n.loading},o.h("option",{value:""},"Select provider"),o.h("option",{value:"openai"},"OpenAI"),o.h("option",{value:"anthropic"},"Anthropic"),o.h("option",{value:"google"},"Google"),o.h("option",{value:"microsoft"},"Microsoft"),o.h("option",{value:"ollama"},"Ollama (Local)"))),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"agent-model"},"Model"),o.h("input",{id:"agent-model",type:"text",className:"form-input",placeholder:"e.g. gpt-4, claude-3-sonnet, llama3.2:3b",value:n.agent.model,$bind:"agent.model",disabled:n.loading})),o.h("div",{className:"form-group"},o.h("label",{htmlFor:"agent-temperature"},"Temperature"),o.h("input",{id:"agent-temperature",type:"number",className:"form-input",placeholder:"0.0 - 2.0",min:"0",max:"2",step:"0.1",value:n.agent.temperature,$bind:"agent.temperature",disabled:n.loading}))),o.h("div",{className:"form-section"},o.h("h3",{className:"section-title"},"System Prompt"),o.h("div",{className:"form-group"},o.h("textarea",{id:"agent-prompt",className:"form-textarea",placeholder:"Enter the system prompt for this agent...",rows:8,value:n.agent.systemPrompt,$bind:"agent.systemPrompt",disabled:n.loading}))))),o.h("div",{className:"modal-footer"},o.h("div",{className:"modal-actions"},l?o.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},o.h("button",{className:"btn btn-secondary",$onclick:[R],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-danger",$onclick:[Ee],disabled:n.loading},n.loading?"Deleting...":"Delete")):r?o.h(o.Fragment,null,o.h("button",{className:"btn btn-danger",$onclick:[Ee],disabled:n.loading,title:"Delete agent"},n.loading?"Deleting...":"Delete"),o.h("div",{className:"modal-primary-actions"},o.h("button",{className:"btn btn-secondary",$onclick:[R],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-primary",$onclick:[Ce],disabled:n.loading||!n.agent.name.trim()},n.loading?"Saving...":"Update"))):o.h("div",{className:"modal-primary-actions",style:"margin-left: auto;"},o.h("button",{className:"btn btn-secondary",$onclick:[R],disabled:n.loading},"Cancel"),o.h("button",{className:"btn btn-primary",$onclick:[Ce],disabled:n.loading||!n.agent.name.trim()},n.loading?"Saving...":"Create"))))))})}}const k=(e,t)=>{o!=null&&o.run?o.run(e,t):console.warn("AppRun app not available for event:",e)};let C={activeMessages:new Map,currentWorldName:null};const lt=e=>{var t;!e||typeof e!="object"||(e.type==="sse"?st(e):e.type==="message"?k("handleMessage",e):e.type==="response"||(e.type==="error"?k("handleError",{message:e.message||"SSE error"}):e.type==="connected"?(k("handleConnectionStatus","connected"),C.currentWorldName=((t=e.payload)==null?void 0:t.worldName)||null):e.type==="complete"&&k("handleComplete",e.payload)))},st=e=>{const t=e.data;if(!t)return;const n=t.messageId||"default",r=t.sender||"Agent";switch(t.type){case"start":C.activeMessages.set(n,{content:"",sender:r,messageId:n,isStreaming:!0}),k("handleStreamStart",{messageId:n,sender:r,worldName:t.worldName||C.currentWorldName});break;case"chunk":const l=C.activeMessages.get(n);if(l){const a=t.accumulatedContent!==void 0?t.accumulatedContent:l.content+(t.content||"");l.content=a,k("handleStreamChunk",{messageId:n,sender:r,content:a,isAccumulated:t.accumulatedContent!==void 0,worldName:t.worldName||C.currentWorldName})}break;case"end":const s=C.activeMessages.get(n);if(s){const a=t.finalContent!==void 0?t.finalContent:s.content;k("handleStreamEnd",{messageId:n,sender:r,content:a,worldName:t.worldName||C.currentWorldName}),C.activeMessages.delete(n),C.activeMessages.size}break;case"error":k("handleStreamError",{messageId:n,sender:r,error:t.error||"Streaming error",worldName:t.worldName||C.currentWorldName}),C.activeMessages.delete(n);break}};async function at(e,t,n="HUMAN",r,l,s){if(!e||!t)throw new Error("World name and message are required");if(!t.trim())throw new Error("Message cannot be empty");C.currentWorldName=e;const a={message:t,sender:n},m=(await A(`/worlds/${encodeURIComponent(e)}/chat`,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"}})).body.getReader(),u=new TextDecoder;let d="",f=!0;const w=()=>{if(f){f=!1;try{m.cancel()}catch(E){console.warn("Error canceling SSE reader:",E)}}};return(async()=>{try{for(;f;){const{done:E,value:F}=await m.read();if(E)break;d+=u.decode(F,{stream:!0});const ue=d.split(`
`);d=ue.pop()||"";for(const Z of ue)if(Z.trim()!==""&&Z.startsWith("data: "))try{const V=Z.slice(6).trim();if(V==="")continue;const Q=JSON.parse(V);lt(Q),Q.type}catch(V){console.error("Error parsing SSE data:",V),k("handleError",{message:"Failed to parse SSE data"})}}}catch(E){console.error("SSE stream error:",E);const F={message:E.message||"SSE stream error"};k("handleError",F)}finally{w()}})(),w}const it=(e,t)=>{const{messageId:n,sender:r,worldName:l}=t,s=r||"Agent";let a;if("agents"in e&&Array.isArray(e.agents)){const i=e.agents.find(m=>m.name===s);a=i==null?void 0:i.id}return{...e,messages:[...e.messages||[],{id:Date.now()+Math.random(),type:"agent-stream",sender:s,text:"",createdAt:new Date().toISOString(),worldName:l||e.worldName,isStreaming:!0,messageId:n,fromAgentId:a}],needScroll:!0}},ct=(e,t)=>{const{messageId:n,sender:r,content:l,isAccumulated:s}=t,a=[...e.messages||[]];for(let i=a.length-1;i>=0;i--)if(a[i].isStreaming&&(a[i].messageId===n||!n&&a[i].sender===r&&a[i].type==="agent-stream"))return a[i]={...a[i],text:l||"",createdAt:new Date().toISOString()},{...e,messages:a,needScroll:!0};return{...e,messages:[...a,{id:Date.now()+Math.random(),type:"agent-stream",sender:r||"Agent",text:l||"",createdAt:new Date().toISOString(),worldName:t.worldName||e.worldName,isStreaming:!0,messageId:n}],needScroll:!0}},dt=(e,t)=>{const{messageId:n,sender:r,content:l}=t,s=(e.messages||[]).filter(a=>!(a.isStreaming&&(a.messageId===n||!n&&a.sender===r&&a.type==="agent-stream")));return{...e,messages:s}},ut=(e,t)=>{const{messageId:n,sender:r,error:l}=t,s=(e.messages||[]).map(a=>a.isStreaming&&(a.messageId===n||!n&&a.sender===r&&a.type==="agent-stream")?{...a,isStreaming:!1,hasError:!0,errorMessage:l}:a);return{...e,messages:s}},ht=(e,t)=>{const n=t.data||{},r=n.sender||n.agentName||"Agent";let l;if("agents"in e&&Array.isArray(e.agents)){const a=e.agents.find(i=>i.name===r);l=a==null?void 0:a.id}const s={id:Date.now()+Math.random(),type:n.type||"message",sender:r,text:n.content||n.message||"",createdAt:n.createdAt||new Date().toISOString(),worldName:n.worldName||e.worldName,fromAgentId:l};return{...e,messages:[...e.messages||[],s],needScroll:!0,isWaiting:!1}},mt=(e,t)=>({...e,connectionStatus:t,wsError:t==="error"?e.wsError:null}),gt=(e,t)=>{const n=t.message||"SSE error",r={id:Date.now()+Math.random(),type:"error",sender:"System",text:n,createdAt:new Date().toISOString(),worldName:e.worldName,hasError:!0};return{...e,wsError:n,messages:[...e.messages||[],r],needScroll:!0}},ft=(e,t)=>({...e,connectionStatus:"completed"}),pt={"/World":async function*(e,t){if(!t){location.href="/";return}const n=decodeURIComponent(t);try{yield{...e,worldName:n,loading:!0,error:null,isWaiting:!1,activeAgent:null};const r=await _.getWorld(n);if(!r){yield{...e,worldName:n,loading:!1,error:"World not found",isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null};return}const l=new Map,s=await Promise.all(r.agents.map(async(i,m)=>{var d;i.memory&&Array.isArray(i.memory)&&i.memory.forEach(f=>{const w=`${f.createdAt||Date.now()}-${f.text||f.content||""}`;if(!l.has(w)){const M=f.sender||i.name;let E="agent";(M==="HUMAN"||M==="USER")&&(E="user"),l.set(w,{id:f.id||w,sender:M,text:f.text||f.content||"",createdAt:f.createdAt||new Date().toISOString(),type:E,streamComplete:!0,fromAgentId:i.id})}});const u=i.systemPrompt||"";return{...i,spriteIndex:m%9,messageCount:((d=i.memory)==null?void 0:d.length)||0,provider:i.provider||"openai",model:i.model||"gpt-4",temperature:i.temperature??.7,systemPrompt:u,description:i.description||"",type:i.type||"default",status:i.status||"active",llmCallCount:i.llmCallCount||0,memory:i.memory||[],createdAt:i.createdAt||new Date,lastActive:i.lastActive||new Date}})),a=Array.from(l.values()).sort((i,m)=>{const u=new Date(i.createdAt).getTime(),d=new Date(m.createdAt).getTime();return u-d});yield{...e,worldName:n,world:{name:n,agents:s,llmCallLimit:r.llmCallLimit||r.turnLimit},agents:s,messages:a,loading:!1,error:null,isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null}}catch(r){yield{...e,worldName:n,world:{name:n,agents:[],llmCallLimit:void 0},loading:!1,error:r.message||"Failed to load world data",isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null}}},"update-input":(e,t)=>({...e,userInput:t.target.value}),"key-press":(e,t)=>{t.key==="Enter"&&(e.userInput||"").trim()&&o.run("send-message")},"send-message":async e=>{if(!(e.userInput||"").trim())return e;const t=e.userInput||"",n={id:Date.now()+Math.random(),type:"user",sender:"HUMAN",text:t,createdAt:new Date().toISOString(),worldName:e.worldName,userEntered:!0},r={...e,messages:[...e.messages||[],n],userInput:"",isSending:!0,isWaiting:!0};try{return await at(e.worldName,t,"HUMAN"),{...r,isSending:!1}}catch(l){return{...r,isSending:!1,isWaiting:!1,error:l.message||"Failed to send message"}}},handleStreamStart:(e,t)=>{const n=it(e,t),r=t.sender,l=e.agents.find(s=>s.name===r);return{...n,isWaiting:!1,activeAgent:l?{spriteIndex:l.spriteIndex,name:l.name}:null}},handleStreamChunk:(e,t)=>ct(e,t),handleStreamEnd:(e,t)=>{var s;const n=dt(e,t),r=t.sender;let l={...n,activeAgent:null};if(r&&r!=="HUMAN"){const a=l.agents.map(u=>u.name===r?{...u,messageCount:u.messageCount+1}:u),i=l.world?{...l.world,agents:a}:null,m=((s=l.selectedAgent)==null?void 0:s.name)===r?{...l.selectedAgent,messageCount:l.selectedAgent.messageCount+1}:l.selectedAgent;l={...l,world:i,agents:a,selectedAgent:m}}return l},handleStreamError:(e,t)=>({...ut(e,t),activeAgent:null}),handleMessage:(e,t)=>ht(e,t),handleConnectionStatus:(e,t)=>mt(e,t),handleError:(e,t)=>gt(e,t),handleComplete:(e,t)=>ft(e),"clear-agent-messages":async(e,t)=>{var n;try{await _.clearAgentMemory(e.worldName,t.name);const r=e.agents.map(i=>i.id===t.id?{...i,messageCount:0}:i),l=(e.messages||[]).filter(i=>i.sender!==t.name),s=((n=e.selectedAgent)==null?void 0:n.id)===t.id?{...e.selectedAgent,messageCount:0}:e.selectedAgent,a=e.world?{...e.world,agents:r}:null;return{...e,world:a,agents:r,messages:l,selectedAgent:s}}catch(r){return{...e,error:r.message||"Failed to clear agent messages"}}},"clear-world-messages":async e=>{try{await Promise.all(e.agents.map(l=>_.clearAgentMemory(e.worldName,l.name)));const t=e.agents.map(l=>({...l,messageCount:0})),n=e.selectedAgent?{...e.selectedAgent,messageCount:0}:null,r=e.world?{...e.world,agents:t}:null;return{...e,world:r,agents:t,messages:[],selectedAgent:n}}catch(t){return{...e,error:t.message||"Failed to clear world messages"}}},"select-world-settings":e=>({...e,selectedSettingsTarget:"world",selectedAgent:null,messages:(e.messages||[]).filter(t=>!t.userEntered)}),"select-agent-settings":(e,t)=>{var n;return e.selectedSettingsTarget==="agent"&&((n=e.selectedAgent)==null?void 0:n.id)===t.id?{...e,selectedSettingsTarget:"world",selectedAgent:null,messages:(e.messages||[]).filter(r=>!r.userEntered),userInput:""}:{...e,selectedSettingsTarget:"agent",selectedAgent:t,messages:(e.messages||[]).filter(r=>!r.userEntered),userInput:"@"+t.name+" "}}};class yt extends P{constructor(){super(...arguments);S(this,"state",async()=>({worldName:"World",world:null,agents:[],messages:[],userInput:"",loading:!0,error:null,messagesLoading:!1,isSending:!1,isWaiting:!1,selectedSettingsTarget:"world",selectedAgent:null,activeAgent:null,showAgentEdit:!1,agentEditMode:"create",selectedAgentForEdit:null,showWorldEdit:!1,worldEditMode:"edit",selectedWorldForEdit:null,connectionStatus:"disconnected",wsError:null,needScroll:!1}));S(this,"view",n=>{var r;return n.loading?o.h("div",{className:"world-container"},o.h("div",{className:"world-columns"},o.h("div",{className:"chat-column"},o.h("div",{className:"agents-section"},o.h("div",{className:"agents-row"},o.h("div",{className:"loading-agents"},"Loading..."))),o.h("div",{className:"loading-state"},o.h("p",null,"Loading world data..."))),o.h("div",{className:"settings-column"},o.h("div",{className:"settings-section"},o.h("div",{className:"settings-row"},o.h("button",{className:"world-settings-btn",title:"World Settings"},o.h("span",{className:"world-gear-icon"},"⚙"))))))):n.error?o.h("div",{className:"world-container"},o.h("div",{className:"world-columns"},o.h("div",{className:"chat-column"},o.h("div",{className:"agents-section"},o.h("div",{className:"agents-row"},o.h("div",{className:"no-agents"},"Error"))),o.h("div",{className:"error-state"},o.h("p",null,"Error: ",n.error),o.h("button",{$onclick:["/World",n.worldName]},"Retry"))),o.h("div",{className:"settings-column"},o.h("div",{className:"settings-section"},o.h("div",{className:"settings-row"},o.h("button",{className:"world-settings-btn",title:"World Settings"},o.h("span",{className:"world-gear-icon"},"⚙"))))))):o.h("div",{className:"world-container"},o.h("div",{className:"world-columns"},o.h("div",{className:"chat-column"},o.h("div",{className:"agents-section"},o.h("div",{className:"agents-row agents-row-with-back"},o.h("div",{className:"back-button-container"},o.h("a",{href:"/"},o.h("button",{className:"back-button",title:"Back to Worlds"},o.h("span",{className:"world-back-icon"},"←")))),o.h("div",{className:"agents-list-container"},n.loading?o.h("div",{className:"loading-agents"},"Loading agents..."):(r=n.agents)!=null&&r.length?o.h("div",{className:"agents-list"},n.agents.map((l,s)=>{var i;const a=n.selectedSettingsTarget==="agent"&&((i=n.selectedAgent)==null?void 0:i.id)===l.id;return o.h("div",{key:`agent-${l.id||s}`,className:`agent-item ${a?"selected":""}`,$onclick:["select-agent-settings",l]},o.h("div",{className:"agent-sprite-container"},o.h("div",{className:`agent-sprite sprite-${l.spriteIndex}`}),o.h("div",{className:"message-badge"},l.messageCount)),o.h("div",{className:"agent-name"},l.name))})):o.h("div",{className:"no-agents"},"No agents in this world")))),o.h(nt,{worldName:n.worldName,messages:n.messages,userInput:n.userInput,messagesLoading:n.messagesLoading,isSending:n.isSending,isWaiting:n.isWaiting,activeAgent:n.activeAgent,selectedAgent:n.selectedSettingsTarget==="agent"?n.selectedAgent:null})),o.h("div",{className:"settings-column"},o.h("div",{className:"settings-section"},o.h("div",{className:"settings-row"},o.h("button",{className:"world-settings-btn",title:"World Settings",$onclick:"select-world-settings"},o.h("span",{className:"world-gear-icon"},"⊕")))),o.h(tt,{world:n.world,selectedSettingsTarget:n.selectedSettingsTarget,selectedAgent:n.selectedAgent,totalMessages:(n.messages||[]).length}))),n.showAgentEdit&&o.h(ot,{agent:n.selectedAgentForEdit,mode:n.agentEditMode,worldName:n.worldName}),n.showWorldEdit&&o.h(Fe,{world:n.selectedWorldForEdit,mode:n.worldEditMode}))});S(this,"update",{...pt,"open-agent-create":n=>({...n,showAgentEdit:!0,agentEditMode:"create",selectedAgentForEdit:null}),"open-agent-edit":(n,r)=>({...n,showAgentEdit:!0,agentEditMode:"edit",selectedAgentForEdit:r}),"open-agent-delete":(n,r)=>({...n,showAgentEdit:!0,agentEditMode:"delete",selectedAgentForEdit:r}),"close-agent-edit":n=>({...n,showAgentEdit:!1}),"open-world-edit":n=>({...n,showWorldEdit:!0,worldEditMode:"edit",selectedWorldForEdit:n.world}),"close-world-edit":n=>({...n,showWorldEdit:!1})})}}o.render("#root",o.h(Fn,null));o.addComponents("#pages",{"/":et,"/World":yt});
